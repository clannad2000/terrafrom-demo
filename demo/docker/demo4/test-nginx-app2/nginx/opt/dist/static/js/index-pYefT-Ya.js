var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(a,l,o)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[l]=o;import{q as i,r as p}from"./DeviceManage-aryRM0Sb.js";import{d as n,z as c,n as d,P as u,A as m,a0 as w,V as g,F as h,H as v,r as b,j as f,w as y,o as x,c as C,e as _,b as k,h as j,a4 as N,u as T,a2 as z,J as P,L as I,g as U,f as V,I as S,N as O,a1 as R,_ as D}from"./index-OtYEJMgP.js";import{u as A}from"./useThrottle-fY6V1GyW.js";import{d as F}from"./download-z--BcN7F.js";import{_ as L}from"./ApprovalDialog.vue_vue_type_script_setup_true_lang-8h8TScUY.js";import{_ as M}from"./AuditRecordDialog.vue_vue_type_script_setup_true_lang-N5LB6sX7.js";import"./index-fHT9WYUA.js";const q={class:"w-full h-full flex flex-col gap-y-4 table-container"},B={class:"flex flex-col h-full gap-y-4"},K=n((E=((e,a)=>{for(var l in a||(a={}))t.call(a,l)&&r(e,l,a[l]);if(o)for(var l of o(a))s.call(a,l)&&r(e,l,a[l]);return e})({},{name:"ScrapRecordIndex"}),a(E,l({__name:"index",setup(e){const[a,{showDialog:l,setDialogProps:o}]=c(),[t,{showDialog:s,setDialogProps:r}]=c(),n=d((()=>u().getUserInfoState.userName)),D=m(!1),K=w({orgId:"",majorTypes:[],deviceCondition:"",deviceType:""}),E=w({pageNum:1,pageSize:10,total:0}),H=d((()=>({nodeKey:"id",props:{label:e=>e.shortName||e.name,children:"children"}}))),J=m([]),[Q,Y]=A((()=>{E.pageNum=1,Z()}),800,{debounce:!0}),Z=()=>{D.value=!0;const{pageSize:e,pageNum:a}=E,{orgId:l,majorTypes:o=[],deviceCondition:t,deviceType:s}=K;i({orgId:l,majorType:o.join(","),deviceCondition:t,deviceType:s,pageSize:e,pageNum:a}).then((e=>{if(e&&R!==e){const{rows:a=[],total:l=0}=e;J.value=a,E.total=Number(l)||0}})).finally((()=>{D.value=!1}))},$=()=>{return e=this,a=null,l=function*(){D.value=!0;const{orgId:e,majorTypes:a=[],deviceCondition:l,deviceType:o}=K;yield p({orgId:e,majorType:a.join(","),deviceCondition:l,deviceType:o}).then((e=>{if(e&&(null==e?void 0:e.data)){const a=e.headers["content-disposition"];let l="unknown";a&&(l=window.decodeURI(a.split("=")[1])),F(e.data,l)}})).finally((()=>{D.value=!1}))},new Promise(((o,t)=>{var s=e=>{try{i(l.next(e))}catch(a){t(a)}},r=e=>{try{i(l.throw(e))}catch(a){t(a)}},i=e=>e.done?o(e.value):Promise.resolve(e.value).then(s,r);i((l=l.apply(e,a)).next())}));var e,a,l};return g((()=>{})),h((()=>{Q()})),v((()=>{Y()})),(e,i)=>{const p=b("el-tree-select"),c=b("el-form-item"),d=b("el-option"),u=b("el-select"),m=b("el-input"),w=b("el-button"),g=b("el-form"),h=b("el-table-column"),v=b("el-table"),R=b("el-pagination"),A=f("loading");return y((x(),C("div",q,[_("div",B,[k(g,{inline:!0,"label-suffix":"：",class:"w-full table-query"},{default:j((()=>[k(c,{label:"管理部门",class:"m-0"},{default:j((()=>[k(p,N({modelValue:K.orgId,"onUpdate:modelValue":i[0]||(i[0]=e=>K.orgId=e),data:T(z)().orgTreeByUser,"render-after-expand":!1,clearable:""},H.value,{"check-strictly":!0,"highlight-current":!0,"expand-on-click-node":!1,placeholder:"请选择管理部门",onFocus:T(z)().loadOrgTreeByUser}),null,16,["modelValue","data","onFocus"])])),_:1}),k(c,{label:"专业",class:"m-0"},{default:j((()=>[k(u,{modelValue:K.majorTypes,"onUpdate:modelValue":i[1]||(i[1]=e=>K.majorTypes=e),placeholder:"请选择专业",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:j((()=>[(x(!0),C(P,null,I(T(z)().workerMajorList,(e=>(x(),U(d,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),k(c,{label:"设备名称",class:"m-0"},{default:j((()=>[k(m,{modelValue:K.deviceCondition,"onUpdate:modelValue":i[2]||(i[2]=e=>K.deviceCondition=e),clearable:"",class:"mb-4",placeholder:"请输入设备名称/编号",maxlength:"20"},null,8,["modelValue"])])),_:1}),k(c,{label:"设备类型",class:"m-0"},{default:j((()=>[k(u,{modelValue:K.deviceType,"onUpdate:modelValue":i[3]||(i[3]=e=>K.deviceType=e),placeholder:"请选择设备类型",clearable:""},{default:j((()=>[(x(!0),C(P,null,I(T(z)().deviceTypeList,(e=>(x(),U(d,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),k(c,{label:"",class:"m-0"},{default:j((()=>[k(w,{class:"basic-button",onClick:T(Q)},{default:j((()=>[V(" 查询 ")])),_:1},8,["onClick"]),k(w,{class:"basic-button",onClick:$},{default:j((()=>[V(" 导出 ")])),_:1})])),_:1})])),_:1}),k(v,{class:"w-full h-full",data:J.value,"show-overflow-tooltip":""},{default:j((()=>[k(h,{type:"index",label:"序号",width:"80",align:"center"},{default:j((e=>[_("span",null,S((E.pageNum-1)*E.pageSize+e.$index+1),1)])),_:1}),k(h,{prop:"cityOrgName",align:"center",label:"市级公司","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),k(h,{prop:"orgName",align:"center",label:"管理部门","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),k(h,{prop:"deviceTypeName",align:"center",label:"设备类型","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),k(h,{prop:"deviceName",align:"center",label:"设备名称","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),k(h,{prop:"deviceCode",align:"center",label:"设备编码","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),k(h,{prop:"majorTypeName",align:"center",label:"专业","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),k(h,{prop:"registerTime",align:"center",label:"投运时间","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),k(h,{prop:"applyTime",align:"center",label:"申请时间","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),k(h,{prop:"applyRealName",align:"center",label:"申请人","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),k(h,{prop:"auditCityRealName",align:"center",label:"地市审批人","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),k(h,{prop:"auditProvRealName",align:"center",label:"省级审批人","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),k(h,{prop:"reason",align:"center",label:"原因","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),k(h,{fixed:"right",label:"操作",width:"240",align:"center"},{default:j((({row:e})=>["0"!=e.isAudit||(e.auditProvUserName||e.auditCityUserName!=n.value)&&e.auditProvUserName!=n.value?O("",!0):(x(),U(w,{key:0,type:"warning",link:"",onClick:a=>(e=>{o({title:"审批"}),l(!0,{type:"approval",data:e})})(e)},{default:j((()=>[V(" 审批 ")])),_:2},1032,["onClick"])),k(w,{type:"primary",link:"",onClick:a=>(e=>{r({title:"审批记录"}),s(!0,{type:"view",data:e})})(e)},{default:j((()=>[V(" 审批记录 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),k(R,{"current-page":E.pageNum,"onUpdate:currentPage":i[4]||(i[4]=e=>E.pageNum=e),"page-size":E.pageSize,"onUpdate:pageSize":i[5]||(i[5]=e=>E.pageSize=e),background:"",small:"",layout:"total, sizes, prev, pager, next, jumper",total:E.total,"page-sizes":[10,20,30,40,50,100],onSizeChange:T(Q),onCurrentChange:Z},null,8,["current-page","page-size","total","onSizeChange"])]),k(L,{onRegister:T(a),onConfirm:T(Q)},null,8,["onRegister","onConfirm"]),k(M,{onRegister:T(t)},null,8,["onRegister"])])),[[A,D.value]])}}}))));var E;const H=D(K,[["__scopeId","data-v-462d5c9b"]]);export{H as default};
