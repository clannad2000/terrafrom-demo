var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,r=(a,t,o)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[t]=o;import{E as s}from"./icon_no_data-JkxAPqfn.js";import{d as i,z as c,a7 as u,Y as f,A as p,at as m,r as d,o as y,c as v,u as g,J as b,e as w,b as h,h as x,f as P,a6 as j,a5 as D}from"./index-OtYEJMgP.js";import{u as O}from"./ElectronicFence-HI2dfd04.js";import F from"./DeviceLinkDialog-DdhIpBf4.js";import I from"./PlanLinkDialog-0_SD0xyd.js";const M={class:"w-full h-full flex flex-col gap-y-4"},_={class:"flex flex-row items-center"},k=w("div",{class:"flex-1 flex flex-row"},[w("div",{id:"map",class:"w-full h-full"})],-1),R={key:1,class:"w-full h-full flex flex-row items-center justify-center"},C=i((E=((e,a)=>{for(var t in a||(a={}))l.call(a,t)&&r(e,t,a[t]);if(o)for(var t of o(a))n.call(a,t)&&r(e,t,a[t]);return e})({},{name:"FenceView"}),a(E,t({__name:"FenceView",setup(e){const[a,{showDialog:t,setDialogProps:o}]=c(),[l,{showDialog:n,setDialogProps:r}]=c(),i=()=>{const{value:{id:e}}=O().fenceParams;e?(o({title:"关联计划"}),t(!0,{type:"edit",data:{fenceId:e}})):j.error("请选择围栏")},C=()=>{const{value:{id:e}}=O().fenceParams;e?(r({title:"关联设备"}),n(!0,{type:"edit",data:{fenceId:e}})):j.error("请选择围栏")},{commonMap:E}=u(),L=f(null),z=p([119.12477321074,33.074785125453]),S=p(!1),V=D((()=>{return e=this,a=null,t=function*(){S.value=!1,yield Y(),L.value=new E.Map({container:"map",style:"aegis://styles/aegis/Satellite512",center:z.value,zoom:6.5,maxZoom:19.5,localIdeographFontFamily:"Microsoft YoHei"}),L.value.on("load",(()=>{S.value=!0,new E.RoadNetLayer({map:L.value,style:"aegis://styles/aegis/Road-v2"}).render();const{value:{area:e}}=O().fenceParams;if(e){L.value.addLayer({id:"power-polygon",type:"fill",source:{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:e}]}},paint:{"fill-color":"#3b89ca","fill-opacity":.5}});const a=(e=>{if(!e||!e.length)return null;const a=e[0];let t=0,o=0,l=Infinity,n=Infinity,r=-Infinity,s=-Infinity;a.forEach((e=>{const[a,i]=e;t+=a,o+=i,l=Math.min(l,a),n=Math.min(n,i),r=Math.max(r,a),s=Math.max(s,i)}));const i=a.length;return{center:[t/i,o/i],bounds:{ne:[r,s],sw:[l,n]}}})(e.coordinates);a&&(z.value=a.center,L.value.setCenter(a.center),L.value.fitBounds([a.bounds.sw,a.bounds.ne],{padding:{top:10,bottom:25,left:15,right:5}}))}}))},new Promise(((o,l)=>{var n=e=>{try{s(t.next(e))}catch(a){l(a)}},r=e=>{try{s(t.throw(e))}catch(a){l(a)}},s=e=>e.done?o(e.value):Promise.resolve(e.value).then(n,r);s((t=t.apply(e,a)).next())}));var e,a,t}),1e3),Y=()=>{console.log("destroyMap"),L.value&&(L.value.remove(),L.value=null)};return m((()=>O().fenceParams),(()=>{const{type:e}=O().fenceParams;"view"===e&&V()}),{deep:!0,immediate:!0}),(e,t)=>{const o=d("el-button"),n=d("el-empty");return y(),v("div",M,[g(O)().fenceParams.type?(y(),v(b,{key:0},[w("div",_,[h(o,{class:"basic-button",onClick:i},{default:x((()=>[P(" 关联计划 ")])),_:1}),h(o,{class:"basic-button",onClick:C},{default:x((()=>[P(" 关联设备 ")])),_:1})]),k],64)):(y(),v("div",R,[h(n,{description:"暂无数据",image:g(s)},null,8,["image"])])),h(F,{onRegister:g(l)},null,8,["onRegister"]),h(I,{onRegister:g(a)},null,8,["onRegister"])])}}}))));var E;export{C as _};
