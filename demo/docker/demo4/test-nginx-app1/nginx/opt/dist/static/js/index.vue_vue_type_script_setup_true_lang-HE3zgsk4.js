var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,s=(a,l,o)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[l]=o;import{d as n,z as i,A as p,a0 as c,n as u,F as d,H as m,r as f,j as g,w,o as h,c as b,e as v,b as y,h as x,a4 as _,u as C,a2 as k,f as j,I as z,M as O,a1 as P,a6 as N}from"./index-OtYEJMgP.js";import{a as I,d as S}from"./DeviceManage-aryRM0Sb.js";import{u as T}from"./useThrottle-fY6V1GyW.js";import{_ as D}from"./AuthDialog.vue_vue_type_script_setup_true_lang-AISmNr_F.js";const U={class:"w-full h-full flex flex-col gap-y-4 table-container"},V={class:"flex flex-col h-full gap-y-4"},A=n((B=((e,a)=>{for(var l in a||(a={}))t.call(a,l)&&s(e,l,a[l]);if(o)for(var l of o(a))r.call(a,l)&&s(e,l,a[l]);return e})({},{name:"DeviceAuthIndex"}),a(B,l({__name:"index",setup(e){const[a,{showDialog:l,setDialogProps:o}]=i(),t=p(!1),r=c({orgId:"",condition:""}),s=c({pageNum:1,pageSize:10,total:0}),n=u((()=>({nodeKey:"id",props:{label:e=>e.shortName||e.name,children:"children"}}))),A=[{label:"授权码模式",value:"authorization_code"},{label:"客户端模式",value:"client_credentials"},{label:"密码模式",value:"password"},{label:"刷新令牌",value:"refresh_token"}],B=[{label:"APP服务",value:"js-zygk-app-api"}],F=p([]),[M,R]=T((()=>{s.pageNum=1,E()}),800,{debounce:!0}),q=function(){o({title:"新增授权"}),l(!0,{type:"add",data:null})},E=()=>{t.value=!0;const{pageSize:e,pageNum:a}=s,{orgId:l,condition:o}=r;I({orgId:l,condition:o,pageSize:e,pageNum:a}).then((e=>{if(e&&P!==e){const{rows:a=[],total:l=0}=e;F.value=a,s.total=Number(l)||0}})).finally((()=>{t.value=!1}))},H=e=>{return a=this,l=null,o=function*(){t.value=!0,yield S({deviceCode:e.deviceCode}).then((e=>{P!==e&&N.success("删除成功!")})).finally((()=>{t.value=!1,M()}))},new Promise(((e,t)=>{var r=e=>{try{n(o.next(e))}catch(a){t(a)}},s=e=>{try{n(o.throw(e))}catch(a){t(a)}},n=a=>a.done?e(a.value):Promise.resolve(a.value).then(r,s);n((o=o.apply(a,l)).next())}));var a,l,o};return d((()=>{M()})),m((()=>{R()})),(e,i)=>{const p=f("el-tree-select"),c=f("el-form-item"),u=f("el-input"),d=f("el-button"),m=f("el-form"),P=f("el-table-column"),N=f("el-popconfirm"),I=f("el-table"),S=f("el-pagination"),T=g("loading");return w((h(),b("div",U,[v("div",V,[y(m,{inline:!0,"label-suffix":"：",class:"w-full table-query"},{default:x((()=>[y(c,{label:"管理部门",class:"m-0"},{default:x((()=>[y(p,_({modelValue:r.orgId,"onUpdate:modelValue":i[0]||(i[0]=e=>r.orgId=e),data:C(k)().orgTreeByUser,"render-after-expand":!1,clearable:""},n.value,{"check-strictly":!0,"highlight-current":!0,"expand-on-click-node":!1,placeholder:"请选择管理部门",onFocus:C(k)().loadOrgTreeByUser}),null,16,["modelValue","data","onFocus"])])),_:1}),y(c,{label:"设备名称",class:"m-0"},{default:x((()=>[y(u,{modelValue:r.condition,"onUpdate:modelValue":i[1]||(i[1]=e=>r.condition=e),clearable:"",class:"mb-4",placeholder:"请输入设备名称/编号",maxlength:"20"},null,8,["modelValue"])])),_:1}),y(c,{label:"",class:"m-0"},{default:x((()=>[y(d,{class:"basic-button",onClick:C(M)},{default:x((()=>[j(" 查询 ")])),_:1},8,["onClick"]),y(d,{class:"basic-button",onClick:q},{default:x((()=>[j(" 新增 ")])),_:1})])),_:1})])),_:1}),y(I,{class:"w-full h-full",data:F.value,"show-overflow-tooltip":""},{default:x((()=>[y(P,{prop:"cityOrgName",align:"center",label:"市级公司","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(P,{prop:"orgName",align:"center",label:"管理部门","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(P,{prop:"deviceName",align:"center",label:"设备名称","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(P,{prop:"deviceCode",align:"center",label:"设备编码","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(P,{prop:"deviceType",align:"center",label:"设备类型","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}},{default:x((({row:e})=>[j(z(C(k)().groupCodeObj(C(k)().deviceTypeList,"code",e.deviceType).name),1)])),_:1}),y(P,{prop:"clientSecret",align:"center",label:"client_secret","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(P,{prop:"grantTypes",align:"center",label:"授权类型","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}},{default:x((({row:e})=>{return[j(z((a=e.grantTypes,a.split(",").map((e=>{var a;return null==(a=A.find((a=>a.value===e)))?void 0:a.label})).filter(Boolean).join(", "))),1)];var a})),_:1}),y(P,{prop:"resourceIds",align:"center",label:"资源","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}},{default:x((({row:e})=>{return[j(z((a=e.resourceIds,a.split(",").map((e=>{var a;return null==(a=B.find((a=>a.value===e)))?void 0:a.label})).filter(Boolean).join(", "))),1)];var a})),_:1}),y(P,{fixed:"right",label:"操作",width:"200",align:"center"},{default:x((({row:e})=>[y(d,{type:"primary",link:"",onClick:a=>{return t=e,o({title:"编辑授权"}),void l(!0,{type:"edit",data:t});var t}},{default:x((()=>[j(" 编辑 ")])),_:2},1032,["onClick"]),y(N,{title:"确认删除?",onConfirm:a=>H(e)},{reference:x((()=>[y(d,{link:"",type:"danger",onClick:i[2]||(i[2]=O((()=>{}),["stop"]))},{default:x((()=>[j(" 删除")])),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"]),y(S,{"current-page":s.pageNum,"onUpdate:currentPage":i[3]||(i[3]=e=>s.pageNum=e),"page-size":s.pageSize,"onUpdate:pageSize":i[4]||(i[4]=e=>s.pageSize=e),background:"",small:"",layout:"total, sizes, prev, pager, next, jumper",total:s.total,"page-sizes":[10,20,30,40,50,100],onSizeChange:C(M),onCurrentChange:E},null,8,["current-page","page-size","total","onSizeChange"])]),y(D,{onRegister:C(a),onConfirm:C(M)},null,8,["onRegister","onConfirm"])])),[[T,t.value]])}}}))));var B;export{A as _};
