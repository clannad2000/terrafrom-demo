import{a as e}from"./PlanManage-UfdB-sAa.js";import{d as l,z as a,a8 as r,a2 as o,A as t,n as s,a0 as d,H as n,r as m,o as u,g as i,h as g,e as p,b as c,f as b,u as f,ab as h,c as v,J as k,L as y,a4 as N,a9 as V,$ as w,a1 as j,a6 as O,aK as _,_ as I}from"./index-OtYEJMgP.js";import{U as R}from"./index-fHT9WYUA.js";const U={class:"dialog-footer"},L=I(l({__name:"EditPlanDialog",emits:["register","confirm"],setup(l,{emit:I}){const[L,{showDialog:x,setDialogProps:z}]=a();let P="";const C=I,[T,{closeDialog:q}]=r((e=>{const{type:l,data:a}=e;P=l,o().loadCityOrg()})),D=t(!1),$=t(null),B={cityOrgId:[{required:!0,message:"请选择市级公司！",trigger:"change"}],orgId:[{required:!0,message:"请选择管理部门！",trigger:"change"}],taskName:[{required:!0,message:"请填写任务名称！",trigger:"blur"},{max:256,message:"任务名称长度不能超过256位！",trigger:"blur"}],majorType:[{required:!0,message:"请选择专业！",trigger:"change"}],workType:[{required:!0,message:"请选择作业类型！",trigger:"change"}],workRiskLevel:[{required:!0,message:"请选择作业风险等级！",trigger:"change"}],gridRiskLevel:[{required:!0,message:"请选择电网风险等级！",trigger:"change"}],stationName:[{required:!0,message:"请填写变电站！",trigger:"blur"},{max:64,message:"变电站长度不能超过64位！",trigger:"blur"}],sgOrgId:[{required:!0,message:"请选择施工单位！",trigger:"change"}],fzrUserName:[{required:!0,message:"请选择工作负责人！",trigger:"change"}],fzrPhone:[{required:!0,message:"请填写联系方式！",trigger:"blur"},{validator(e,l,a){_.mobile.test(l)?a():a(new Error("请填写正确的联系方式！"))},trigger:"blur"},{max:32,message:"联系方式长度不能超过32位！",trigger:"blur"}],jlrPhone:[{validator(e,l,a){_.mobile.test(l)||0===l.length?a():a(new Error("请填写正确的联系方式！"))},trigger:"blur"},{max:32,message:"联系方式长度不能超过32位！",trigger:"blur"}],time:[{required:!0,message:"请选择计划时间！",trigger:"change"}],workContent:[{required:!0,message:"请填写作业内容！",trigger:"blur"},{max:256,message:"作业内容长度不能超过256位！",trigger:"blur"}],substationName:[{max:64,message:"电线/线路长度不能超过64位！",trigger:"blur"}]},E=s((()=>({nodeKey:"id",props:{label:e=>e.shortName||e.name,children:"children"}}))),M=d({cityOrgId:"",orgId:"",taskName:"",majorType:"",workType:"",voltageLevel:"",substationName:"",workRiskLevel:"",gridRiskLevel:"",stationName:"",sgOrgId:"",sgOrgName:"",fzrUserName:"",fzrRealName:"",fzrPhone:"",jlOrgId:"",jlOrgName:"",jlrUserName:"",jlrRealName:"",jlrPhone:"",time:[],workContent:""}),Y=()=>{M.orgId="",o().loadOrgTreeByOrgId(M.cityOrgId)},F=t(""),H=e=>{F.value=e,z({title:"选择人员"}),x(!0,{type:"add",tabs:["principalOrg","outsourceOrg"],isSingle:!0})},K=e=>{const{personnel:l=[],orgType:a=""}=e;let r="",o="",t="",s="",d="";w(l)&&(r=l[0].userName,o=l[0].realName,"principalOrg"===a?(t=l[0].organization.id||"",s=l[0].organization.name||"",d=l[0].mobile||""):"outsourceOrg"===a&&(t=l[0].outCompanyId||"",s=l[0].outCompanyName||"",d=l[0].telNumber||""),"sg"===F.value?Object.assign(M,{sgOrgId:t,sgOrgName:s,fzrUserName:r,fzrRealName:o,fzrPhone:d}):"jl"===F.value&&Object.assign(M,{jlOrgId:t,jlOrgName:s,jlrUserName:r,jlrRealName:o,jlrPhone:d}))},S=function(){var e;D.value=!1,q(),P="",Object.keys(M).forEach((e=>{M[e]="time"===e?[]:""})),null==(e=$.value)||e.clearValidate()},A=function(){var l;null==(l=$.value)||l.validate((l=>{return a=this,r=null,o=function*(){if(l){D.value=!0;const{cityOrgId:l="",orgId:a="",taskName:r="",majorType:o="",workType:t="",voltageLevel:s="",substationName:d="",workRiskLevel:n="",gridRiskLevel:m="",stationName:u="",sgOrgId:i="",fzrUserName:g="",fzrRealName:p="",fzrPhone:c="",jlOrgId:b="",jlrUserName:f="",jlrRealName:h="",jlrPhone:v="",time:k=[],workContent:y=""}=M,[N="",V=""]=k;"add"===P?e({cityOrgId:l,orgId:a,taskName:r,majorType:o,workType:t,voltageLevel:s,substationName:d,workRiskLevel:n,gridRiskLevel:m,stationName:u,sgOrgId:i,fzrUserName:g,fzrRealName:p,fzrPhone:c,jlOrgId:b,jlrUserName:f,jlrRealName:h,jlrPhone:v,beginTime:N,endTime:V,workContent:y}).then((e=>{j!==e&&(O.success("添加计划成功！"),S(),C("confirm"))})).finally((()=>{D.value=!1})):"edit"===P||(D.value=!1)}},new Promise(((e,l)=>{var t=e=>{try{d(o.next(e))}catch(a){l(a)}},s=e=>{try{d(o.throw(e))}catch(a){l(a)}},d=l=>l.done?e(l.value):Promise.resolve(l.value).then(t,s);d((o=o.apply(a,r)).next())}));var a,r,o}))};return n((()=>{S()})),(e,l)=>{const a=m("el-option"),r=m("el-select"),t=m("el-form-item"),s=m("el-tree-select"),d=m("el-input"),n=m("el-date-picker"),w=m("el-button");return u(),i(f(V),{width:"1200","show-fullscreen":!1,"show-close":!1,center:"","destroy-on-close":"",onClose:S,onRegister:f(T)},{footer:g((()=>[p("span",U,[c(w,{class:"basic-button",disabled:D.value,onClick:S},{default:g((()=>[b(" 取消 ")])),_:1},8,["disabled"]),c(w,{class:"basic-button",loading:D.value,onClick:A},{default:g((()=>[b(" 保存 ")])),_:1},8,["loading"])])])),default:g((()=>[c(f(h),{ref_key:"refPlanForm",ref:$,model:M,rules:B,inline:"","label-width":"120px","label-suffix":"："},{default:g((()=>[c(t,{label:"市级公司",prop:"cityOrgId"},{default:g((()=>[c(r,{modelValue:M.cityOrgId,"onUpdate:modelValue":l[0]||(l[0]=e=>M.cityOrgId=e),placeholder:"请选择市级公司",clearable:"",onFocus:f(o)().loadCityOrgByUser,onChange:Y},{default:g((()=>[(u(!0),v(k,null,y(f(o)().cityOrgByUser,(e=>(u(),i(a,{key:e.id,value:e.id,label:e.shortName||e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue","onFocus"])])),_:1}),c(t,{label:"管理部门",prop:"orgId"},{default:g((()=>[c(s,N({modelValue:M.orgId,"onUpdate:modelValue":l[1]||(l[1]=e=>M.orgId=e),data:f(o)().orgTreeByOrgId,clearable:"","render-after-expand":!1,disabled:!M.cityOrgId},E.value,{"check-strictly":!0,"highlight-current":!0,"expand-on-click-node":!1,placeholder:"请选择管理部门"}),null,16,["modelValue","data","disabled"])])),_:1}),c(t,{label:"任务名称",prop:"taskName"},{default:g((()=>[c(d,{modelValue:M.taskName,"onUpdate:modelValue":l[2]||(l[2]=e=>M.taskName=e),clearable:"",placeholder:"请填写任务名称",maxlength:"256",rows:4,type:"textarea","show-word-limit":"",formatter:e=>e.replace(/\n/g,""),parser:e=>e.replace(/\n/g,"")},null,8,["modelValue","formatter","parser"])])),_:1}),c(t,{label:"作业内容",prop:"workContent"},{default:g((()=>[c(d,{modelValue:M.workContent,"onUpdate:modelValue":l[3]||(l[3]=e=>M.workContent=e),clearable:"",placeholder:"请填写作业内容",maxlength:"256",rows:4,type:"textarea","show-word-limit":"",formatter:e=>e.replace(/\n/g,""),parser:e=>e.replace(/\n/g,"")},null,8,["modelValue","formatter","parser"])])),_:1}),c(t,{label:"所属专业",prop:"majorType"},{default:g((()=>[c(r,{modelValue:M.majorType,"onUpdate:modelValue":l[4]||(l[4]=e=>M.majorType=e),placeholder:"请选择专业",clearable:""},{default:g((()=>[(u(!0),v(k,null,y(f(o)().workerMajorList,(e=>(u(),i(a,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),c(t,{label:"作业类型",prop:"workType"},{default:g((()=>[c(r,{modelValue:M.workType,"onUpdate:modelValue":l[5]||(l[5]=e=>M.workType=e),placeholder:"请选择作业类型",clearable:""},{default:g((()=>[(u(!0),v(k,null,y(f(o)().workTypeList,(e=>(u(),i(a,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),c(t,{label:"电压等级",prop:"voltageLevel"},{default:g((()=>[c(r,{modelValue:M.voltageLevel,"onUpdate:modelValue":l[6]||(l[6]=e=>M.voltageLevel=e),placeholder:"请选择电压等级",clearable:""},{default:g((()=>[(u(!0),v(k,null,y(f(o)().voltageLevelList,(e=>(u(),i(a,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),c(t,{label:"电线/线路",prop:"substationName"},{default:g((()=>[c(d,{modelValue:M.substationName,"onUpdate:modelValue":l[7]||(l[7]=e=>M.substationName=e),clearable:"",placeholder:"请填写电线/线路",maxlength:"32","show-word-limit":"",formatter:e=>e.replace(/\n/g,""),parser:e=>e.replace(/\n/g,"")},null,8,["modelValue","formatter","parser"])])),_:1}),c(t,{label:"作业风险等级",prop:"workRiskLevel"},{default:g((()=>[c(r,{modelValue:M.workRiskLevel,"onUpdate:modelValue":l[8]||(l[8]=e=>M.workRiskLevel=e),placeholder:"请选择作业风险等级",clearable:""},{default:g((()=>[(u(!0),v(k,null,y(f(o)().workRiskLevelList,(e=>(u(),i(a,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),c(t,{label:"电网风险等级",prop:"gridRiskLevel"},{default:g((()=>[c(r,{modelValue:M.gridRiskLevel,"onUpdate:modelValue":l[9]||(l[9]=e=>M.gridRiskLevel=e),placeholder:"请选择电网风险等级",clearable:""},{default:g((()=>[(u(!0),v(k,null,y(f(o)().gridRiskLevelList,(e=>(u(),i(a,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),c(t,{label:"变电站",prop:"stationName"},{default:g((()=>[c(d,{modelValue:M.stationName,"onUpdate:modelValue":l[10]||(l[10]=e=>M.stationName=e),clearable:"",placeholder:"请填写变电站",maxlength:"32","show-word-limit":"",formatter:e=>e.replace(/\n/g,""),parser:e=>e.replace(/\n/g,"")},null,8,["modelValue","formatter","parser"])])),_:1}),c(t,{label:"施工单位",prop:"sgOrgId"},{default:g((()=>[c(d,{modelValue:M.sgOrgName,"onUpdate:modelValue":l[11]||(l[11]=e=>M.sgOrgName=e),placeholder:"请选择施工单位",clearable:"",readonly:"",onClick:l[12]||(l[12]=e=>H("sg"))},null,8,["modelValue"])])),_:1}),c(t,{label:"工作负责人",prop:"fzrUserName"},{default:g((()=>[c(d,{modelValue:M.fzrRealName,"onUpdate:modelValue":l[13]||(l[13]=e=>M.fzrRealName=e),placeholder:"请选择工作负责人",clearable:"",readonly:"",onClick:l[14]||(l[14]=e=>H("sg"))},null,8,["modelValue"])])),_:1}),c(t,{label:"联系方式",prop:"fzrPhone"},{default:g((()=>[c(d,{modelValue:M.fzrPhone,"onUpdate:modelValue":l[15]||(l[15]=e=>M.fzrPhone=e),clearable:"",placeholder:"请填写联系方式",maxlength:"32","show-word-limit":"",formatter:e=>e.replace(/^\s*|\s*$|\n/g,""),parser:e=>e.replace(/^\s*|\s*$|\n/g,"")},null,8,["modelValue","formatter","parser"])])),_:1}),c(t,{label:"监理单位",prop:"jlOrgId"},{default:g((()=>[c(d,{modelValue:M.jlOrgName,"onUpdate:modelValue":l[16]||(l[16]=e=>M.jlOrgName=e),placeholder:"请选择监理单位",clearable:"",readonly:"",onClick:l[17]||(l[17]=e=>H("jl"))},null,8,["modelValue"])])),_:1}),c(t,{label:"监理人",prop:"jlrUserName"},{default:g((()=>[c(d,{modelValue:M.jlrRealName,"onUpdate:modelValue":l[18]||(l[18]=e=>M.jlrRealName=e),placeholder:"请选择监理人",clearable:"",readonly:"",onClick:l[19]||(l[19]=e=>H("jl"))},null,8,["modelValue"])])),_:1}),c(t,{label:"联系方式",prop:"jlrPhone"},{default:g((()=>[c(d,{modelValue:M.jlrPhone,"onUpdate:modelValue":l[20]||(l[20]=e=>M.jlrPhone=e),clearable:"",placeholder:"请填写联系方式",maxlength:"32","show-word-limit":"",formatter:e=>e.replace(/^\s*|\s*$|\n/g,""),parser:e=>e.replace(/^\s*|\s*$|\n/g,"")},null,8,["modelValue","formatter","parser"])])),_:1}),c(t,{label:"计划时间",prop:"time",class:"col-span-2"},{default:g((()=>[c(n,{modelValue:M.time,"onUpdate:modelValue":l[21]||(l[21]=e=>M.time=e),"value-format":"YYYY-MM-DD HH:mm:ss",type:"datetimerange","unlink-panels":"","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",editable:!1},null,8,["modelValue"])])),_:1})])),_:1},8,["model"]),c(R,{onRegister:f(L),onConfirm:K},null,8,["onRegister"])])),_:1},8,["onRegister"])}}}),[["__scopeId","data-v-830aac66"]]);export{L as default};
