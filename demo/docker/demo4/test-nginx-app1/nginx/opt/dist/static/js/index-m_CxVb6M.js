var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,n=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,s=(e,a,t)=>new Promise(((l,o)=>{var r=e=>{try{s(t.next(e))}catch(a){o(a)}},n=e=>{try{s(t.throw(e))}catch(a){o(a)}},s=e=>e.done?l(e.value):Promise.resolve(e.value).then(r,n);s((t=t.apply(e,a)).next())}));import{B as i}from"./index.esm.min-p6OgvXm7.js";import{r as u,v as d,s as c,w as f,t as p,x as m,u as v}from"./StatisticalCenter-fzPo9Omj.js";import{E as g}from"./icon_no_data-JkxAPqfn.js";import{d as b,z as y,Y as x,n as h,A as j,a0 as k,aD as w,aR as D,bQ as S,at as C,r as I,j as N,o as O,c as P,e as T,J as _,L,t as R,I as z,b as A,h as V,a4 as W,u as E,a2 as U,g as $,w as B,N as F,a5 as M,R as q,U as G,a1 as H,_ as J}from"./index-OtYEJMgP.js";import{d as K}from"./constants-uiyZ18jc.js";import Q from"./PatrolRankByOrgDialog-rkTb0pYj.js";import{u as Y,L as X,i as Z}from"./installCanvasRenderer-kp6nwiR2.js";import{i as ee}from"./install-8-Qe0jiJ.js";import{i as ae}from"./install-nwvgNUQF.js";import{i as te}from"./install-wLyK8H0F.js";import"./dataSample-MvCW8qRP.js";import"./createSeriesData-rVoIjXPv.js";import"./sectorHelper-nVwTOMBE.js";import"./Axis-xmqQ_bGV.js";const le={class:"item"},oe={class:"item-title gap-x-2"},re=(e=>(q("data-v-6e23fd4f"),e=e(),G(),e))((()=>T("span",{class:"item-title-text"},"各单位巡查排名",-1))),ne={class:"flex-1 flex flex-row justify-end gap-x-2"},se={class:"flex flex-row"},ie=["onClick"],ue={class:"btn-text"},de={class:"flex-1 flex flex-row"},ce={class:"item-content table-container gap-y-2"},fe={key:0,class:"w-full flex flex-row items-center justify-end"},pe={class:"text-white text-sm"},me={class:"text-[#00e7e8] text-sm font-bold"},ve={class:"flex-1 flex w-full"},ge={key:1,class:"w-full h-full flex flex-row items-center justify-center"},be=b((ye=((e,a)=>{for(var t in a||(a={}))o.call(a,t)&&n(e,t,a[t]);if(l)for(var t of l(a))r.call(a,t)&&n(e,t,a[t]);return e})({},{name:"PatrolRankByOrg"}),xe={__name:"index",props:{ipSource:{default:""},beginDate:{default:K.range.default[0]},endDate:{default:K.range.default[1]}},setup(e,{expose:a}){Y([ee,ae,te,Z]);const t=e,[l,{showDialog:o,setDialogProps:r}]=y(),n=x(),b=e=>{const{dataIndex:a}=e;be.orgId=xe.value[a].orgId,he()},q=[{label:"次数",value:"num"},{label:"时长",value:"duration"},{label:"作业数",value:"taskNum"},{label:"巡查覆盖率",value:"taskCover"}],G={num:{page:u,total:d},duration:{page:c,total:f},taskNum:{page:p,total:m},taskCover:{page:v,total:null}},J=h((()=>({nodeKey:"id",props:{label:e=>e.shortName||e.name,children:"children"}}))),K=j("num"),be=k({orgId:"",ipSource:"",beginDate:"",endDate:"",majorTypes:[]});h((()=>e=>{if(!e.includes("时")||!e.includes("分"))return[0,0];const[a,t]=e.split("时").map((e=>parseInt(e.replace("分",""))||0));return[a,t]}));const ye=j(!1),xe=x([]),he=M((()=>s(this,null,(function*(){if(!G[K.value])return;stop(),ye.value=!0,xe.value=[];const{orgId:e,ipSource:a,beginDate:t,endDate:l,majorTypes:o}=be,r={orgId:e,ipSource:a,beginDate:t,endDate:l,majorType:o.join(","),pageNum:1,pageSize:10};G[K.value].page(r).then((e=>{if(H!==e){const{rows:a=[]}=e;xe.value=a,ke()}})).catch((e=>{console.log(e)})).finally((()=>{ye.value=!1}))}))),1e3),je=j("0"),ke=M((()=>s(this,null,(function*(){if(!G[K.value]||!G[K.value].total)return;const{ipSource:e,beginDate:a,endDate:t,orgId:l,majorTypes:o}=be,r={ipSource:e,beginDate:a,endDate:t,majorType:o.join(","),orgId:l};G[K.value].total(r).then((e=>{H!==e&&(je.value=e||("num"===K.value||"taskNum"===K.value?"0":"duration"===K.value?"0时0分":""))})).finally((()=>{ye.value=!1}))}))),1e3),we=()=>{const{ipSource:e,beginDate:a,endDate:t,orgId:l,majorTypes:n}=be,s={ipSource:e,beginDate:a,endDate:t,majorType:n.join(","),orgId:l,rankType:K.value};r({title:"各单位巡查排名"}),o(!0,{type:"view",data:s})},De=h((()=>{const e=w(xe.value),a=D(e,(e=>e.orgName)),t=D(e,(e=>"duration"===K.value?Number(e.duration)||0:"taskCover"===K.value?Number(e.patrolCoverPercent)||0:Number(e.count)||0)),l=t.every((e=>0===e))?new Array(e.length).fill(100):new Array(e.length).fill(Math.max(...t));return{grid:{left:10,right:0,bottom:0,top:0,containLabel:!0},tooltip:{trigger:"item",backgroundColor:"#033b77",borderColor:"#21f2c4",textStyle:{color:"#fff",fontSize:13},formatter:function(a){const{name:t,dataIndex:l}=a;return`${t}：${"duration"===K.value?e[l].durationFormat:"taskCover"===K.value?e[l].patrolCoverPercent+"%":e[l].count}`}},xAxis:{show:!1,type:"value"},yAxis:[{type:"category",inverse:!0,axisLabel:{show:!0,align:"right",overflow:"truncate",fontSize:14,color:"#fff",rich:{index:{color:"#9d9d9d",fontWeight:"bold",fontStyle:"italic"},index1:{color:"#f8777b",fontWeight:"bold",fontStyle:"italic"},index2:{color:"#ffa145",fontWeight:"bold",fontStyle:"italic"},index3:{color:"#6ade8d",fontWeight:"bold",fontStyle:"italic"},name:{align:"left",textAlign:"left",width:140}},formatter:e=>{const t=a.indexOf(e)+1;return["{"+(t>3?"index":"index"+t)+"|"+t+"}","{name|"+S(e,{length:13})+"}"].join(" ")}},splitLine:{show:!1},axisTick:{show:!1},axisLine:{show:!1},data:a},{type:"category",inverse:!0,axisTick:"none",axisLine:"none",show:!0,axisLabel:{textStyle:{color:"#fff",fontSize:"12"},formatter:function(a,t){return`${"duration"===K.value?e[t].durationFormat:"taskCover"===K.value?e[t].patrolCoverPercent+"%":a}`}},data:t}],series:[{name:"值",type:"bar",zlevel:1,itemStyle:{borderRadius:28,color:new X(0,0,1,0,[{offset:0,color:"num"==K.value?"rgba(1, 238, 113, 0)":"duration"==K.value?"rgba(22, 127, 229, 0)":"taskNum"==K.value?"rgba(255,200,50, 0)":"taskCover"==K.value?"rgba(255,144,47, 0)":void 0},{offset:1,color:"num"==K.value?"rgba(1, 238, 113, 1)":"duration"==K.value?"rgba(22, 127, 229, 1)":"taskNum"==K.value?"rgba(255,200,50, 1)":"taskCover"==K.value?"rgba(255,144,47, 1)":void 0}])},barWidth:14,data:t},{name:"背景",type:"bar",barWidth:14,barGap:"-100%",data:l,itemStyle:{color:"rgba(255,255,255,0.1)",borderRadius:28}}]}}));return C((()=>t),(()=>{const{ipSource:e,beginDate:a,endDate:l}=t;Object.assign(be,{beginDate:a,endDate:l,ipSource:e})}),{deep:!0,immediate:!0}),a({loadData:he}),(e,a)=>{const t=I("el-tree-select"),o=I("el-form-item"),r=I("el-option"),s=I("el-select"),u=I("el-form"),d=I("el-empty"),c=N("loading");return O(),P("div",le,[T("div",oe,[re,T("div",ne,[T("div",se,[(O(),P(_,null,L(q,(e=>T("div",{key:e.value,class:R(["tab-btn cursor-pointer",{active:K.value===e.value}]),onClick:a=>{return t=e.value,K.value=t,je.value="num"===K.value||"taskNum"===K.value?"0":"duration"===K.value?"0时0分":"",xe.value=[],void he();var t}},[T("span",ue,z(e.label),1)],10,ie))),64))]),T("div",de,[A(u,{inline:!0,"label-suffix":"：",class:"w-full table-query"},{default:V((()=>[A(o,{class:"m-0"},{default:V((()=>[A(t,W({modelValue:be.orgId,"onUpdate:modelValue":a[0]||(a[0]=e=>be.orgId=e),data:E(U)().cityOrgTreeAll,"render-after-expand":!1,clearable:""},J.value,{"check-strictly":!0,"highlight-current":!0,"expand-on-click-node":!1,placeholder:"请选择单位",onChange:E(he)}),null,16,["modelValue","data","onChange"])])),_:1}),A(o,{class:"m-0"},{default:V((()=>[A(s,{modelValue:be.majorTypes,"onUpdate:modelValue":a[1]||(a[1]=e=>be.majorTypes=e),placeholder:"请选择专业",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",onChange:E(he)},{default:V((()=>[(O(!0),P(_,null,L(E(U)().workerMajorList,(e=>(O(),$(r,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1})])),_:1})])]),T("span",{class:"text-[#02e8ff] text-sm cursor-pointer",onClick:we},"更多>>>")]),B((O(),P("div",ce,["taskCover"!==K.value?(O(),P("div",fe,[T("span",pe,z("num"===K.value?"巡查次数：":"duration"===K.value?"巡查时长：":"taskNum"===K.value?"巡查计划：":""),1),T("span",me,z(je.value),1)])):F("",!0),T("div",ve,[xe.value.length?(O(),$(E(i),{key:0,ref_key:"vchart",ref:n,class:"w-full h-full",option:De.value,autoresize:"",onClick:b},null,8,["option"])):(O(),P("div",ge,[A(d,{description:"暂无数据",image:E(g),"image-size":80},null,8,["image"])]))])])),[[c,ye.value]]),A(Q,{onRegister:E(l)},null,8,["onRegister"])])}}},a(ye,t(xe))));var ye,xe;const he=J(be,[["__scopeId","data-v-6e23fd4f"]]);export{he as default};
