var e=Object.defineProperty,a=Object.defineProperties,s=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(a,s,l)=>s in a?e(a,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[s]=l;import{d as n,z as i,n as p,a8 as c,Y as d,A as u,a0 as m,H as f,r as w,o as b,g,h,e as y,b as v,f as k,u as x,ab as T,a4 as C,a2 as _,M as j,a9 as N,aX as O,a1 as P,a6 as D,R as I,U as A,_ as R}from"./index-OtYEJMgP.js";import V from"./PlanSelector-IFmDP4Iv.js";import"./constants-uiyZ18jc.js";const E={class:"flex flex-row items-center gap-x-4"},q=(e=>(I("data-v-252f310c"),e=e(),A(),e))((()=>y("span",{class:"text-[#6ff] text-sm"}," ( 智能分析耗时较长，建议添加计划数少于10个 )",-1))),L={class:"dialog-footer"},S=n((U=((e,a)=>{for(var s in a||(a={}))t.call(a,s)&&r(e,s,a[s]);if(l)for(var s of l(a))o.call(a,s)&&r(e,s,a[s]);return e})({},{name:"AddAnalysisDialog"}),a(U,s({__name:"AddAnalysisDialog",emits:["register","confirm"],setup(e,{emit:a}){const[s,{showDialog:l,setDialogProps:t}]=i(),o=p((()=>({nodeKey:"id",props:{label:"desc",children:"children"}}))),r=()=>{t({title:"添加作业计划"}),l(!0,{type:"view",data:{}})},n=e=>{const{plans:a}=e,s=[...U.value,...a].reduce(((e,a)=>(e.some((e=>e.taskId===a.taskId))||e.push(a),e)),[]);U.value=s};let I="";const A=a,[R,{closeDialog:S}]=c((e=>{const{type:a,data:s}=e;I=a})),U=d([]),z=u(!1),$=u(null),F={analysisTaskName:[{required:!0,message:"请填写智能分析名称！",trigger:"blur"},{max:32,message:"智能分析名称长度不能超过32位！",trigger:"blur"}],analysisTaskType:[{required:!0,message:"请选择智能分析类型！",trigger:"change"}],tableData:[{validator:(e,a,s)=>{0===U.value.length?s(new Error("请至少添加一个分析作业计划")):s()},trigger:"change",required:!0}]},H=m({analysisTaskName:"",analysisTaskType:[]}),K=function(){var e;z.value=!1,S(),I="",U.value=[],Object.assign(H,{analysisTaskName:"",analysisTaskType:[]}),null==(e=$.value)||e.clearValidate()},M=function(){var e;null==(e=$.value)||e.validate((e=>{return a=this,s=null,l=function*(){if(e){z.value=!0;const{clsTypes:e,majors:a}=(()=>{const e=_().intelligentAnalysisTypeList,a=[],s=[],l=(e,t,o)=>{e.forEach((e=>{t.includes(e.id)&&(a.push(e.name),o&&s.push(o.name)),e.children&&l(e.children,t,e)}))};l(e,H.analysisTaskType);const t=[...new Set(s)];return{clsTypes:a,majors:t}})(),{analysisTaskName:s}=H,l=U.value.map((e=>e.taskId));O({analysisTaskName:s,clsTypes:e,majors:a,taskIds:l}).then((e=>{P!==e&&(D.success("添加成功！"),K(),A("confirm"))})).finally((()=>{z.value=!1}))}},new Promise(((e,t)=>{var o=e=>{try{n(l.next(e))}catch(a){t(a)}},r=e=>{try{n(l.throw(e))}catch(a){t(a)}},n=a=>a.done?e(a.value):Promise.resolve(a.value).then(o,r);n((l=l.apply(a,s)).next())}));var a,s,l}))};return f((()=>{K()})),(e,a)=>{const l=w("el-input"),t=w("el-form-item"),i=w("el-tree-select"),p=w("el-button"),c=w("el-table-column"),d=w("el-popconfirm"),u=w("el-table");return b(),g(x(N),{width:"80%","show-fullscreen":!1,"show-close":!1,"destroy-on-close":"","close-on-click-modal":!1,center:"",onClose:K,onRegister:x(R)},{footer:h((()=>[y("span",L,[v(p,{class:"basic-button",disabled:z.value,onClick:K},{default:h((()=>[k(" 取消 ")])),_:1},8,["disabled"]),v(p,{class:"basic-button",loading:z.value,onClick:M},{default:h((()=>[k(" 开始分析 ")])),_:1},8,["loading"])])])),default:h((()=>[v(x(T),{ref_key:"refForm",ref:$,model:H,rules:F,inline:"","label-width":"120px","label-suffix":"："},{default:h((()=>[v(t,{label:"智能分析名称",prop:"analysisTaskName"},{default:h((()=>[v(l,{modelValue:H.analysisTaskName,"onUpdate:modelValue":a[0]||(a[0]=e=>H.analysisTaskName=e),maxlength:"32",clearable:"",placeholder:"请填写智能分析名称","show-word-limit":"",disabled:"edit"==x(I),parser:e=>e.replace(/^\s*|\s*$|\n/g,""),formatter:e=>e.replace(/^\s*|\s*$|\n/g,"")},null,8,["modelValue","disabled","parser","formatter"])])),_:1}),v(t,{label:"智能分析类型",prop:"analysisTaskType"},{default:h((()=>[v(i,C({modelValue:H.analysisTaskType,"onUpdate:modelValue":a[1]||(a[1]=e=>H.analysisTaskType=e),data:x(_)().intelligentAnalysisTypeList,"render-after-expand":!1,clearable:"","show-checkbox":"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},o.value,{"check-strictly":!1,"highlight-current":!1,"expand-on-click-node":!1,placeholder:"请选择智能分析类型"}),null,16,["modelValue","data"])])),_:1}),v(t,{label:"分析作业计划",prop:"tableData"},{default:h((()=>[y("div",E,[v(p,{class:"basic-button",onClick:r},{default:h((()=>[k(" 添加作业计划 ")])),_:1}),q])])),_:1})])),_:1},8,["model"]),v(u,{class:"w-full h-[480px]","show-overflow-tooltip":"",data:U.value},{default:h((()=>[v(c,{prop:"cityOrgName",align:"center",label:"市级公司","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),v(c,{prop:"orgName",align:"center",label:"管理部门","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),v(c,{prop:"taskName",align:"center",label:"任务名称","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),v(c,{prop:"majorTypeName",align:"center",label:"专业","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),v(c,{prop:"beginTime",align:"center",label:"计划开始时间","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),v(c,{prop:"endTime",align:"center",label:"计划结束时间","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),v(c,{prop:"workContent",align:"center",label:"作业内容","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),v(c,{prop:"workRiskLevelName",align:"center",label:"作业风险等级","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),v(c,{prop:"fzrRealName",align:"center",label:"工作负责人","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),v(c,{fixed:"right",label:"操作",width:"80",align:"center"},{default:h((({row:e})=>[v(d,{title:"确认删除?",onConfirm:a=>(e=>{const{taskId:a}=e,s=U.value.filter((e=>e.taskId!==a));U.value=s})(e)},{reference:h((()=>[v(p,{link:"",type:"danger",onClick:a[2]||(a[2]=j((()=>{}),["stop"]))},{default:h((()=>[k(" 删除")])),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"]),v(V,{onRegister:x(s),onConfirm:n},null,8,["onRegister"])])),_:1},8,["onRegister"])}}}))));var U;const z=R(S,[["__scopeId","data-v-252f310c"]]);export{z as default};
