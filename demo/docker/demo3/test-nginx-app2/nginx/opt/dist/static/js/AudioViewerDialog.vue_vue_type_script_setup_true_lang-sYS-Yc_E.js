var e=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=(s,a,o)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[a]=o;import{d as l,A as c,a0 as n,a8 as d,aP as f,H as u,o as p,g as m,h as y,e as b,u as v,aG as g,a9 as h,ay as w,a1 as k}from"./index-OtYEJMgP.js";import{P,c as O}from"./AdminLog-DD6g2Y3j.js";const j=""+new URL("../gif/audio_bg-KTsPhz6f.gif",import.meta.url).href,D={class:"w-full aspect-video flex flex-col relative"},L=["src"],Y=["src"],x=l((H=((e,s)=>{for(var a in s||(s={}))t.call(s,a)&&i(e,a,s[a]);if(o)for(var a of o(s))r.call(s,a)&&i(e,a,s[a]);return e})({},{name:"JobPlanMainAudioViewerDialog"}),s(H,a({__name:"AudioViewerDialog",emits:["register","confirm"],setup(e,{emit:s}){const a=c(""),o=c(!1),t=n({}),[r,{closeDialog:i}]=d((e=>{const{type:s,data:o}=e;if("view"===s){Object.keys(o).forEach((e=>{t[e]=o[e]}));const{fileUrl:e}=o;a.value=e}})),l=n({isLock:!1}),x=c(""),H=e=>{const{taskId:s,fileId:a,execDeviceCode:o,execUserName:r}=t;if("start"!==e||l.isLock)"end"===e&&x.value&&O({id:x.value,finishTime:w().format("YYYY-MM-DD HH:mm:ss")}).then((e=>{e&&k!=e&&(E(),l.isLock=!1)}));else{const e={taskId:s,fileId:a,deviceCode:o,userName:r,source:"HSZX",patrolType:"6",startTime:w().format("YYYY-MM-DD HH:mm:ss")};P(e).then((e=>{e&&k!=e&&(x.value=e,I())}))}},{start:I,stop:E}=f((()=>{l.isLock=!0,H("end"),I()}),6e4,{immediate:!1}),M=e=>{switch(console.log("onPlayerEvents",e),e.type){case"play":H("start");break;case"pause":break;case"end":H("end"),E(),l.isLock=!1}},_=function(){E(),H("end"),l.isLock=!1,o.value=!1,i(),Object.keys(t).forEach((e=>{t[e]=""}))};return u((()=>{_()})),(e,s)=>(p(),m(v(h),{width:"960","show-close":!0,center:"","destroy-on-close":"","close-on-click-modal":!1,onClose:_,onRegister:v(r)},{default:y((()=>[b("div",D,[b("img",{src:v(g)(t.posterFileId)||v(j),class:"w-full h-full"},null,8,L),b("audio",{ref:"audioRef",controls:"",class:"w-full h-16 absolute bottom-0",src:a.value,onPlay:s[0]||(s[0]=e=>M({type:"play"})),onPause:s[1]||(s[1]=e=>M({type:"pause"})),onEnded:s[2]||(s[2]=e=>M({type:"end"}))}," 您的浏览器不支持音频播放。 ",40,Y)])])),_:1},8,["onRegister"]))}}))));var H;export{x as _,j as a};
