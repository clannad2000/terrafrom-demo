var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,t=(a,l,r)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[l]=r;import{s as n}from"./DeviceManage-aryRM0Sb.js";import{d as i,z as d,a8 as u,A as c,Y as m,a0 as p,H as g,r as v,o as b,g as f,h as D,e as w,b as h,f as y,u as C,ab as N,c as V,J as _,L as j,a9 as O,$ as x,a1 as R,a6 as P}from"./index-OtYEJMgP.js";import{U as I}from"./index-fHT9WYUA.js";const U={class:"dialog-footer"},$=i((k=((e,a)=>{for(var l in a||(a={}))s.call(a,l)&&t(e,l,a[l]);if(r)for(var l of r(a))o.call(a,l)&&t(e,l,a[l]);return e})({},{name:"ReplaceDialog"}),a(k,l({__name:"ReplaceDialog",emits:["register","confirm"],setup(e,{emit:a}){const[l,{showDialog:r,setDialogProps:s}]=d();let o="";const t=a,[i,{closeDialog:$}]=u((e=>{const{type:a,data:l}=e;if(o=a,"replace"===a){const{id:e,deviceCode:a}=l;Object.assign(H,{oldDeviceCode:a,bindDeviceId:e})}})),k=c(!1),q=c(null),z={newDeviceCode:[{required:!0,message:"请填写设备编码！",trigger:"blur"},{validator(e,a,l){/^[a-z0-9]+$/.test(a)?l():l(new Error("设备编码仅包含数字和小写字母！"))},trigger:"blur"},{max:32,message:"设备编码长度不能超过32位！",trigger:"blur"}],userNames:[{required:!0,message:"请选择审批人员！",trigger:"change"}],reason:[{required:!0,message:"请填写更换原因！",trigger:"blur"},{max:256,message:"更换原因长度不能超过256位！",trigger:"blur"}]},E=e=>{const{personnel:a=[]}=e;x(a)&&(H.userNames=a.map((e=>e.userName)),H.userRealNames=a.map((e=>e.realName)),F.value=a)},S=c(null),A=e=>{var a;e&&(null==(a=S.value)||a.blur(),s({title:"选择人员"}),r(!0,{type:"add",tabs:["principalOrg","outsourceOrg"],isSingle:!0}))},F=m([]),H=p({bindDeviceId:"",userNames:[],userRealNames:[],reason:"",oldDeviceCode:"",newDeviceCode:""}),J=function(){var e;k.value=!1,$(),o="",Object.assign(H,{bindDeviceId:"",userNames:[],userRealNames:[],reason:"",oldDeviceCode:"",newDeviceCode:""}),null==(e=q.value)||e.clearValidate()},K=function(){var e;null==(e=q.value)||e.validate((e=>{return a=this,l=null,r=function*(){if(e){const{bindDeviceId:e,userNames:a,userRealNames:l,reason:r,oldDeviceCode:s,newDeviceCode:i}=H;k.value=!0,"replace"===o?n({bindDeviceId:e,cityUserName:a.join(","),cityRealName:l.join(","),reason:r,oldDeviceCode:s,newDeviceCode:i}).then((e=>{R!==e&&(P.success("提交成功！"),J(),t("confirm"))})).finally((()=>{k.value=!1})):k.value=!1}},new Promise(((e,s)=>{var o=e=>{try{n(r.next(e))}catch(a){s(a)}},t=e=>{try{n(r.throw(e))}catch(a){s(a)}},n=a=>a.done?e(a.value):Promise.resolve(a.value).then(o,t);n((r=r.apply(a,l)).next())}));var a,l,r}))};return g((()=>{J()})),(e,a)=>{const r=v("el-input"),s=v("el-form-item"),t=v("el-option"),n=v("el-select"),d=v("el-button");return b(),f(C(O),{width:"600","show-fullscreen":!1,"show-close":!1,"destroy-on-close":"",center:"",onClose:J,onRegister:C(i)},{footer:D((()=>[w("span",U,[h(d,{class:"basic-button",disabled:k.value,onClick:J},{default:D((()=>[y(" 取消 ")])),_:1},8,["disabled"]),h(d,{class:"basic-button",loading:k.value,onClick:K},{default:D((()=>[y(" 保存 ")])),_:1},8,["loading"])])])),default:D((()=>[h(C(N),{ref_key:"refReplaceForm",ref:q,model:H,rules:z,"label-width":"180px","label-suffix":"："},{default:D((()=>[h(s,{label:"原设备编码"},{default:D((()=>[h(r,{modelValue:H.oldDeviceCode,"onUpdate:modelValue":a[0]||(a[0]=e=>H.oldDeviceCode=e),disabled:""},null,8,["modelValue"])])),_:1}),h(s,{label:"新设备编码",prop:"newDeviceCode"},{default:D((()=>[h(r,{modelValue:H.newDeviceCode,"onUpdate:modelValue":a[1]||(a[1]=e=>H.newDeviceCode=e),clearable:"",maxlength:"32","show-word-limit":"",placeholder:"请填写设备编码",disabled:"edit"===C(o),formatter:e=>e.replace(/^\s*|\s*$|\n/g,""),parser:e=>e.replace(/^\s*|\s*$|\n/g,"")},null,8,["modelValue","disabled","formatter","parser"])])),_:1}),h(s,{label:"地市管控中心审批人",prop:"userNames"},{default:D((()=>[h(n,{ref_key:"refPersonnel",ref:S,modelValue:H.userNames,"onUpdate:modelValue":a[2]||(a[2]=e=>H.userNames=e),multiple:"","collapse-tags":"","collapse-tags-tooltip":"",placeholder:"请选择审批人",onVisibleChange:A},{default:D((()=>[(b(!0),V(_,null,j(F.value,(e=>(b(),f(t,{key:e.userName,label:e.realName,value:e.userName},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),h(s,{label:"更换原因",prop:"reason"},{default:D((()=>[h(r,{modelValue:H.reason,"onUpdate:modelValue":a[3]||(a[3]=e=>H.reason=e),clearable:"",maxlength:"256","show-word-limit":"",rows:4,type:"textarea",placeholder:"请填写更换原因",parser:e=>e.replace(/^\s*|\s*$/g,""),formatter:e=>e.replace(/^\s*|\s*$/g,"")},null,8,["modelValue","parser","formatter"])])),_:1})])),_:1},8,["model"]),h(I,{onRegister:C(l),onConfirm:E},null,8,["onRegister"])])),_:1},8,["onRegister"])}}}))));var k;export{$ as _};
