var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(a,l,o)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[l]=o;import{a as p,p as i}from"./AdminLog-DD6g2Y3j.js";import{d as n}from"./constants-uiyZ18jc.js";import{d as c,A as m,a0 as d,V as u,F as w,r as b,j as g,w as h,o as f,c as k,e as v,b as y,h as x,u as C,a2 as N,J as O,L as V,g as j,f as _,a1 as I}from"./index-OtYEJMgP.js";import{d as L}from"./download-z--BcN7F.js";const S={class:"h-full table-container"},U={class:"flex flex-col h-full gap-y-4"},T=c((z=((e,a)=>{for(var l in a||(a={}))t.call(a,l)&&r(e,l,a[l]);if(o)for(var l of o(a))s.call(a,l)&&r(e,l,a[l]);return e})({},{name:"PatrolLogIndex"}),a(z,l({__name:"index",setup(e){const a=m(!1),l=d({userName:"",taskName:"",cityOrgId:"",taskCityOrgId:"",majorType:"",workRiskLevels:[],ipSource:"",time:n.range.default}),o=m([]),t=d({pageNum:1,pageSize:10,total:0}),s=()=>{a.value=!0;const{pageSize:e,pageNum:s}=t,{userName:r,taskName:i,cityOrgId:n,taskCityOrgId:c,majorType:m,workRiskLevels:d,ipSource:u,time:w}=l,[b,g]=w;p({userName:r,taskName:i,cityOrgId:n,taskCityOrgId:c,majorType:m,workRiskLevels:d,ipSource:u,beginDate:b,endDate:g,pageSize:e,pageNum:s}).then((e=>{if(e&&I!==e){const{rows:a=[],total:l=0}=e;o.value=a,t.total=Number(l)||0}})).finally((()=>{a.value=!1}))},r=()=>{t.pageNum=1,s()},c=()=>{s()},T=()=>{return e=this,o=null,t=function*(){a.value=!0;const{userName:e,taskName:o,cityOrgId:t,taskCityOrgId:s,majorType:r,workRiskLevels:p,ipSource:n,time:c}=l,[m,d]=c;yield i({userName:e,taskName:o,cityOrgId:t,taskCityOrgId:s,majorType:r,workRiskLevels:p,ipSource:n,beginDate:m,endDate:d}).then((e=>{if(e&&(null==e?void 0:e.data)){const a=e.headers["content-disposition"];let l="unknown";a&&(l=window.decodeURI(a.split("=")[1])),L(e.data,l)}})).finally((()=>{a.value=!1}))},new Promise(((a,l)=>{var s=e=>{try{p(t.next(e))}catch(a){l(a)}},r=e=>{try{p(t.throw(e))}catch(a){l(a)}},p=e=>e.done?a(e.value):Promise.resolve(e.value).then(s,r);p((t=t.apply(e,o)).next())}));var e,o,t};return u((()=>{})),w((()=>{s()})),(e,s)=>{const p=b("el-input"),i=b("el-form-item"),m=b("el-option"),d=b("el-select"),u=b("el-date-picker"),w=b("el-button"),I=b("el-form"),L=b("el-table-column"),z=b("el-table"),R=b("el-pagination"),P=g("loading");return h((f(),k("div",S,[v("div",U,[y(I,{inline:!0,"label-suffix":"：",class:"w-full table-query"},{default:x((()=>[y(i,{label:"账号",class:"m-0"},{default:x((()=>[y(p,{modelValue:l.userName,"onUpdate:modelValue":s[0]||(s[0]=e=>l.userName=e),clearable:"",placeholder:"请输入账号",maxlength:"20"},null,8,["modelValue"])])),_:1}),y(i,{label:"任务名称",class:"m-0"},{default:x((()=>[y(p,{modelValue:l.taskName,"onUpdate:modelValue":s[1]||(s[1]=e=>l.taskName=e),clearable:"",placeholder:"请输入任务名称",maxlength:"64"},null,8,["modelValue"])])),_:1}),y(i,{label:"账号所属单位",class:"m-0"},{default:x((()=>[y(d,{modelValue:l.cityOrgId,"onUpdate:modelValue":s[2]||(s[2]=e=>l.cityOrgId=e),placeholder:"请选择账号所属单位",clearable:"",onFocus:C(N)().loadCityOrgByUser},{default:x((()=>[(f(!0),k(O,null,V(C(N)().cityOrgByUser,(e=>(f(),j(m,{key:e.id,value:e.id,label:e.shortName||e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue","onFocus"])])),_:1}),y(i,{label:"计划所属单位",class:"m-0"},{default:x((()=>[y(d,{modelValue:l.taskCityOrgId,"onUpdate:modelValue":s[3]||(s[3]=e=>l.taskCityOrgId=e),placeholder:"请选择计划所属单位",clearable:"",onFocus:C(N)().loadCityOrgByUser},{default:x((()=>[(f(!0),k(O,null,V(C(N)().cityOrgByUser,(e=>(f(),j(m,{key:e.id,value:e.id,label:e.shortName||e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue","onFocus"])])),_:1}),y(i,{label:"专业",class:"m-0"},{default:x((()=>[y(d,{modelValue:l.majorType,"onUpdate:modelValue":s[4]||(s[4]=e=>l.majorType=e),placeholder:"请选择专业",clearable:""},{default:x((()=>[(f(!0),k(O,null,V(C(N)().workerMajorList,(e=>(f(),j(m,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),y(i,{label:"风险等级",class:"m-0"},{default:x((()=>[y(d,{modelValue:l.workRiskLevels,"onUpdate:modelValue":s[5]||(s[5]=e=>l.workRiskLevels=e),placeholder:"请选择风险等级",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:x((()=>[(f(!0),k(O,null,V(C(N)().workRiskLevelList,(e=>(f(),j(m,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),y(i,{label:"巡查方式",class:"m-0"},{default:x((()=>[y(d,{modelValue:l.ipSource,"onUpdate:modelValue":s[6]||(s[6]=e=>l.ipSource=e),placeholder:"请选择巡查方式",clearable:""},{default:x((()=>[y(m,{value:"1",label:"PC端"}),y(m,{value:"0",label:"i国网"})])),_:1},8,["modelValue"])])),_:1}),y(i,{label:"日期",class:"m-0"},{default:x((()=>[y(u,{modelValue:l.time,"onUpdate:modelValue":s[7]||(s[7]=e=>l.time=e),"value-format":"YYYY-MM-DD",type:"daterange","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",clearable:!1,editable:!1,shortcuts:C(n).range.shortcuts,"disabled-date":e=>e.getTime()>Date.now()},null,8,["modelValue","shortcuts","disabled-date"])])),_:1}),y(i,{label:"",class:"m-0"},{default:x((()=>[y(w,{class:"basic-button",onClick:r},{default:x((()=>[_(" 查询 ")])),_:1}),y(w,{class:"basic-button",onClick:T},{default:x((()=>[_(" 导出 ")])),_:1})])),_:1})])),_:1}),y(z,{class:"w-full h-full","show-overflow-tooltip":"",data:o.value},{default:x((()=>[y(L,{prop:"userRealName",align:"center",label:"姓名","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(L,{prop:"userName",align:"center",label:"账号","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(L,{prop:"userCityOrgName",align:"center",label:"账号所属单位","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(L,{prop:"ipSourceName",align:"center",label:"巡查方式","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(L,{prop:"clientIp",align:"center",label:"IP地址","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(L,{prop:"beginTime",align:"center",label:"开始查看时间","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(L,{prop:"endTime",align:"center",label:"结束查看时间","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(L,{prop:"timeLongFormat",align:"center",label:"查看时长","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(L,{prop:"taskName",align:"center",label:"计划名称","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(L,{prop:"taskCityOrgName",align:"center",label:"计划所属单位","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(L,{prop:"fzrRealName",align:"center",label:"工作负责人","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(L,{prop:"taskBeginTime",align:"center",label:"计划开始时间","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(L,{prop:"taskEndTime",align:"center",label:"计划结束时间","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(L,{prop:"workRiskLevelName",align:"center",label:"风险等级","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(L,{prop:"majorTypeName",align:"center",label:"专业","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(L,{prop:"videoTimeLongFormat",align:"center",label:"视频时长","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}})])),_:1},8,["data"]),y(R,{"current-page":t.pageNum,"onUpdate:currentPage":s[8]||(s[8]=e=>t.pageNum=e),"page-size":t.pageSize,"onUpdate:pageSize":s[9]||(s[9]=e=>t.pageSize=e),background:"",small:"",layout:"total, sizes, prev, pager, next, jumper",total:t.total,"page-sizes":[10,20,30,40,50,100],onSizeChange:r,onCurrentChange:c},null,8,["current-page","page-size","total"])])])),[[P,a.value]])}}}))));var z;export{T as _};
