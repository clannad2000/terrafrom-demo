var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,n=(e,a,l)=>new Promise(((t,s)=>{var o=e=>{try{n(l.next(e))}catch(a){s(a)}},r=e=>{try{n(l.throw(e))}catch(a){s(a)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(o,r);n((l=l.apply(e,a)).next())}));import{D as i,E as u,F as p,G as c}from"./StatisticalCenter-fzPo9Omj.js";import{d as v,z as d,A as f,a0 as m,Y as w,n as g,at as b,r as k,o as h,c as x,e as y,J as D,L as R,t as j,I as S,b as C,h as L,u as P,a2 as O,g as N,v as _,N as E,a5 as I,R as z,U as V,a1 as A,X as F,_ as M}from"./index-OtYEJMgP.js";import{d as T}from"./constants-uiyZ18jc.js";import{u as U}from"./useAutoScroll-cuZfK63C.js";import q from"./PlanPatrolLogDialog-lCr0vTO6.js";import G from"./RankDialog--2etTBfW.js";const J={class:"item"},W={class:"item-title gap-x-4"},X=(e=>(z("data-v-3a720287"),e=e(),V(),e))((()=>y("span",{class:"item-title-text"},"作业计划巡查排名",-1))),Y={class:"flex-1 flex flex-row justify-end gap-x-4"},B={class:"flex flex-row"},H=["onClick"],K={class:"btn-text"},Q={class:"flex-1 flex flex-row"},Z={class:"item-content table-container gap-y-2"},$={class:"w-full flex flex-row items-center justify-end"},ee={class:"text-white text-sm"},ae={class:"text-[#00e7e8] text-sm font-bold"},le={class:"flex-1 flex w-full"},te=v((se=((e,a)=>{for(var l in a||(a={}))s.call(a,l)&&r(e,l,a[l]);if(t)for(var l of t(a))o.call(a,l)&&r(e,l,a[l]);return e})({},{name:"PlanPatrolRank"}),oe={__name:"index",props:{ipSource:{default:""},beginDate:{default:T.range.default[0]},endDate:{default:T.range.default[1]}},setup(e,{expose:a}){const l=e,[t,{showDialog:s,setDialogProps:o}]=d(),[r,{showDialog:v,setDialogProps:z}]=d(),V=[{label:"次数",value:"num"},{label:"时长",value:"duration"}],M=f("num"),T=m({ipSource:"",beginDate:"",endDate:"",workRiskLevels:[]}),te=w(),se=g((()=>te.value.layout.table.refs.bodyWrapper.firstElementChild.firstElementChild)),{start:oe,stop:re}=U({scrollRef:se}),ne=()=>{re()},ie=()=>{pe.value.length>7&&oe()},ue=f(!1),pe=w([]),ce=I((()=>n(this,null,(function*(){const e="num"===M.value?i:"duration"===M.value?u:null;if(!e)return;re(),ue.value=!0,pe.value=[];const{ipSource:a,beginDate:l,endDate:t,workRiskLevels:s}=T;e({ipSource:a,beginDate:l,endDate:t,workRiskLevel:s.join(","),pageNum:1,pageSize:10}).then((e=>{if(A!==e){const{rows:a=[]}=e;pe.value=a,de(),F((()=>{a.length>7&&oe()}))}})).catch((e=>{console.log(e)})).finally((()=>{ue.value=!1}))}))),1e3),ve=f("0"),de=I((()=>n(this,null,(function*(){const e="num"===M.value?p:"duration"===M.value?c:null;if(!e)return;const{ipSource:a,beginDate:l,endDate:t,workRiskLevels:s}=T;e({ipSource:a,beginDate:l,endDate:t,workRiskLevel:s.join(",")}).then((e=>{A!==e&&(ve.value=e||("num"===M.value?"0":"duration"===M.value?"0时0分":""))})).finally((()=>{ue.value=!1}))}))),1e3),fe=e=>{const{taskId:a,taskName:l,cityOrgName:t,orgName:r}=e,{beginDate:n,endDate:i,ipSource:u}=T,p={taskId:a,taskName:l,cityOrgName:t,orgName:r,beginDate:n,endDate:i,ipSource:u};o({title:"作业计划巡查明细"}),s(!0,{type:"view",data:p})},me=()=>{const{ipSource:e,beginDate:a,endDate:l,workRiskLevels:t}=T,s={ipSource:e,beginDate:a,endDate:l,workRiskLevels:t,rankType:M.value};z({title:"作业计划巡查排名"}),v(!0,{type:"view",data:s})};return b((()=>l),(()=>{const{ipSource:e,beginDate:a,endDate:t}=l;Object.assign(T,{beginDate:a,endDate:t,ipSource:e})}),{deep:!0,immediate:!0}),a({loadData:ce}),(e,a)=>{const l=k("el-option"),s=k("el-select"),o=k("el-form-item"),n=k("el-form"),i=k("el-table-column"),u=k("el-table"),p=k("el-auto-resizer");return h(),x("div",J,[y("div",W,[X,y("div",Y,[y("div",B,[(h(),x(D,null,R(V,(e=>y("div",{key:e.value,class:j(["tab-btn cursor-pointer",{active:M.value===e.value}]),onClick:a=>{return l=e.value,M.value=l,ve.value="num"===M.value?"0":"duration"===M.value?"0时0分":"",pe.value=[],void ce();var l}},[y("span",K,S(e.label),1)],10,H))),64))]),y("div",Q,[C(n,{inline:!0,"label-suffix":"：",class:"w-full table-query"},{default:L((()=>[C(o,{class:"m-0"},{default:L((()=>[C(s,{modelValue:T.workRiskLevels,"onUpdate:modelValue":a[0]||(a[0]=e=>T.workRiskLevels=e),placeholder:"请选择作业风险等级",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",onChange:P(ce)},{default:L((()=>[(h(!0),x(D,null,R(P(O)().workRiskLevelList,(e=>(h(),N(l,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1})])),_:1})])]),y("span",{class:"text-[#02e8ff] text-sm cursor-pointer",onClick:me},"更多>>>")]),y("div",Z,[y("div",$,[y("span",ee,S("num"===M.value?"巡查次数：":"duration"===M.value?"巡查时长：":""),1),y("span",ae,S(ve.value),1)]),y("div",le,[C(p,null,{default:L((({height:e,width:a})=>[C(u,{ref_key:"tableRef",ref:te,class:"cursor-pointer",height:e,data:pe.value,"show-overflow-tooltip":"",style:_({width:a+"px"}),onMouseover:ne,onMouseleave:ie,onRowClick:fe},{default:L((()=>[C(i,{type:"index",label:"排名",width:"80",align:"center"}),C(i,{prop:"taskName",align:"center",label:"计划名称","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),C(i,{prop:"majorTypeName",align:"center",label:"专业","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),C(i,{prop:"workRiskLevelName",align:"center",label:"风险等级","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),"duration"==M.value?(h(),N(i,{key:0,prop:"durationFormat",align:"center",label:"巡查时长","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}})):E("",!0),"num"==M.value?(h(),N(i,{key:1,prop:"count",align:"center",label:"巡查次数","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}})):E("",!0)])),_:2},1032,["height","data","style"])])),_:1})])]),C(q,{onRegister:P(t)},null,8,["onRegister"]),C(G,{onRegister:P(r)},null,8,["onRegister"])])}}},a(se,l(oe))));var se,oe;const re=M(te,[["__scopeId","data-v-3a720287"]]);export{re as default};
