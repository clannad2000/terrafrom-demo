var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,n=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,i=(e,a,t)=>new Promise(((l,s)=>{var o=e=>{try{i(t.next(e))}catch(a){s(a)}},n=e=>{try{i(t.throw(e))}catch(a){s(a)}},i=e=>e.done?l(e.value):Promise.resolve(e.value).then(o,n);i((t=t.apply(e,a)).next())}));import{d as r,A as c,a0 as p,Y as u,a8 as f,H as d,r as h,o as g,g as m,h as x,e as w,b as v,u as b,aa as y,f as k,I,v as _,a9 as j,a5 as C,aN as z,a6 as N,a1 as O,R as P,U as S,_ as D}from"./index-OtYEJMgP.js";import{h as R,i as W,j as E}from"./ElectronicFence-d-yifEca.js";const U=e=>(P("data-v-87bad1c6"),e=e(),S(),e),V={class:"w-full h-[540px] grid grid-cols-2 content-body"},F={class:"content-item h-full flex flex-col p-2 gap-y-4"},L={class:"flex flex-row items-center justify-between"},q=U((()=>w("div",null,[w("span",{class:"text-white text-sm"},"未关联计划")],-1))),A={class:"flex flex-row items-center gap-x-2"},H=U((()=>w("span",{class:"text-white text-sm"},"总共",-1))),Y={class:"text-[#00e8ff] text-base"},B=U((()=>w("span",{class:"text-white text-sm"},"个",-1))),G={class:"flex-1 flex flex-row"},J={class:"content-item h-full flex flex-col p-2 gap-y-4"},K={class:"flex flex-row items-center justify-between"},M=U((()=>w("div",null,[w("span",{class:"text-white text-sm"},"已关联计划")],-1))),Q={class:"flex flex-row items-center gap-x-2"},T=U((()=>w("span",{class:"text-white text-sm"},"总共",-1))),X={class:"text-[#00e8ff] text-base"},Z=U((()=>w("span",{class:"text-white text-sm"},"个",-1))),$={class:"flex-1 flex flex-row"},ee={class:"flex flex-row items-center justify-center mt-4"},ae=r((te=((e,a)=>{for(var t in a||(a={}))s.call(a,t)&&n(e,t,a[t]);if(l)for(var t of l(a))o.call(a,t)&&n(e,t,a[t]);return e})({},{name:"PlanLinkDialog"}),a(te,t({__name:"PlanLinkDialog",emits:["register","confirm"],setup(e,{emit:a}){const t=c(!1),l=p({keyWord:"",fenceId:""}),s=p({pageNum:1,pageSize:10,total:0}),o=()=>{D()},n=()=>{s.pageNum=1,D()},r=()=>{s.pageNum=1,D()},P=c(!1),S=u([]),D=C((()=>i(this,null,(function*(){P.value=!0,S.value=[];const{pageSize:e,pageNum:a}=s,{keyWord:t,fenceId:o}=l;o&&(yield W({pageSize:e,pageNum:a,keyWord:t,fenceId:o}).then((e=>{if(O!==e){const{rows:a=[],total:t=0}=e;S.value=a,s.total=Number(t)||0}})).finally((()=>{P.value=!1})))}))),1e3),U=c(!1),ae=c([]),te=C((()=>i(this,null,(function*(){U.value=!0,ae.value=[];const{fenceId:e}=l;e&&(yield E({fenceId:e}).then((e=>{O!==e&&(ae.value=e||[])})).finally((()=>{U.value=!1})))}))),1e3),le=()=>{t.value=!0;const e=ae.value.map((e=>e.taskId)).join(","),{fenceId:a}=l;a&&R({fenceId:a,taskIds:e}).then((e=>{O!==e&&(N.success("关联计划成功！"),ie(),se("confirm"))})).finally((()=>{t.value=!1}))},se=a,[oe,{closeDialog:ne}]=f((e=>{const{type:a,data:t}=e;"edit"===a&&(Object.keys(t).forEach((e=>{l[e]=t[e]})),U.value=!0,r(),te())})),ie=function(){t.value=!1,ne(),Object.keys(l).forEach((e=>{l[e]=""})),S.value=[],ae.value=[]};return d((()=>{ie()})),(e,a)=>{const t=h("el-button"),i=h("el-input"),c=h("el-form-item"),p=h("el-form"),u=h("el-table-column"),f=h("el-table"),d=h("el-auto-resizer"),C=h("el-pagination");return g(),m(b(j),{width:"60%","show-close":!1,center:"","destroy-on-close":"","close-on-click-modal":!1,onClose:ie,onRegister:b(oe)},{default:x((()=>[w("div",V,[w("div",F,[v(p,{ref:"searchFormRef",inline:!0,class:"w-full table-query"},{default:x((()=>[v(c,{class:"col-span-3 m-0"},{default:x((()=>[v(i,{modelValue:l.keyWord,"onUpdate:modelValue":a[0]||(a[0]=e=>l.keyWord=e),placeholder:"请输入计划名称/ID搜索",clearable:""},{prepend:x((()=>[v(t,{icon:b(y)},null,8,["icon"])])),append:x((()=>[v(t,{class:"search-text",onClick:r},{default:x((()=>[k("搜索")])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},512),w("div",L,[q,w("div",A,[H,w("span",Y,I(s.total),1),B])]),w("div",G,[v(d,null,{default:x((({height:e,width:a})=>[v(f,{ref:"tableRef",class:"cursor-pointer",height:e,data:S.value,"show-overflow-tooltip":"",style:_({width:a+"px"})},{default:x((()=>[v(u,{prop:"taskName",align:"center",label:"计划名称","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),v(u,{prop:"taskId",align:"center",label:"计划ID","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),v(u,{fixed:"right",label:"操作",width:"80",align:"center"},{default:x((({row:e})=>[v(t,{type:"primary",link:"",onClick:a=>(e=>{-1===z(ae.value,(a=>a.taskId===e.taskId))?ae.value.push(e):N.warning("该计划已关联！")})(e)},{default:x((()=>[k(" 关联 ")])),_:2},1032,["onClick"])])),_:1})])),_:2},1032,["height","data","style"])])),_:1})]),v(C,{ref:"paginationRef","current-page":s.pageNum,"onUpdate:currentPage":a[1]||(a[1]=e=>s.pageNum=e),"page-size":s.pageSize,"onUpdate:pageSize":a[2]||(a[2]=e=>s.pageSize=e),small:"",background:"",layout:"total, sizes, prev, pager, next",total:s.total,"pager-count":5,"page-sizes":[10,20,30,40,50,100],onSizeChange:n,onCurrentChange:o},null,8,["current-page","page-size","total"])]),w("div",J,[w("div",K,[M,w("div",Q,[T,w("span",X,I(ae.value.length),1),Z])]),w("div",$,[v(d,null,{default:x((({height:e,width:a})=>[v(f,{ref:"tableRef",class:"cursor-pointer",height:e,data:ae.value,"show-overflow-tooltip":"",style:_({width:a+"px"})},{default:x((()=>[v(u,{prop:"taskName",align:"center",label:"计划名称","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),v(u,{prop:"taskId",align:"center",label:"计划ID","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),v(u,{fixed:"right",label:"操作",width:"120",align:"center"},{default:x((({row:e})=>[v(t,{type:"primary",link:"",onClick:a=>(e=>{const{taskId:a}=e,t=ae.value.filter((e=>e.taskId!==a));ae.value=t})(e)},{default:x((()=>[k(" 删除 ")])),_:2},1032,["onClick"])])),_:1})])),_:2},1032,["height","data","style"])])),_:1})])])]),w("div",ee,[v(t,{class:"basic-button",onClick:ie},{default:x((()=>[k(" 取消 ")])),_:1}),v(t,{class:"basic-button",loading:U.value,onClick:le},{default:x((()=>[k(" 保存 ")])),_:1},8,["loading"])])])),_:1},8,["onRegister"])}}}))));var te;const le=D(ae,[["__scopeId","data-v-87bad1c6"]]);export{le as default};
