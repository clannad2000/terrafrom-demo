import{b as e,c as a}from"./PlanManage-UfdB-sAa.js";import{d as l,a8 as t,A as s,a0 as o,Y as n,H as r,r as i,o as p,g as c,h as u,e as d,b as m,u as g,a2 as f,c as w,J as b,L as h,f as v,a9 as y,a1 as x}from"./index-OtYEJMgP.js";import{a as k}from"./constants-uiyZ18jc.js";import{d as I}from"./download-z--BcN7F.js";const C={class:"flex flex-col w-full h-full gap-y-4"},_=l({__name:"ViewPatrolDetailDialog",emits:["register","confirm"],setup(l,{emit:_}){const[z,{closeDialog:O}]=t((e=>{const{type:a,data:l}=e;"view"===a&&(V.taskId=l.taskId,P())})),N=s(!1),V=o({taskId:"",name:"",cityOrgId:"",time:k.range.default}),D=n([]),S=o({pageNum:1,pageSize:10,total:0}),j=()=>{N.value=!0;const{pageSize:a,pageNum:l}=S,{taskId:t,name:s,cityOrgId:o,time:n=[]}=V,[r="",i=""]=n;e({taskId:t,name:s,cityOrgId:o,beginDate:r,endDate:i,pageSize:a,pageNum:l}).then((e=>{if(e&&x!==e){const{rows:a=[],total:l=0}=e;D.value=a,S.total=Number(l)||0}})).finally((()=>{N.value=!1}))},P=()=>{S.pageNum=1,j()},U=()=>{j()},Y=()=>{return e=this,l=null,t=function*(){N.value=!0;const{taskId:e,name:l,cityOrgId:t,time:s=[]}=V,[o="",n=""]=s;yield a({taskId:e,name:l,cityOrgId:t,beginDate:o,endDate:n}).then((e=>{if(e&&(null==e?void 0:e.data)){const a=e.headers["content-disposition"];let l="unknown";a&&(l=window.decodeURI(a.split("=")[1])),I(e.data,l)}})).finally((()=>{N.value=!1}))},new Promise(((a,s)=>{var o=e=>{try{r(t.next(e))}catch(a){s(a)}},n=e=>{try{r(t.throw(e))}catch(a){s(a)}},r=e=>e.done?a(e.value):Promise.resolve(e.value).then(o,n);r((t=t.apply(e,l)).next())}));var e,l,t},F=function(){N.value=!1,O(),Object.keys(V).forEach((e=>{V[e]="time"===e?k.range.default:""})),Object.assign(S,{pageNum:1,pageSize:10,total:0}),D.value=[]};return r((()=>{F()})),(e,a)=>{const l=i("el-input"),t=i("el-form-item"),s=i("el-option"),o=i("el-select"),n=i("el-date-picker"),r=i("el-button"),x=i("el-form"),k=i("el-table-column"),I=i("el-table"),_=i("el-pagination");return p(),c(g(y),{width:"1600","show-fullscreen":!1,"show-close":!0,center:"","destroy-on-close":"",onClose:F,onRegister:g(z)},{default:u((()=>[d("div",C,[m(x,{inline:!0,"label-suffix":"：",class:"w-full table-query"},{default:u((()=>[m(t,{label:"用户",class:"m-0"},{default:u((()=>[m(l,{modelValue:V.name,"onUpdate:modelValue":a[0]||(a[0]=e=>V.name=e),clearable:"",placeholder:"请输入用户姓名/账号",maxlength:"20"},null,8,["modelValue"])])),_:1}),m(t,{label:"市级公司",class:"m-0"},{default:u((()=>[m(o,{modelValue:V.cityOrgId,"onUpdate:modelValue":a[1]||(a[1]=e=>V.cityOrgId=e),placeholder:"请选择市级公司",clearable:"",onFocus:g(f)().loadCityOrg},{default:u((()=>[(p(!0),w(b,null,h(g(f)().cityOrg,(e=>(p(),c(s,{key:e.id,value:e.id,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue","onFocus"])])),_:1}),m(t,{label:"时间",class:"col-span-2 m-0"},{default:u((()=>[m(n,{modelValue:V.time,"onUpdate:modelValue":a[2]||(a[2]=e=>V.time=e),"value-format":"YYYY-MM-DD HH:mm:ss",type:"datetimerange","unlink-panels":"","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",editable:!1,clearable:!1},null,8,["modelValue"])])),_:1}),m(t,{class:"m-0"},{default:u((()=>[m(r,{class:"basic-button",onClick:P},{default:u((()=>[v(" 查询 ")])),_:1}),m(r,{class:"basic-button",onClick:Y},{default:u((()=>[v(" 导出 ")])),_:1})])),_:1})])),_:1}),m(I,{class:"w-full h-96",data:D.value,"show-overflow-tooltip":""},{default:u((()=>[m(k,{prop:"userRealName",align:"center",label:"姓名","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),m(k,{prop:"userName",align:"center",label:"账号","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),m(k,{prop:"userCityOrgName",align:"center",label:"用户所属市级单位","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),m(k,{prop:"clientIp",align:"center",label:"IP地址","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),m(k,{prop:"beginTime",align:"center",label:"开始查看时间","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),m(k,{prop:"endTime",align:"center",label:"结束查看时间","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),m(k,{prop:"timeLongFormat",align:"center",label:"查看时长","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}})])),_:1},8,["data"]),m(_,{"current-page":S.pageNum,"onUpdate:currentPage":a[3]||(a[3]=e=>S.pageNum=e),"page-size":S.pageSize,"onUpdate:pageSize":a[4]||(a[4]=e=>S.pageSize=e),background:"",layout:"total, sizes, prev, pager, next, jumper",total:S.total,"page-sizes":[10,20,30,40,50,100],onSizeChange:P,onCurrentChange:U},null,8,["current-page","page-size","total"])])])),_:1},8,["onRegister"])}}});export{_};
