import{cn as t,_ as e,b as n,aT as a,co as i,cp as r,aS as o,aU as s,cq as d,cr as l,n as u,V as c,A as h,cs as g,p as f,E as p,I as y,aM as v,f as x,b5 as I,ce as L,aA as m,o as _,aB as b,ct as w,cu as T,cf as E,cv as M,cw as S,l as A,Y as D,j as C,M as O,k as R,cx as G,cy as k}from"./installCanvasRenderer-kp6nwiR2.js";import{s as V,g as B,u as F}from"./install-50C6z8uZ.js";var P=1e-8;function U(t,e){return Math.abs(t-e)<P}function j(e,n,a){var i=0,r=e[0];if(!r)return!1;for(var o=1;o<e.length;o++){var s=e[o];i+=t(r[0],r[1],s[0],s[1],n,a),r=s}var d=e[0];return U(r[0],d[0])&&U(r[1],d[1])||(i+=t(r[0],r[1],d[0],d[1],n,a)),0!==i}var N=[];function Y(t,e){for(var n=0;n<t.length;n++)s(t[n],t[n],e)}function X(t,e,n,a){for(var i=0;i<t.length;i++){var r=t[i];a&&(r=a.project(r)),r&&isFinite(r[0])&&isFinite(r[1])&&(d(e,e,r),l(n,n,r))}}var H=function(){function t(t){this.name=t}return t.prototype.setCenter=function(t){this._center=t},t.prototype.getCenter=function(){var t=this._center;return t||(t=this._center=this.calcCenter()),t},t}(),z=function(){return function(t,e){this.type="polygon",this.exterior=t,this.interiors=e}}(),W=function(){return function(t){this.type="linestring",this.points=t}}(),q=function(t){function i(e,n,a){var i=t.call(this,e)||this;return i.type="geoJSON",i.geometries=n,i._center=a&&[a[0],a[1]],i}return e(i,t),i.prototype.calcCenter=function(){for(var t,e=this.geometries,n=0,a=0;a<e.length;a++){var i=e[a],r=i.exterior,o=r&&r.length;o>n&&(t=i,n=o)}if(t)return function(t){for(var e=0,n=0,a=0,i=t.length,r=t[i-1][0],o=t[i-1][1],s=0;s<i;s++){var d=t[s][0],l=t[s][1],u=r*l-d*o;e+=u,n+=(r+d)*u,a+=(o+l)*u,r=d,o=l}return e?[n/e/3,a/e/3,e]:[t[0][0]||0,t[0][1]||0]}(t.exterior);var s=this.getBoundingRect();return[s.x+s.width/2,s.y+s.height/2]},i.prototype.getBoundingRect=function(t){var e=this._rect;if(e&&!t)return e;var i=[Infinity,Infinity],r=[-Infinity,-Infinity],o=this.geometries;return n(o,(function(e){"polygon"===e.type?X(e.exterior,i,r,t):n(e.points,(function(e){X(e,i,r,t)}))})),isFinite(i[0])&&isFinite(i[1])&&isFinite(r[0])&&isFinite(r[1])||(i[0]=i[1]=r[0]=r[1]=0),e=new a(i[0],i[1],r[0]-i[0],r[1]-i[1]),t||(this._rect=e),e},i.prototype.contain=function(t){var e=this.getBoundingRect(),n=this.geometries;if(!e.contain(t[0],t[1]))return!1;t:for(var a=0,i=n.length;a<i;a++){var r=n[a];if("polygon"===r.type){var o=r.exterior,s=r.interiors;if(j(o,t[0],t[1])){for(var d=0;d<(s?s.length:0);d++)if(j(s[d],t[0],t[1]))continue t;return!0}}}return!1},i.prototype.transformTo=function(t,e,i,r){var o=this.getBoundingRect(),s=o.width/o.height;i?r||(r=i/s):i=s*r;for(var d=new a(t,e,i,r),l=o.calculateTransform(d),u=this.geometries,c=0;c<u.length;c++){var h=u[c];"polygon"===h.type?(Y(h.exterior,l),n(h.interiors,(function(t){Y(t,l)}))):n(h.points,(function(t){Y(t,l)}))}(o=this._rect).copy(d),this._center=[o.x+o.width/2,o.y+o.height/2]},i.prototype.cloneShallow=function(t){null==t&&(t=this.name);var e=new i(t,this.geometries,this._center);return e._rect=this._rect,e.transformTo=null,e},i}(H),J=function(t){function n(e,n){var a=t.call(this,e)||this;return a.type="geoSVG",a._elOnlyForCalculate=n,a}return e(n,t),n.prototype.calcCenter=function(){for(var t=this._elOnlyForCalculate,e=t.getBoundingRect(),n=[e.x+e.width/2,e.y+e.height/2],a=i(N),d=t;d&&!d.isGeoSVGGraphicRoot;)r(a,d.getLocalTransform(),a),d=d.parent;return o(a,a),s(n,n,a),n},n}(H);function K(t,e,n){for(var a=0;a<t.length;a++)t[a]=Q(t[a],e[a],n)}function Q(t,e,n){for(var a=[],i=e[0],r=e[1],o=0;o<t.length;o+=2){var s=t.charCodeAt(o)-64,d=t.charCodeAt(o+1)-64;s=s>>1^-(1&s),d=d>>1^-(1&d),i=s+=i,r=d+=r,a.push([s/n,d/n])}return a}function Z(t,e){return t=function(t){if(!t.UTF8Encoding)return t;var e=t,a=e.UTF8Scale;null==a&&(a=1024);var i=e.features;return n(i,(function(t){var e=t.geometry,i=e.encodeOffsets,r=e.coordinates;if(i)switch(e.type){case"LineString":e.coordinates=Q(r,i,a);break;case"Polygon":case"MultiLineString":K(r,i,a);break;case"MultiPolygon":n(r,(function(t,e){return K(t,i[e],a)}))}})),e.UTF8Encoding=!1,e}(t),u(c(t.features,(function(t){return t.geometry&&t.properties&&t.geometry.coordinates.length>0})),(function(t){var a=t.properties,i=t.geometry,r=[];switch(i.type){case"Polygon":var o=i.coordinates;r.push(new z(o[0],o.slice(1)));break;case"MultiPolygon":n(i.coordinates,(function(t){t[0]&&r.push(new z(t[0],t.slice(1)))}));break;case"LineString":r.push(new W([i.coordinates]));break;case"MultiLineString":r.push(new W(i.coordinates))}var s=new q(a[e||"name"],r,a.cp);return s.properties=a,s}))}var $={"南海诸岛":[32,80],"广东":[0,-10],"香港":[10,5],"澳门":[-10,10],"天津":[5,5]};function tt(t,e){if("china"===t){var n=$[e.name];if(n){var a=e.getCenter();a[0]+=n[0]/10.5,a[1]+=-n[1]/14,e.setCenter(a)}}}var et=p();function nt(t){var e=t.mainData,a=t.datas;a||(a={main:e},t.datasAttr={main:"data"}),t.datas=t.mainData=null,dt(e,a,t),n(a,(function(a){n(e.TRANSFERABLE_METHODS,(function(e){a.wrapMethod(e,h(at,t))}))})),e.wrapMethod("cloneShallow",h(rt,t)),n(e.CHANGABLE_METHODS,(function(n){e.wrapMethod(n,h(it,t))})),g(a[e.dataType]===e)}function at(t,e){if(et(a=this).mainData===a){var n=f({},et(this).datas);n[this.dataType]=e,dt(e,n,t)}else lt(e,this.dataType,et(this).mainData,t);var a;return e}function it(t,e){return t.struct&&t.struct.update(),e}function rt(t,e){return n(et(e).datas,(function(n,a){n!==e&&lt(n.cloneShallow(),a,e,t)})),e}function ot(t){var e=et(this).mainData;return null==t||null==e?e:et(e).datas[t]}function st(){var t=et(this).mainData;return null==t?[{data:t}]:u(y(et(t).datas),(function(e){return{type:e,data:et(t).datas[e]}}))}function dt(t,e,a){et(t).datas={},n(e,(function(e,n){lt(e,n,t,a)}))}function lt(t,e,n,a){et(n).datas[e]=t,et(t).mainData=n,t.dataType=e,a.struct&&(t[a.structAttr]=a.struct,a.struct[a.datasAttr[e]]=t),t.getLinkedData=ot,t.getLinkedDataAll=st}function ut(t){return"_EC_"+t}var ct=function(){function t(t){this.type="graph",this.nodes=[],this.edges=[],this._nodesMap={},this._edgesMap={},this._directed=t||!1}return t.prototype.isDirected=function(){return this._directed},t.prototype.addNode=function(t,e){t=null==t?""+e:""+t;var n=this._nodesMap;if(!n[ut(t)]){var a=new ht(t,e);return a.hostGraph=this,this.nodes.push(a),n[ut(t)]=a,a}},t.prototype.getNodeByIndex=function(t){var e=this.data.getRawIndex(t);return this.nodes[e]},t.prototype.getNodeById=function(t){return this._nodesMap[ut(t)]},t.prototype.addEdge=function(t,e,n){var a=this._nodesMap,i=this._edgesMap;if(x(t)&&(t=this.nodes[t]),x(e)&&(e=this.nodes[e]),t instanceof ht||(t=a[ut(t)]),e instanceof ht||(e=a[ut(e)]),t&&e){var r=t.id+"-"+e.id,o=new gt(t,e,n);return o.hostGraph=this,this._directed&&(t.outEdges.push(o),e.inEdges.push(o)),t.edges.push(o),t!==e&&e.edges.push(o),this.edges.push(o),i[r]=o,o}},t.prototype.getEdgeByIndex=function(t){var e=this.edgeData.getRawIndex(t);return this.edges[e]},t.prototype.getEdge=function(t,e){t instanceof ht&&(t=t.id),e instanceof ht&&(e=e.id);var n=this._edgesMap;return this._directed?n[t+"-"+e]:n[t+"-"+e]||n[e+"-"+t]},t.prototype.eachNode=function(t,e){for(var n=this.nodes,a=n.length,i=0;i<a;i++)n[i].dataIndex>=0&&t.call(e,n[i],i)},t.prototype.eachEdge=function(t,e){for(var n=this.edges,a=n.length,i=0;i<a;i++)n[i].dataIndex>=0&&n[i].node1.dataIndex>=0&&n[i].node2.dataIndex>=0&&t.call(e,n[i],i)},t.prototype.breadthFirstTraverse=function(t,e,n,a){if(e instanceof ht||(e=this._nodesMap[ut(e)]),e){for(var i="out"===n?"outEdges":"in"===n?"inEdges":"edges",r=0;r<this.nodes.length;r++)this.nodes[r].__visited=!1;if(!t.call(a,e,null))for(var o=[e];o.length;){var s=o.shift(),d=s[i];for(r=0;r<d.length;r++){var l=d[r],u=l.node1===s?l.node2:l.node1;if(!u.__visited){if(t.call(a,u,s))return;o.push(u),u.__visited=!0}}}}},t.prototype.update=function(){for(var t=this.data,e=this.edgeData,n=this.nodes,a=this.edges,i=0,r=n.length;i<r;i++)n[i].dataIndex=-1;for(i=0,r=t.count();i<r;i++)n[t.getRawIndex(i)].dataIndex=i;e.filterSelf((function(t){var n=a[e.getRawIndex(t)];return n.node1.dataIndex>=0&&n.node2.dataIndex>=0}));for(i=0,r=a.length;i<r;i++)a[i].dataIndex=-1;for(i=0,r=e.count();i<r;i++)a[e.getRawIndex(i)].dataIndex=i},t.prototype.clone=function(){for(var e=new t(this._directed),n=this.nodes,a=this.edges,i=0;i<n.length;i++)e.addNode(n[i].id,n[i].dataIndex);for(i=0;i<a.length;i++){var r=a[i];e.addEdge(r.node1.id,r.node2.id,r.dataIndex)}return e},t}(),ht=function(){function t(t,e){this.inEdges=[],this.outEdges=[],this.edges=[],this.dataIndex=-1,this.id=null==t?"":t,this.dataIndex=null==e?-1:e}return t.prototype.degree=function(){return this.edges.length},t.prototype.inDegree=function(){return this.inEdges.length},t.prototype.outDegree=function(){return this.outEdges.length},t.prototype.getModel=function(t){if(!(this.dataIndex<0))return this.hostGraph.data.getItemModel(this.dataIndex).getModel(t)},t.prototype.getAdjacentDataIndices=function(){for(var t={edge:[],node:[]},e=0;e<this.edges.length;e++){var n=this.edges[e];n.dataIndex<0||(t.edge.push(n.dataIndex),t.node.push(n.node1.dataIndex,n.node2.dataIndex))}return t},t.prototype.getTrajectoryDataIndices=function(){for(var t=I(),e=I(),n=0;n<this.edges.length;n++){var a=this.edges[n];if(!(a.dataIndex<0)){t.set(a.dataIndex,!0);for(var i=[a.node1],r=[a.node2],o=0;o<i.length;){var s=i[o];o++,e.set(s.dataIndex,!0);for(var d=0;d<s.inEdges.length;d++)t.set(s.inEdges[d].dataIndex,!0),i.push(s.inEdges[d].node1)}for(o=0;o<r.length;){var l=r[o];o++,e.set(l.dataIndex,!0);for(d=0;d<l.outEdges.length;d++)t.set(l.outEdges[d].dataIndex,!0),r.push(l.outEdges[d].node2)}}}return{edge:t.keys(),node:e.keys()}},t}(),gt=function(){function t(t,e,n){this.dataIndex=-1,this.node1=t,this.node2=e,this.dataIndex=null==n?-1:n}return t.prototype.getModel=function(t){if(!(this.dataIndex<0))return this.hostGraph.edgeData.getItemModel(this.dataIndex).getModel(t)},t.prototype.getAdjacentDataIndices=function(){return{edge:[this.dataIndex],node:[this.node1.dataIndex,this.node2.dataIndex]}},t.prototype.getTrajectoryDataIndices=function(){var t=I(),e=I();t.set(this.dataIndex,!0);for(var n=[this.node1],a=[this.node2],i=0;i<n.length;){var r=n[i];i++,e.set(r.dataIndex,!0);for(var o=0;o<r.inEdges.length;o++)t.set(r.inEdges[o].dataIndex,!0),n.push(r.inEdges[o].node1)}for(i=0;i<a.length;){var s=a[i];i++,e.set(s.dataIndex,!0);for(o=0;o<s.outEdges.length;o++)t.set(s.outEdges[o].dataIndex,!0),a.push(s.outEdges[o].node2)}return{edge:t.keys(),node:e.keys()}},t}();function ft(t,e){return{getValue:function(n){var a=this[t][e];return a.getStore().get(a.getDimensionIndex(n||"value"),this.dataIndex)},setVisual:function(n,a){this.dataIndex>=0&&this[t][e].setItemVisual(this.dataIndex,n,a)},getVisual:function(n){return this[t][e].getItemVisual(this.dataIndex,n)},setLayout:function(n,a){this.dataIndex>=0&&this[t][e].setItemLayout(this.dataIndex,n,a)},getLayout:function(){return this[t][e].getItemLayout(this.dataIndex)},getGraphicEl:function(){return this[t][e].getItemGraphicEl(this.dataIndex)},getRawIndex:function(){return this[t][e].getRawIndex(this.dataIndex)}}}function pt(t){if(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n].slice());return e}}function yt(t,e){var n=t.label,a=e&&e.getTextGuideLine();return{dataIndex:t.dataIndex,dataType:t.dataType,seriesIndex:t.seriesModel.seriesIndex,text:t.label.style.text,rect:t.hostRect,labelRect:t.rect,align:n.style.align,verticalAlign:n.style.verticalAlign,labelLinePoints:pt(a&&a.shape.points)}}v(ht,ft("hostGraph","data")),v(gt,ft("hostGraph","edgeData"));var vt=["align","verticalAlign","width","height","fontSize"],xt=new k,It=p(),Lt=p();function mt(t,e,n){for(var a=0;a<n.length;a++){var i=n[a];null!=e[i]&&(t[i]=e[i])}}var _t=["x","y","rotation"],bt=function(){function t(){this._labelList=[],this._chartViewList=[]}return t.prototype.clearLabels=function(){this._labelList=[],this._chartViewList=[]},t.prototype._addLabel=function(t,e,n,i,r){var o=i.style,s=i.__hostTarget.textConfig||{},d=i.getComputedTransform(),l=i.getBoundingRect().plain();a.applyTransform(l,l,d),d?xt.setLocalTransform(d):(xt.x=xt.y=xt.rotation=xt.originX=xt.originY=0,xt.scaleX=xt.scaleY=1),xt.rotation=L(xt.rotation);var u,c=i.__hostTarget;if(c){u=c.getBoundingRect().plain();var h=c.getComputedTransform();a.applyTransform(u,u,h)}var g=u&&c.getTextGuideLine();this._labelList.push({label:i,labelLine:g,seriesModel:n,dataIndex:t,dataType:e,layoutOption:r,computedLayoutOption:null,rect:l,hostRect:u,priority:u?u.width*u.height:0,defaultAttr:{ignore:i.ignore,labelGuideIgnore:g&&g.ignore,x:xt.x,y:xt.y,scaleX:xt.scaleX,scaleY:xt.scaleY,rotation:xt.rotation,style:{x:o.x,y:o.y,align:o.align,verticalAlign:o.verticalAlign,width:o.width,height:o.height,fontSize:o.fontSize},cursor:i.cursor,attachedPos:s.position,attachedRot:s.rotation}})},t.prototype.addLabelsOfSeries=function(t){var e=this;this._chartViewList.push(t);var n=t.__model,a=n.get("labelLayout");(m(a)||y(a).length)&&t.group.traverse((function(t){if(t.ignore)return!0;var i=t.getTextContent(),r=_(t);i&&!i.disableLabelLayout&&e._addLabel(r.dataIndex,r.dataType,n,i,a)}))},t.prototype.updateLayoutConfig=function(t){var e=t.getWidth(),n=t.getHeight();function a(t,e){return function(){F(t,e)}}for(var i=0;i<this._labelList.length;i++){var r=this._labelList[i],o=r.label,s=o.__hostTarget,d=r.defaultAttr,l=void 0;l=(l=m(r.layoutOption)?r.layoutOption(yt(r,s)):r.layoutOption)||{},r.computedLayoutOption=l;var u=Math.PI/180;s&&s.setTextConfig({local:!1,position:null!=l.x||null!=l.y?null:d.attachedPos,rotation:null!=l.rotate?l.rotate*u:d.attachedRot,offset:[l.dx||0,l.dy||0]});var c=!1;if(null!=l.x?(o.x=b(l.x,e),o.setStyle("x",0),c=!0):(o.x=d.x,o.setStyle("x",d.style.x)),null!=l.y?(o.y=b(l.y,n),o.setStyle("y",0),c=!0):(o.y=d.y,o.setStyle("y",d.style.y)),l.labelLinePoints){var h=s.getTextGuideLine();h&&(h.setShape({points:l.labelLinePoints}),c=!1)}It(o).needsUpdateLabelLine=c,o.rotation=null!=l.rotate?l.rotate*u:d.rotation,o.scaleX=d.scaleX,o.scaleY=d.scaleY;for(var g=0;g<vt.length;g++){var f=vt[g];o.setStyle(f,null!=l[f]?l[f]:d.style[f])}if(l.draggable){if(o.draggable=!0,o.cursor="move",s){var p=r.seriesModel;if(null!=r.dataIndex)p=r.seriesModel.getData(r.dataType).getItemModel(r.dataIndex);o.on("drag",a(s,p.getModel("labelLine")))}}else o.off("drag"),o.cursor=d.cursor}},t.prototype.layout=function(t){var e=t.getWidth(),n=t.getHeight(),a=w(this._labelList),i=c(a,(function(t){return"shiftX"===t.layoutOption.moveOverlap})),r=c(a,(function(t){return"shiftY"===t.layoutOption.moveOverlap}));T(i,0,e),E(r,0,n);var o=c(a,(function(t){return t.layoutOption.hideOverlap}));M(o)},t.prototype.processLabelsOverall=function(){var t=this;n(this._chartViewList,(function(e){var n=e.__model,a=e.ignoreLabelLineUpdate,i=n.isAnimationEnabled();e.group.traverse((function(e){if(e.ignore&&!e.forceLabelAnimation)return!0;var r=!a,o=e.getTextContent();!r&&o&&(r=It(o).needsUpdateLabelLine),r&&t._updateLabelLine(e,n),i&&t._animateLabels(e,n)}))}))},t.prototype._updateLabelLine=function(t,e){var n=t.getTextContent(),a=_(t),i=a.dataIndex;if(n&&null!=i){var r=e.getData(a.dataType),o=r.getItemModel(i),s={},d=r.getItemVisual(i,"style");if(d){var l=r.getVisual("drawType");s.stroke=d[l]}var u=o.getModel("labelLine");V(t,B(o),s),F(t,u)}},t.prototype._animateLabels=function(t,e){var n=t.getTextContent(),a=t.getTextGuideLine();if(n&&(t.forceLabelAnimation||!n.ignore&&!n.invisible&&!t.disableLabelAnimation&&!S(t))){var i=(g=It(n)).oldLayout,r=_(t),o=r.dataIndex,s={x:n.x,y:n.y,rotation:n.rotation},d=e.getData(r.dataType);if(i){n.attr(i);var l=t.prevStates;l&&(O(l,"select")>=0&&n.attr(g.oldLayoutSelect),O(l,"emphasis")>=0&&n.attr(g.oldLayoutEmphasis)),R(n,s,e,o)}else if(n.attr(s),!A(n).valueAnimation){var u=D(n.style.opacity,1);n.style.opacity=0,C(n,{style:{opacity:u}},e,o)}if(g.oldLayout=s,n.states.select){var c=g.oldLayoutSelect={};mt(c,s,_t),mt(c,n.states.select,_t)}if(n.states.emphasis){var h=g.oldLayoutEmphasis={};mt(h,s,_t),mt(h,n.states.emphasis,_t)}G(n,o,d,e,e)}if(a&&!a.ignore&&!a.invisible){i=(g=Lt(a)).oldLayout;var g,f={points:a.shape.points};i?(a.attr({shape:i}),R(a,{shape:f},e)):(a.setShape(f),a.style.strokePercent=0,C(a,{style:{strokePercent:1}},e)),g.oldLayout=f}},t}(),wt=p();function Tt(t){t.registerUpdateLifecycle("series:beforeupdate",(function(t,e,n){var a=wt(e).labelManager;a||(a=wt(e).labelManager=new bt),a.clearLabels()})),t.registerUpdateLifecycle("series:layoutlabels",(function(t,e,n){var a=wt(e).labelManager;n.updatedSeries.forEach((function(t){a.addLabelsOfSeries(e.getViewOfSeriesModel(t))})),a.updateLayoutConfig(e),a.layout(e),a.processLabelsOverall()}))}export{ct as G,J as a,q as b,j as c,tt as f,Tt as i,nt as l,Z as p};
