var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,n=(e,a,t)=>new Promise(((l,s)=>{var o=e=>{try{n(t.next(e))}catch(a){s(a)}},i=e=>{try{n(t.throw(e))}catch(a){s(a)}},n=e=>e.done?l(e.value):Promise.resolve(e.value).then(o,i);n((t=t.apply(e,a)).next())}));import{d as r,A as c,a0 as p,Y as d,a8 as u,H as f,r as v,o as g,g as h,h as m,e as x,b as w,u as b,aa as y,f as k,I as C,v as _,a9 as j,a5 as z,aN as N,a6 as O,a1 as I,R as P,U as S,_ as R}from"./index-OtYEJMgP.js";import{e as D,f as W,g as E}from"./ElectronicFence-d-yifEca.js";const U=e=>(P("data-v-ca022ac5"),e=e(),S(),e),V={class:"w-full h-[540px] grid grid-cols-2 content-body"},F={class:"content-item h-full flex flex-col p-2 gap-y-4"},L={class:"flex flex-row items-center justify-between"},q=U((()=>x("div",null,[x("span",{class:"text-white text-sm"},"未关联设备")],-1))),A={class:"flex flex-row items-center gap-x-2"},H=U((()=>x("span",{class:"text-white text-sm"},"总共",-1))),Y={class:"text-[#00e8ff] text-base"},B=U((()=>x("span",{class:"text-white text-sm"},"台",-1))),G={class:"flex-1 flex flex-row"},J={class:"content-item h-full flex flex-col p-2 gap-y-4"},K={class:"flex flex-row items-center justify-between"},M=U((()=>x("div",null,[x("span",{class:"text-white text-sm"},"已关联设备")],-1))),Q={class:"flex flex-row items-center gap-x-2"},T=U((()=>x("span",{class:"text-white text-sm"},"总共",-1))),X={class:"text-[#00e8ff] text-base"},Z=U((()=>x("span",{class:"text-white text-sm"},"台",-1))),$={class:"flex-1 flex flex-row"},ee={class:"flex flex-row items-center justify-center mt-4"},ae=r((te=((e,a)=>{for(var t in a||(a={}))s.call(a,t)&&i(e,t,a[t]);if(l)for(var t of l(a))o.call(a,t)&&i(e,t,a[t]);return e})({},{name:"DeviceLinkDialog"}),a(te,t({__name:"DeviceLinkDialog",emits:["register","confirm"],setup(e,{emit:a}){const t=c(!1),l=p({keyWord:"",fenceId:""}),s=p({pageNum:1,pageSize:10,total:0}),o=()=>{R()},i=()=>{s.pageNum=1,R()},r=()=>{s.pageNum=1,R()},P=c(!1),S=d([]),R=z((()=>n(this,null,(function*(){P.value=!0,S.value=[];const{pageSize:e,pageNum:a}=s,{keyWord:t}=l;yield W({pageSize:e,pageNum:a,keyWord:t}).then((e=>{if(I!==e){const{rows:a=[],total:t=0}=e;S.value=a,s.total=Number(t)||0}})).finally((()=>{P.value=!1}))}))),1e3),U=c(!1),ae=c([]),te=z((()=>n(this,null,(function*(){U.value=!0,ae.value=[];const{fenceId:e}=l;e&&(yield E({fenceId:e}).then((e=>{I!==e&&(ae.value=e||[])})).finally((()=>{U.value=!1})))}))),1e3),le=()=>{t.value=!0;const e=ae.value.map((e=>e.deviceCode)).join(","),{fenceId:a}=l;a&&D({fenceId:a,deviceCodes:e}).then((e=>{I!==e&&(O.success("关联设备成功！"),ne(),se("confirm"))})).finally((()=>{t.value=!1}))},se=a,[oe,{closeDialog:ie}]=u((e=>{const{type:a,data:t}=e;"edit"===a&&(Object.keys(t).forEach((e=>{l[e]=t[e]})),U.value=!0,r(),te())})),ne=function(){t.value=!1,ie(),Object.keys(l).forEach((e=>{l[e]=""})),S.value=[],ae.value=[]};return f((()=>{ne()})),(e,a)=>{const t=v("el-button"),n=v("el-input"),c=v("el-form-item"),p=v("el-form"),d=v("el-table-column"),u=v("el-table"),f=v("el-auto-resizer"),z=v("el-pagination");return g(),h(b(j),{width:"60%","show-close":!1,center:"","destroy-on-close":"","close-on-click-modal":!1,onClose:ne,onRegister:b(oe)},{default:m((()=>[x("div",V,[x("div",F,[w(p,{ref:"searchFormRef",inline:!0,class:"w-full table-query"},{default:m((()=>[w(c,{class:"col-span-3 m-0"},{default:m((()=>[w(n,{modelValue:l.keyWord,"onUpdate:modelValue":a[0]||(a[0]=e=>l.keyWord=e),placeholder:"请输入设备名称/编码搜索",clearable:""},{prepend:m((()=>[w(t,{icon:b(y)},null,8,["icon"])])),append:m((()=>[w(t,{class:"search-text",onClick:r},{default:m((()=>[k("搜索")])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},512),x("div",L,[q,x("div",A,[H,x("span",Y,C(s.total),1),B])]),x("div",G,[w(f,null,{default:m((({height:e,width:a})=>[w(u,{ref:"tableRef",class:"cursor-pointer",height:e,data:S.value,"show-overflow-tooltip":"",style:_({width:a+"px"})},{default:m((()=>[w(d,{prop:"deviceName",align:"center",label:"设备名称","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),w(d,{prop:"deviceCode",align:"center",label:"设备编码","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),w(d,{fixed:"right",label:"操作",width:"80",align:"center"},{default:m((({row:e})=>[w(t,{type:"primary",link:"",onClick:a=>(e=>{-1===N(ae.value,(a=>a.deviceCode===e.deviceCode))?ae.value.push(e):O.warning("该设备已关联！")})(e)},{default:m((()=>[k(" 关联 ")])),_:2},1032,["onClick"])])),_:1})])),_:2},1032,["height","data","style"])])),_:1})]),w(z,{ref:"paginationRef","current-page":s.pageNum,"onUpdate:currentPage":a[1]||(a[1]=e=>s.pageNum=e),"page-size":s.pageSize,"onUpdate:pageSize":a[2]||(a[2]=e=>s.pageSize=e),small:"",background:"",layout:"total, sizes, prev, pager, next",total:s.total,"pager-count":5,"page-sizes":[10,20,30,40,50,100],onSizeChange:i,onCurrentChange:o},null,8,["current-page","page-size","total"])]),x("div",J,[x("div",K,[M,x("div",Q,[T,x("span",X,C(ae.value.length),1),Z])]),x("div",$,[w(f,null,{default:m((({height:e,width:a})=>[w(u,{ref:"tableRef",class:"cursor-pointer",height:e,data:ae.value,"show-overflow-tooltip":"",style:_({width:a+"px"})},{default:m((()=>[w(d,{prop:"deviceName",align:"center",label:"设备名称","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),w(d,{prop:"deviceCode",align:"center",label:"设备编码","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),w(d,{fixed:"right",label:"操作",width:"120",align:"center"},{default:m((({row:e})=>[w(t,{type:"primary",link:"",onClick:a=>(e=>{const{deviceCode:a}=e,t=ae.value.filter((e=>e.deviceCode!==a));ae.value=t})(e)},{default:m((()=>[k(" 删除 ")])),_:2},1032,["onClick"])])),_:1})])),_:2},1032,["height","data","style"])])),_:1})])])]),x("div",ee,[w(t,{class:"basic-button",onClick:ne},{default:m((()=>[k(" 取消 ")])),_:1}),w(t,{class:"basic-button",loading:U.value,onClick:le},{default:m((()=>[k(" 保存 ")])),_:1},8,["loading"])])])),_:1},8,["onRegister"])}}}))));var te;const le=R(ae,[["__scopeId","data-v-ca022ac5"]]);export{le as default};
