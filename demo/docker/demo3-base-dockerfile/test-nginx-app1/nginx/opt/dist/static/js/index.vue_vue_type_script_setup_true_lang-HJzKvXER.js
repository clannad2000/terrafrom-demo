var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,r=(a,l,o)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[l]=o,p=(e,a,l)=>new Promise(((o,s)=>{var t=e=>{try{p(l.next(e))}catch(a){s(a)}},r=e=>{try{p(l.throw(e))}catch(a){s(a)}},p=e=>e.done?o(e.value):Promise.resolve(e.value).then(t,r);p((l=l.apply(e,a)).next())}));import{d as n,A as i,a0 as c,Y as m,n as d,F as u,r as g,j as w,w as b,o as f,c as v,e as k,b as h,h as x,a4 as y,u as N,a2 as L,J as j,L as V,g as R,f as _,M as C,a1 as z,a6 as P}from"./index-OtYEJMgP.js";import{g as T,e as U,r as I}from"./PlanManage-UfdB-sAa.js";import{a as O}from"./constants-uiyZ18jc.js";import{d as S}from"./download-z--BcN7F.js";const F={class:"h-full table-container"},M={class:"flex flex-col h-full gap-y-4"},Y=n((q=((e,a)=>{for(var l in a||(a={}))s.call(a,l)&&r(e,l,a[l]);if(o)for(var l of o(a))t.call(a,l)&&r(e,l,a[l]);return e})({},{name:"KeyPlanIndex"}),a(q,l({__name:"index",setup(e){const a=i(!1),l=c({orgId:"",majorTypes:[],workRiskLevels:[],gridRiskLevels:[],workProgress:[],stationName:"",voltageLevels:[],time:O.range.default,taskName:"",fzrRealName:""}),o=m([]),s=c({pageNum:1,pageSize:10,total:0}),t=d((()=>({nodeKey:"id",props:{label:e=>e.shortName||e.name,children:"children"}}))),r=()=>{a.value=!0;const{pageSize:e,pageNum:t}=s,{orgId:r,majorTypes:p,workRiskLevels:n,gridRiskLevels:i,workProgress:c,stationName:m,voltageLevels:d,time:u=[],taskName:g,fzrRealName:w}=l,[b="",f=""]=u;T({orgId:r,majorType:p.join(","),workRiskLevel:n.join(","),gridRiskLevel:i.join(","),workProgress:c.join(","),stationName:m,voltageLevel:d.join(","),beginTime:b,endTime:f,taskName:g,fzrRealName:w,pageSize:e,pageNum:t,queryImportantFlag:"1"}).then((e=>{if(e&&z!==e){const{rows:a=[],total:l=0}=e;o.value=a,s.total=Number(l)||0}})).finally((()=>{a.value=!1}))},n=()=>{s.pageNum=1,r()},Y=()=>p(this,null,(function*(){a.value=!0;const{orgId:e,majorTypes:o,workRiskLevels:s,gridRiskLevels:t,workProgress:r,stationName:p,voltageLevels:n,time:i=[],taskName:c,fzrRealName:m}=l,[d="",u=""]=i;yield U({orgId:e,majorType:o.join(","),workRiskLevel:s.join(","),gridRiskLevel:t.join(","),workProgress:r.join(","),stationName:p,voltageLevel:n.join(","),beginTime:d,endTime:u,taskName:c,fzrRealName:m,queryImportantFlag:"1"}).then((e=>{if(e&&(null==e?void 0:e.data)){const a=e.headers["content-disposition"];let l="unknown";a&&(l=window.decodeURI(a.split("=")[1])),S(e.data,l)}})).finally((()=>{a.value=!1}))})),q=e=>p(this,null,(function*(){a.value=!0;const{taskId:l}=e;yield I({taskId:l}).then((e=>{z!==e&&P.success("移除成功!")})).finally((()=>{a.value=!1,r()}))})),D=()=>{r()};return u((()=>{r()})),(e,r)=>{const p=g("el-tree-select"),i=g("el-form-item"),c=g("el-option"),m=g("el-select"),d=g("el-input"),u=g("el-date-picker"),z=g("el-button"),P=g("el-form"),T=g("el-table-column"),U=g("el-popconfirm"),I=g("el-table"),O=g("el-pagination"),S=w("loading");return b((f(),v("div",F,[k("div",M,[h(P,{inline:!0,"label-suffix":"：",class:"w-full table-query"},{default:x((()=>[h(i,{label:"管理部门",class:"m-0"},{default:x((()=>[h(p,y({modelValue:l.orgId,"onUpdate:modelValue":r[0]||(r[0]=e=>l.orgId=e),data:N(L)().orgTreeByUser,"render-after-expand":!1,clearable:""},t.value,{"check-strictly":!0,"highlight-current":!0,"expand-on-click-node":!1,placeholder:"请选择管理部门",onFocus:N(L)().loadOrgTreeByUser}),null,16,["modelValue","data","onFocus"])])),_:1}),h(i,{label:"专业",class:"m-0"},{default:x((()=>[h(m,{modelValue:l.majorTypes,"onUpdate:modelValue":r[1]||(r[1]=e=>l.majorTypes=e),placeholder:"请选择专业",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:x((()=>[(f(!0),v(j,null,V(N(L)().workerMajorList,(e=>(f(),R(c,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),h(i,{label:"作业风险等级",class:"m-0"},{default:x((()=>[h(m,{modelValue:l.workRiskLevels,"onUpdate:modelValue":r[2]||(r[2]=e=>l.workRiskLevels=e),placeholder:"请选择作业风险等级",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:x((()=>[(f(!0),v(j,null,V(N(L)().workRiskLevelList,(e=>(f(),R(c,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),h(i,{label:"电网风险等级",class:"m-0"},{default:x((()=>[h(m,{modelValue:l.gridRiskLevels,"onUpdate:modelValue":r[3]||(r[3]=e=>l.gridRiskLevels=e),placeholder:"请选择电网风险等级",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:x((()=>[(f(!0),v(j,null,V(N(L)().gridRiskLevelList,(e=>(f(),R(c,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),h(i,{label:"作业状态",class:"m-0"},{default:x((()=>[h(m,{modelValue:l.workProgress,"onUpdate:modelValue":r[4]||(r[4]=e=>l.workProgress=e),placeholder:"请选择作业状态",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:x((()=>[(f(!0),v(j,null,V(N(L)().workProgressList.filter((e=>["2101001","2101002","2101004"].includes(e.code))),(e=>(f(),R(c,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),h(i,{label:"变电站",class:"m-0"},{default:x((()=>[h(d,{modelValue:l.stationName,"onUpdate:modelValue":r[5]||(r[5]=e=>l.stationName=e),clearable:"",placeholder:"请输入变电站",maxlength:"20"},null,8,["modelValue"])])),_:1}),h(i,{label:"电压等级",class:"m-0"},{default:x((()=>[h(m,{modelValue:l.voltageLevels,"onUpdate:modelValue":r[6]||(r[6]=e=>l.voltageLevels=e),placeholder:"请选择电压等级",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:x((()=>[(f(!0),v(j,null,V(N(L)().voltageLevelList,(e=>(f(),R(c,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),h(i,{label:"计划时间",class:"col-span-2 m-0"},{default:x((()=>[h(u,{modelValue:l.time,"onUpdate:modelValue":r[7]||(r[7]=e=>l.time=e),"value-format":"YYYY-MM-DD HH:mm:ss",type:"datetimerange","unlink-panels":"","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",editable:!1,clearable:!1},null,8,["modelValue"])])),_:1}),h(i,{label:"任务名称",class:"m-0"},{default:x((()=>[h(d,{modelValue:l.taskName,"onUpdate:modelValue":r[8]||(r[8]=e=>l.taskName=e),clearable:"",maxlength:"20",placeholder:"请输入任务名称",formatter:e=>e.replace(/^\s*|\s*$/g,""),parser:e=>e.replace(/^\s*|\s*$/g,"")},null,8,["modelValue","formatter","parser"])])),_:1}),h(i,{label:"工作负责人",class:"m-0"},{default:x((()=>[h(d,{modelValue:l.fzrRealName,"onUpdate:modelValue":r[9]||(r[9]=e=>l.fzrRealName=e),clearable:"",placeholder:"请输入工作负责人",maxlength:"20"},null,8,["modelValue"])])),_:1}),h(i,{class:"m-0"},{default:x((()=>[h(z,{class:"basic-button",onClick:n},{default:x((()=>[_(" 查询 ")])),_:1}),h(z,{class:"basic-button",onClick:Y},{default:x((()=>[_(" 导出 ")])),_:1})])),_:1})])),_:1}),h(I,{class:"w-full h-full",data:o.value},{default:x((()=>[h(T,{prop:"cityOrgName",align:"center",label:"市级公司","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),h(T,{prop:"orgName",align:"center",label:"管理部门","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),h(T,{prop:"taskName",align:"center",label:"任务名称","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),h(T,{prop:"stationName",align:"center",label:"变电站名称","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),h(T,{prop:"beginTime",align:"center",label:"计划开始时间","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),h(T,{prop:"endTime",align:"center",label:"计划结束时间","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),h(T,{prop:"majorTypeName",align:"center",label:"所属专业","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),h(T,{prop:"workContent",align:"center",label:"作业内容","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),h(T,{prop:"workRiskLevelName",align:"center",label:"作业风险等级","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),h(T,{prop:"fzrRealName",align:"center",label:"工作负责人","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),h(T,{prop:"fzrPhone",align:"center",label:"联系方式","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),h(T,{prop:"voltageLevelName",align:"center",label:"电压等级","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),h(T,{prop:"sgOrgName",align:"center",label:"施工单位","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),h(T,{prop:"workProgressName",align:"center",label:"作业状态","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),h(T,{fixed:"right",label:"操作",width:"200",align:"center"},{default:x((({row:e})=>[h(U,{title:"确定将该计划从重点计划中移除?",onConfirm:a=>q(e)},{reference:x((()=>[h(z,{link:"",type:"danger",onClick:r[10]||(r[10]=C((()=>{}),["stop"]))},{default:x((()=>[_("移除")])),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"]),h(O,{"current-page":s.pageNum,"onUpdate:currentPage":r[11]||(r[11]=e=>s.pageNum=e),"page-size":s.pageSize,"onUpdate:pageSize":r[12]||(r[12]=e=>s.pageSize=e),background:"",small:"",layout:"total, sizes, prev, pager, next, jumper",total:s.total,"page-sizes":[10,20,30,40,50,100],onSizeChange:n,onCurrentChange:D},null,8,["current-page","page-size","total"])])])),[[S,a.value]])}}}))));var q;export{Y as _};
