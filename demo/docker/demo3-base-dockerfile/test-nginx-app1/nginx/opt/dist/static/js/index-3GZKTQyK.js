var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,i=(a,l,o)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[l]=o;import{l as r,m as p}from"./DeviceManage-aryRM0Sb.js";import{d as n,z as c,n as d,P as u,A as m,a0 as w,V as g,F as h,H as v,r as b,j as f,w as y,o as x,c as C,e as _,b as k,h as j,a4 as T,u as N,a2 as z,J as I,L as V,g as O,f as P,I as S,N as U,a1 as D,_ as R}from"./index-OtYEJMgP.js";import{u as A}from"./useThrottle-fY6V1GyW.js";import{d as F}from"./download-z--BcN7F.js";import{_ as L}from"./ApprovalDialog.vue_vue_type_script_setup_true_lang-RKFERuW6.js";import{_ as M}from"./AuditRecordDialog.vue_vue_type_script_setup_true_lang--UTGC8kp.js";const B={class:"w-full h-full flex flex-col gap-y-4 table-container"},q={class:"flex flex-col h-full gap-y-4"},E=n((H=((e,a)=>{for(var l in a||(a={}))t.call(a,l)&&i(e,l,a[l]);if(o)for(var l of o(a))s.call(a,l)&&i(e,l,a[l]);return e})({},{name:"ReplaceRecordIndex"}),a(H,l({__name:"index",setup(e){const[a,{showDialog:l,setDialogProps:o}]=c(),[t,{showDialog:s,setDialogProps:i}]=c(),n=d((()=>u().getUserInfoState.userName)),R=m(!1),E=w({orgId:"",majorTypes:[],deviceCondition:"",deviceType:""}),H=w({pageNum:1,pageSize:10,total:0}),J=d((()=>({nodeKey:"id",props:{label:e=>e.shortName||e.name,children:"children"}}))),K=m([]),[Q,W]=A((()=>{H.pageNum=1,X()}),800,{debounce:!0}),X=()=>{R.value=!0;const{pageSize:e,pageNum:a}=H,{orgId:l,majorTypes:o=[],deviceCondition:t,deviceType:s}=E;r({orgId:l,majorType:o.join(","),deviceCondition:t,deviceType:s,pageSize:e,pageNum:a}).then((e=>{if(e&&D!==e){const{rows:a=[],total:l=0}=e;K.value=a,H.total=Number(l)||0}})).finally((()=>{R.value=!1}))},$=()=>{return e=this,a=null,l=function*(){R.value=!0;const{orgId:e,majorTypes:a=[],deviceCondition:l,deviceType:o}=E;yield p({orgId:e,majorType:a.join(","),deviceCondition:l,deviceType:o}).then((e=>{if(e&&(null==e?void 0:e.data)){const a=e.headers["content-disposition"];let l="unknown";a&&(l=window.decodeURI(a.split("=")[1])),F(e.data,l)}})).finally((()=>{R.value=!1}))},new Promise(((o,t)=>{var s=e=>{try{r(l.next(e))}catch(a){t(a)}},i=e=>{try{r(l.throw(e))}catch(a){t(a)}},r=e=>e.done?o(e.value):Promise.resolve(e.value).then(s,i);r((l=l.apply(e,a)).next())}));var e,a,l};return g((()=>{})),h((()=>{Q()})),v((()=>{W()})),(e,r)=>{const p=b("el-tree-select"),c=b("el-form-item"),d=b("el-option"),u=b("el-select"),m=b("el-input"),w=b("el-button"),g=b("el-form"),h=b("el-table-column"),v=b("el-table"),D=b("el-pagination"),A=f("loading");return y((x(),C("div",B,[_("div",q,[k(g,{inline:!0,"label-suffix":"：",class:"w-full table-query"},{default:j((()=>[k(c,{label:"管理部门",class:"m-0"},{default:j((()=>[k(p,T({modelValue:E.orgId,"onUpdate:modelValue":r[0]||(r[0]=e=>E.orgId=e),data:N(z)().orgTreeByUser,"render-after-expand":!1,clearable:""},J.value,{"check-strictly":!0,"highlight-current":!0,"expand-on-click-node":!1,placeholder:"请选择管理部门",onFocus:N(z)().loadOrgTreeByUser}),null,16,["modelValue","data","onFocus"])])),_:1}),k(c,{label:"专业",class:"m-0"},{default:j((()=>[k(u,{modelValue:E.majorTypes,"onUpdate:modelValue":r[1]||(r[1]=e=>E.majorTypes=e),placeholder:"请选择专业",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:j((()=>[(x(!0),C(I,null,V(N(z)().workerMajorList,(e=>(x(),O(d,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),k(c,{label:"设备名称",class:"m-0"},{default:j((()=>[k(m,{modelValue:E.deviceCondition,"onUpdate:modelValue":r[2]||(r[2]=e=>E.deviceCondition=e),clearable:"",class:"mb-4",placeholder:"请输入设备名称/编号",maxlength:"20"},null,8,["modelValue"])])),_:1}),k(c,{label:"设备类型",class:"m-0"},{default:j((()=>[k(u,{modelValue:E.deviceType,"onUpdate:modelValue":r[3]||(r[3]=e=>E.deviceType=e),placeholder:"请选择设备类型",clearable:""},{default:j((()=>[(x(!0),C(I,null,V(N(z)().deviceTypeList,(e=>(x(),O(d,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),k(c,{label:"",class:"m-0"},{default:j((()=>[k(w,{class:"basic-button",onClick:N(Q)},{default:j((()=>[P(" 查询 ")])),_:1},8,["onClick"]),k(w,{class:"basic-button",onClick:$},{default:j((()=>[P(" 导出 ")])),_:1})])),_:1})])),_:1}),k(v,{class:"w-full h-full",data:K.value,"show-overflow-tooltip":""},{default:j((()=>[k(h,{type:"index",label:"序号",width:"80",align:"center"},{default:j((e=>[_("span",null,S((H.pageNum-1)*H.pageSize+e.$index+1),1)])),_:1}),k(h,{prop:"cityOrgName",align:"center",label:"市级公司","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),k(h,{prop:"orgName",align:"center",label:"管理部门","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),k(h,{prop:"deviceTypeName",align:"center",label:"设备类型","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),k(h,{prop:"deviceName",align:"center",label:"设备名称","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),k(h,{prop:"oldDeviceCode",align:"center",label:"原设备编码","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),k(h,{prop:"newDeviceCode",align:"center",label:"新设备编码","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),k(h,{prop:"majorTypeName",align:"center",label:"专业","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),k(h,{prop:"registerTime",align:"center",label:"投运时间","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),k(h,{prop:"applyTime",align:"center",label:"申请时间","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),k(h,{prop:"applyRealName",align:"center",label:"申请人","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),k(h,{prop:"auditCityRealName",align:"center",label:"地市审批人","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),k(h,{prop:"reason",align:"center",label:"原因","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),k(h,{fixed:"right",label:"操作",width:"240",align:"center"},{default:j((({row:e})=>[n.value===e.auditCityUserName&&"0"===e.isAudit?(x(),O(w,{key:0,type:"warning",link:"",onClick:a=>(e=>{o({title:"审批"}),l(!0,{type:"approval",data:e})})(e)},{default:j((()=>[P(" 审批 ")])),_:2},1032,["onClick"])):U("",!0),k(w,{type:"primary",link:"",onClick:a=>(e=>{i({title:"审批记录"}),s(!0,{type:"view",data:e})})(e)},{default:j((()=>[P(" 审批记录 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),k(D,{"current-page":H.pageNum,"onUpdate:currentPage":r[4]||(r[4]=e=>H.pageNum=e),"page-size":H.pageSize,"onUpdate:pageSize":r[5]||(r[5]=e=>H.pageSize=e),background:"",small:"",layout:"total, sizes, prev, pager, next, jumper",total:H.total,"page-sizes":[10,20,30,40,50,100],onSizeChange:N(Q),onCurrentChange:X},null,8,["current-page","page-size","total","onSizeChange"])]),k(L,{onRegister:N(a),onConfirm:N(Q)},null,8,["onRegister","onConfirm"]),k(M,{onRegister:N(t)},null,8,["onRegister"])])),[[A,R.value]])}}}))));var H;const J=R(E,[["__scopeId","data-v-d3ab3515"]]);export{J as default};
