var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,t=(a,l,o)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[l]=o;import{b as p,c}from"./JobOverview-wJdELtdM.js";import{d as i,A as n,n as u,a0 as m,a2 as g,Y as d,a8 as w,H as b,r as f,o as k,g as v,h,e as y,b as x,a4 as j,c as N,J as O,L as P,u as C,f as _,a9 as V,a5 as z,a1 as T}from"./index-OtYEJMgP.js";const L={class:"flex-1 flex flex-col gap-y-4 pt-4"},R=i((S=((e,a)=>{for(var l in a||(a={}))s.call(a,l)&&t(e,l,a[l]);if(o)for(var l of o(a))r.call(a,l)&&t(e,l,a[l]);return e})({},{name:"JobPlanDetailDialog"}),a(S,l({__name:"JobPlanDetailDialog",emits:["register","confirm"],setup(e,{emit:a}){const l=n(!1),o=u((()=>"作业计划明细")),s=m({orgId:"",majorTypes:[],workRiskLevels:[],workProgress:[],taskName:"",source:""}),r=m({pageNum:1,pageSize:10,total:0}),t=u((()=>({nodeKey:"id",props:{label:e=>e.shortName||e.name,children:"children"}}))),i=()=>"cityOrg"===s.source?g().loadCityOrgTreeAll():g().loadOrgTreeByUser(),R=u((()=>"cityOrg"===s.source?g().cityOrgTreeAll:g().orgTreeByUser)),S=d([]),U=z((()=>{return e=this,a=null,o=function*(){S.value=[],l.value=!0;const{pageSize:e,pageNum:a}=r,{orgId:o,majorTypes:t,workRiskLevels:i,workProgress:n,taskName:u,source:m}=s;("cityOrg"===m?p:c)({orgId:o,majorType:t.join(","),workRiskLevel:i.join(","),workProgress:n.join(","),taskName:u,pageSize:e,pageNum:a}).then((e=>{if(e&&T!==e){const{rows:a=[],total:l=0}=e;S.value=a,r.total=Number(l)||0}})).finally((()=>{l.value=!1}))},new Promise(((l,s)=>{var r=e=>{try{p(o.next(e))}catch(a){s(a)}},t=e=>{try{p(o.throw(e))}catch(a){s(a)}},p=e=>e.done?l(e.value):Promise.resolve(e.value).then(r,t);p((o=o.apply(e,a)).next())}));var e,a,o}),1e3),I=()=>{r.pageNum=1,U()},D=()=>{I()},J=()=>{U()},[A,{closeDialog:B}]=w((e=>{const{type:a,data:l}=e;"view"===a&&(Object.keys(l).forEach((e=>{s[e]=l[e]})),I())})),E=function(){l.value=!1,B(),Object.assign(s,{cityOrgId:"",orgId:"",majorTypes:[],workRiskLevels:[],workProgress:[],taskName:"",source:""}),Object.assign(r,{pageNum:1,pageSize:10,total:0}),S.value=[]};return b((()=>{E()})),(e,a)=>{const p=f("el-tree-select"),c=f("el-form-item"),n=f("el-option"),u=f("el-select"),m=f("el-input"),d=f("el-button"),w=f("el-form"),b=f("el-table-column"),z=f("el-table"),T=f("el-pagination");return k(),v(C(V),{width:"80%","show-close":!0,center:"","destroy-on-close":"","close-on-click-modal":!1,title:o.value,onClose:E,onRegister:C(A)},{default:h((()=>[y("div",L,[x(w,{ref:"searchFormRef",inline:!0,"label-suffix":"：",class:"w-full table-query"},{default:h((()=>[x(c,{label:"管理部门",class:"m-0"},{default:h((()=>[x(p,j({modelValue:s.orgId,"onUpdate:modelValue":a[0]||(a[0]=e=>s.orgId=e),data:R.value,"render-after-expand":!1,clearable:""},t.value,{"check-strictly":!0,"highlight-current":!0,"expand-on-click-node":!1,placeholder:"请选择管理部门",onFocus:i}),null,16,["modelValue","data"])])),_:1}),x(c,{label:"专业",class:"m-0"},{default:h((()=>[x(u,{modelValue:s.majorTypes,"onUpdate:modelValue":a[1]||(a[1]=e=>s.majorTypes=e),placeholder:"请选择专业",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:h((()=>[(k(!0),N(O,null,P(C(g)().workerMajorList,(e=>(k(),v(n,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),x(c,{label:"作业风险等级",class:"m-0"},{default:h((()=>[x(u,{modelValue:s.workRiskLevels,"onUpdate:modelValue":a[2]||(a[2]=e=>s.workRiskLevels=e),placeholder:"请选择作业风险等级",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:h((()=>[(k(!0),N(O,null,P(C(g)().workRiskLevelList,(e=>(k(),v(n,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),x(c,{label:"作业状态",class:"m-0"},{default:h((()=>[x(u,{modelValue:s.workProgress,"onUpdate:modelValue":a[3]||(a[3]=e=>s.workProgress=e),placeholder:"请选择作业状态",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:h((()=>[(k(!0),N(O,null,P(C(g)().workProgressList.filter((e=>["2101001","2101002","2101004","2101007"].includes(e.code))),(e=>(k(),v(n,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),x(c,{label:"任务名称",class:"m-0"},{default:h((()=>[x(m,{modelValue:s.taskName,"onUpdate:modelValue":a[4]||(a[4]=e=>s.taskName=e),clearable:"",maxlength:"20",placeholder:"请输入任务名称",formatter:e=>e.replace(/^\s*|\s*$/g,""),parser:e=>e.replace(/^\s*|\s*$/g,"")},null,8,["modelValue","formatter","parser"])])),_:1}),x(c,{label:"",class:"m-0"},{default:h((()=>[x(d,{class:"basic-button",loading:l.value,onClick:I},{default:h((()=>[_(" 查询 ")])),_:1},8,["loading"])])),_:1})])),_:1},512),x(z,{class:"w-full h-96",data:S.value,"show-overflow-tooltip":""},{default:h((()=>[x(b,{prop:"cityOrgName",align:"center",label:"市级公司","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),x(b,{prop:"orgName",align:"center",label:"管理部门","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),x(b,{prop:"taskName",align:"center",label:"任务名称","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),x(b,{prop:"majorTypeName",align:"center",label:"所属专业","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),x(b,{prop:"beginTime",align:"center",label:"计划开始时间","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),x(b,{prop:"endTime",align:"center",label:"计划结束时间","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),x(b,{prop:"workContent",align:"center",label:"作业内容","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),x(b,{prop:"workRiskLevelName",align:"center",label:"作业风险等级","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),x(b,{prop:"fzrRealName",align:"center",label:"工作负责人","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),x(b,{prop:"workProgressName",align:"center",label:"作业状态","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}})])),_:1},8,["data"]),x(T,{"current-page":r.pageNum,"onUpdate:currentPage":a[5]||(a[5]=e=>r.pageNum=e),"page-size":r.pageSize,"onUpdate:pageSize":a[6]||(a[6]=e=>r.pageSize=e),background:"",small:"",layout:"total, sizes, prev, pager, next, jumper",total:r.total,"page-sizes":[10,20,30,40,50,100],onSizeChange:D,onCurrentChange:J},null,8,["current-page","page-size","total"])])])),_:1},8,["title","onRegister"])}}}))));var S;export{R as _};
