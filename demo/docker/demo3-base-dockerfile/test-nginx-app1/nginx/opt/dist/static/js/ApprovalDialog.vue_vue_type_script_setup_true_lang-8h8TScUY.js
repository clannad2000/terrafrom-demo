var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(a,l,r)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[l]=r;import{n as u,o as i}from"./DeviceManage-aryRM0Sb.js";import{d as n,z as d,n as m,P as p,A as c,a8 as v,a0 as f,Y as g,H as b,r as N,o as y,g as h,h as O,e as R,b as P,f as _,u as w,ab as j,c as U,J as C,L as V,N as x,a9 as k,$ as D,a1 as I,a6 as A}from"./index-OtYEJMgP.js";import{U as q}from"./index-fHT9WYUA.js";const S={class:"dialog-footer"},$=n((E=((e,a)=>{for(var l in a||(a={}))t.call(a,l)&&o(e,l,a[l]);if(r)for(var l of r(a))s.call(a,l)&&o(e,l,a[l]);return e})({},{name:"ApprovalDialog"}),a(E,l({__name:"ApprovalDialog",emits:["register","confirm"],setup(e,{emit:a}){const[l,{showDialog:r,setDialogProps:t}]=d(),s=m((()=>p().getUserInfoState.userName)),o=c(""),n=a,[$,{closeDialog:E}]=v((e=>{const{type:a,data:l}=e;if("approval"===a){const{id:e,auditCityUserName:a,auditCityRealName:r,auditProvUserName:t,auditProvRealName:u}=l;t||a!=s.value?t==s.value?o.value="prov":o.value="":o.value="city",Object.assign(J,{scrapId:e,auditCityUserName:a,auditCityRealName:r,auditProvUserName:t,auditProvRealName:u})}})),z=c(null),F=c(!1),H=m((()=>({userNames:[{required:!0,message:"请选择审批人员！",trigger:"change"}],auditResult:[{required:!0,message:"请选择审批结果！",trigger:"change"}],auditOpinion:[{required:"0"==J.auditResult,message:"请填写审批意见！",trigger:"blur"},{max:256,message:"审批意见长度不能超过256位！",trigger:"blur"}]}))),J=f({scrapId:"",userNames:[],realNames:[],auditCityUserName:"",auditCityRealName:"",auditProvUserName:"",auditProvRealName:"",auditOpinion:"",auditResult:""}),K=g([]),L=e=>{const{personnel:a=[]}=e;D(a)&&(J.userNames=a.map((e=>e.userName)),J.realNames=a.map((e=>e.realName)),K.value=a)},M=c(null),Q=e=>{var a;e&&(null==(a=M.value)||a.blur(),t({title:"选择人员"}),r(!0,{type:"add",tabs:["principalOrg","outsourceOrg"],isSingle:!0}))},Y=function(){var e;F.value=!1,E(),Object.keys(J).forEach((e=>{J[e]="userNames"===e||"realNames"===e?[]:""})),null==(e=z.value)||e.clearValidate()},B=function(){var e;null==(e=z.value)||e.validate((e=>{return a=this,l=null,r=function*(){if(e){console.log(o.value);const{scrapId:e,auditResult:a,auditOpinion:l,userNames:r,realNames:t}=J;let s={},d=null;"city"==o.value?(s={scrapId:e,auditResult:a,auditOpinion:l,provUserName:r.join(","),provRealName:t.join(",")},d=u):"prov"==o.value&&(s={scrapId:e,auditResult:a,auditOpinion:l},d=i),F.value=!0,d(s).then((e=>{I!==e&&(A.success("审批成功！"),Y(),n("confirm"))})).finally((()=>{F.value=!1}))}},new Promise(((e,t)=>{var s=e=>{try{u(r.next(e))}catch(a){t(a)}},o=e=>{try{u(r.throw(e))}catch(a){t(a)}},u=a=>a.done?e(a.value):Promise.resolve(a.value).then(s,o);u((r=r.apply(a,l)).next())}));var a,l,r}))};return b((()=>{Y()})),(e,a)=>{const r=N("el-option"),t=N("el-select"),s=N("el-form-item"),u=N("el-radio"),i=N("el-radio-group"),n=N("el-input"),d=N("el-button");return y(),h(w(k),{width:"600","show-fullscreen":!1,"show-close-icon":!1,"destroy-on-close":"",onClose:Y,onRegister:w($)},{footer:O((()=>[R("span",S,[P(d,{class:"basic-button",disabled:F.value,onClick:Y},{default:O((()=>[_(" 取消 ")])),_:1},8,["disabled"]),P(d,{class:"basic-button",loading:F.value,onClick:B},{default:O((()=>[_(" 保存 ")])),_:1},8,["loading"])])])),default:O((()=>[P(w(j),{ref_key:"refApprovalForm",ref:z,model:J,rules:H.value,"label-width":"180px","label-suffix":"："},{default:O((()=>["city"==o.value?(y(),h(s,{key:0,label:"省管控中心审批人",prop:"userNames"},{default:O((()=>[P(t,{ref_key:"refPersonnel",ref:M,modelValue:J.userNames,"onUpdate:modelValue":a[0]||(a[0]=e=>J.userNames=e),multiple:"","collapse-tags":"","collapse-tags-tooltip":"",placeholder:"请选择审批人",onVisibleChange:Q},{default:O((()=>[(y(!0),U(C,null,V(K.value,(e=>(y(),h(r,{key:e.userName,label:e.realName,value:e.userName},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):x("",!0),P(s,{label:"审批结果",prop:"auditResult"},{default:O((()=>[P(i,{modelValue:J.auditResult,"onUpdate:modelValue":a[1]||(a[1]=e=>J.auditResult=e),class:"ml-4"},{default:O((()=>[P(u,{label:"1"},{default:O((()=>[_("通过")])),_:1}),P(u,{label:"-1"},{default:O((()=>[_("回退")])),_:1})])),_:1},8,["modelValue"])])),_:1}),P(s,{label:"审批意见",prop:"auditOpinion"},{default:O((()=>[P(n,{modelValue:J.auditOpinion,"onUpdate:modelValue":a[2]||(a[2]=e=>J.auditOpinion=e),clearable:"",maxlength:"256","show-word-limit":"",rows:4,type:"textarea",placeholder:"请填写审批意见",parser:e=>e.replace(/^\s*|\s*$/g,""),formatter:e=>e.replace(/^\s*|\s*$/g,"")},null,8,["modelValue","parser","formatter"])])),_:1})])),_:1},8,["model","rules"]),P(q,{onRegister:w(l),onConfirm:L},null,8,["onRegister"])])),_:1},8,["onRegister"])}}}))));var E;export{$ as _};
