var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(a,l,o)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[l]=o;import{D as p,E as n}from"./StatisticalCenter-fzPo9Omj.js";import{d as i,z as c,n as u,A as d,a0 as m,Y as g,a8 as w,X as b,H as f,r as k,j as h,o as v,g as y,h as x,w as j,c as N,b as C,a4 as R,u as _,a2 as S,J as D,L as T,f as O,e as V,I as z,N as L,a9 as P,a5 as I,a1 as U,_ as Y}from"./index-OtYEJMgP.js";import{d as E}from"./constants-uiyZ18jc.js";import M from"./PlanPatrolLogDialog-lCr0vTO6.js";const A={class:"flex-1 flex flex-col gap-y-2 my-2"},F=i((q=((e,a)=>{for(var l in a||(a={}))t.call(a,l)&&r(e,l,a[l]);if(o)for(var l of o(a))s.call(a,l)&&r(e,l,a[l]);return e})({},{name:"RankDialog"}),a(q,l({__name:"RankDialog",emits:["register","confirm"],setup(e,{emit:a}){const[l,{showDialog:o,setDialogProps:t}]=c(),s=u((()=>({nodeKey:"id",props:{label:e=>e.shortName||e.name,children:"children"}}))),r=d(!1),i=m({rankType:"",condition:"",ipSource:"",orgId:"",majorTypes:[],workRiskLevels:[],time:E.range.default}),Y=m({pageNum:1,pageSize:10,total:0}),F=()=>{Y.pageNum=1,H()},q=g([]),H=I((()=>{return e=this,a=null,l=function*(){const{pageNum:e,pageSize:a}=Y,{rankType:l,condition:o,ipSource:t,orgId:s,majorTypes:c,workRiskLevels:u,time:d}=i,[m,g]=d,w=c.join(","),b=u.join(","),f="num"===l?p:"duration"===l?n:null;f&&(r.value=!0,q.value=[],yield f({condition:o,orgId:s,majorType:w,workRiskLevel:b,beginDate:m,endDate:g,ipSource:t,pageNum:e,pageSize:a}).then((e=>{if(e&&U!==e){const{rows:a,total:l}=e;q.value=a||[],Y.total=Number(l)||0}})).finally((()=>{r.value=!1})))},new Promise(((o,t)=>{var s=e=>{try{p(l.next(e))}catch(a){t(a)}},r=e=>{try{p(l.throw(e))}catch(a){t(a)}},p=e=>e.done?o(e.value):Promise.resolve(e.value).then(s,r);p((l=l.apply(e,a)).next())}));var e,a,l}),1e3),J=e=>{const{taskId:a,taskName:l,cityOrgName:s,orgName:r}=e,{time:p,ipSource:n}=i,[c,u]=p,d={taskId:a,taskName:l,cityOrgName:s,orgName:r,beginDate:c,endDate:u,ipSource:n};t({title:"作业计划巡查明细"}),o(!0,{type:"view",data:d})},[K,{closeDialog:X}]=w((e=>{const{type:a,data:l}=e;if("view"===a){const{rankType:e,beginDate:a,endDate:o,ipSource:t,workRiskLevels:s}=l;Object.assign(i,{rankType:e,time:[a,o],ipSource:t,workRiskLevels:s}),b((()=>{F()}))}})),$=function(){r.value=!1,X(),Object.keys(i).forEach((e=>{["workRiskLevels","majorTypes"].includes(e)?i[e]=[]:i[e]="time"===e?E.range.default:""})),q.value=[]};return f((()=>{$()})),(e,a)=>{const o=k("el-input"),t=k("el-form-item"),p=k("el-tree-select"),n=k("el-option"),c=k("el-select"),u=k("el-date-picker"),d=k("el-button"),m=k("el-form"),g=k("el-table-column"),w=k("el-table"),b=k("el-pagination"),f=h("loading");return v(),y(_(P),{width:"80%","show-close":!0,center:"","destroy-on-close":"","close-on-click-modal":!1,onClose:$,onRegister:_(K)},{default:x((()=>[j((v(),N("div",A,[C(m,{ref:"searchFormRef",inline:!0,"label-suffix":"：",class:"w-full table-query"},{default:x((()=>[C(t,{label:"搜索",class:"m-0"},{default:x((()=>[C(o,{modelValue:i.condition,"onUpdate:modelValue":a[0]||(a[0]=e=>i.condition=e),clearable:"",placeholder:"请输入计划名称/作业人",maxlength:"20"},null,8,["modelValue"])])),_:1}),C(t,{label:"单位",class:"m-0"},{default:x((()=>[C(p,R({modelValue:i.orgId,"onUpdate:modelValue":a[1]||(a[1]=e=>i.orgId=e),data:_(S)().cityOrgTreeAll,"render-after-expand":!1,clearable:""},s.value,{"check-strictly":!0,"highlight-current":!0,"expand-on-click-node":!1,placeholder:"请选择单位"}),null,16,["modelValue","data"])])),_:1}),C(t,{label:"专业",class:"m-0"},{default:x((()=>[C(c,{modelValue:i.majorTypes,"onUpdate:modelValue":a[2]||(a[2]=e=>i.majorTypes=e),placeholder:"请选择专业",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:x((()=>[(v(!0),N(D,null,T(_(S)().workerMajorList,(e=>(v(),y(n,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),C(t,{label:"风险等级",class:"m-0"},{default:x((()=>[C(c,{modelValue:i.workRiskLevels,"onUpdate:modelValue":a[3]||(a[3]=e=>i.workRiskLevels=e),placeholder:"请选择风险等级",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:x((()=>[(v(!0),N(D,null,T(_(S)().workRiskLevelList,(e=>(v(),y(n,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),C(t,{label:"日期",class:"col-span-2 m-0"},{default:x((()=>[C(u,{modelValue:i.time,"onUpdate:modelValue":a[4]||(a[4]=e=>i.time=e),"value-format":"YYYY-MM-DD",type:"daterange","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",editable:!1,clearable:!1},null,8,["modelValue"])])),_:1}),C(t,{label:"",class:"m-0"},{default:x((()=>[C(d,{class:"basic-button",loading:r.value,onClick:F},{default:x((()=>[O(" 查询 ")])),_:1},8,["loading"])])),_:1})])),_:1},512),C(w,{class:"w-full h-[480px] cursor-pointer",data:q.value,onRowClick:J},{default:x((()=>[C(g,{type:"index",label:"排名",width:"80",align:"center"},{default:x((e=>[V("span",null,z((Y.pageNum-1)*Y.pageSize+e.$index+1),1)])),_:1}),C(g,{prop:"cityOrgName",align:"center",label:"所属单位","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),C(g,{prop:"orgName",align:"center",label:"所属组织","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),C(g,{prop:"taskName",align:"center",label:"计划名称","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),C(g,{prop:"majorTypeName",align:"center",label:"专业","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),C(g,{prop:"beginTime",align:"center",label:"计划开始时间","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),C(g,{prop:"endTime",align:"center",label:"计划结束时间","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),C(g,{prop:"workContent",align:"center",label:"作业内容","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),C(g,{prop:"workRiskLevelName",align:"center",label:"风险等级","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),C(g,{prop:"fzrRealName",align:"center",label:"工作负责人","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),"duration"==i.rankType?(v(),y(g,{key:0,prop:"durationFormat",align:"center",label:"巡查时长","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}})):L("",!0),"num"==i.rankType?(v(),y(g,{key:1,prop:"count",align:"center",label:"巡查次数","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}})):L("",!0)])),_:1},8,["data"])])),[[f,r.value]]),C(b,{"current-page":Y.pageNum,"onUpdate:currentPage":a[5]||(a[5]=e=>Y.pageNum=e),"page-size":Y.pageSize,"onUpdate:pageSize":a[6]||(a[6]=e=>Y.pageSize=e),background:"",small:"",layout:"total, sizes, prev, pager, next, jumper",total:Y.total,"page-sizes":[10,20,30,40,50,100],onSizeChange:F,onCurrentChange:_(H)},null,8,["current-page","page-size","total","onCurrentChange"]),C(M,{onRegister:_(l)},null,8,["onRegister"])])),_:1},8,["onRegister"])}}}))));var q;const H=Y(F,[["__scopeId","data-v-1a1e4edf"]]);export{H as default};
