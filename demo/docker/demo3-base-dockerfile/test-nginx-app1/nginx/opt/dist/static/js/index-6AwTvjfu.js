var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,r=(a,t,s)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s,o=(e,a,t)=>new Promise(((s,l)=>{var i=e=>{try{o(t.next(e))}catch(a){l(a)}},r=e=>{try{o(t.throw(e))}catch(a){l(a)}},o=e=>e.done?s(e.value):Promise.resolve(e.value).then(i,r);o((t=t.apply(e,a)).next())}));import{d as n,Y as c,Z as u,n as f,z as p,A as d,a0 as v,at as m,ao as x,r as g,j as y,w,o as h,c as j,e as b,J as k,L as P,u as I,I as _,M as N,f as z,N as D,b as R,v as C,a5 as O,b5 as S,a1 as E,b6 as L,a6 as M,R as U,U as F,b7 as T,b8 as A,X as V,_ as J}from"./index-OtYEJMgP.js";import{E as B}from"./icon_no_data-JkxAPqfn.js";import{i as H,a as X,b as Y}from"./play-gHG0B82O.js";import{c as Z}from"./constants-uiyZ18jc.js";import{u as q}from"./MediaReview-6GObmu50.js";import G from"./PatrolLogDialog-6nyjxg-r.js";import{_ as K}from"./VideoViewerDialog.vue_vue_type_script_setup_true_lang-vCkYEgVT.js";import"./AdminLog-DD6g2Y3j.js";import"./index-mErxNL28.js";import"./mitt-ei5ABelY.js";import"./RecordDialog-dB1vIz0h.js";const Q=e=>(U("data-v-a141d1b3"),e=e(),F(),e),W={key:0,class:"w-full grid grid-cols-3 gap-2 overflow-auto"},$=["onClick"],ee={class:"title"},ae={class:"flex-1 flex flex-row items-center gap-x-2"},te=["src"],se={class:"text-sm truncate"},le={class:"flex flex-row items-center gap-x-4"},ie=["onClick"],re={class:"text-[#00e7e8]"},oe={class:"text-xs"},ne={class:"text-white"},ce={class:"info flex flex-col"},ue={class:"flex flex-row items-center"},fe={class:"task-title-major text-sm"},pe={class:"task-title-name text-sm"},de={class:"flex flex-row items-center justify-between gap-x-4"},ve={class:"flex-1 flex flex-row items-center justify-start"},me=Q((()=>b("div",{class:"min-w-fit text-xs"},"班组：",-1))),xe={class:"truncate text-xs"},ge={class:"flex-1 flex flex-row items-center justify-end"},ye=Q((()=>b("div",{class:"min-w-fit text-xs"},"人员：",-1))),we={class:"truncate text-xs"},he={class:"flex flex-row items-center justify-between gap-x-4"},je={class:"flex-1 flex flex-row items-center justify-start"},be=Q((()=>b("div",{class:"min-w-fit text-xs"},"录制时间：",-1))),ke={class:"truncate text-xs"},Pe={class:"flex-1 flex flex-row items-center justify-end"},Ie=Q((()=>b("div",{class:"min-w-fit text-xs"},"视频时长：",-1))),_e={class:"truncate text-xs"},Ne=["src"],ze=["src"],De={key:1,class:"flex-1 flex flex-row items-center justify-center"},Re=n((Ce=((e,a)=>{for(var t in a||(a={}))l.call(a,t)&&r(e,t,a[t]);if(s)for(var t of s(a))i.call(a,t)&&r(e,t,a[t]);return e})({},{name:"JobPlanMainVideo"}),a(Ce,t({__name:"index",setup(e){const a=c(),t=c(),{height:s}=u(a),{height:l}=u(t),i=f((()=>({width:"100%",height:s.value-l.value-20+"px"}))),[r,{showDialog:n,setDialogProps:U}]=p(),[F,{showDialog:J,setDialogProps:Q}]=p(),Re=c([]),Ce=d(!1),Oe=v({pageNum:1,pageSize:9,total:0}),Se=()=>{Le()},Ee=()=>{const{type:e,value:a={}}=q().jobPlanParams;Re.value=[],Me.value=[],Oe.pageNum=1,"video"===e&&(null==a?void 0:a.taskId)&&Le()},Le=O((()=>o(this,null,(function*(){Ce.value=!0,Re.value=[],Me.value=[];const{pageNum:e,pageSize:a}=Oe,{type:t,isMarked:s,value:{taskId:l=""}}=q().jobPlanParams;if(!l)return;const i={pageNum:e,pageSize:a,taskId:l,fileType:t};"all"!==s&&(i.isMarked=s),yield T(i).then((e=>{if(e&&E!==e){const{rows:a=[],total:t=0}=e;if(Re.value=a,Oe.total=Number(t)||0,a.length){const e=[];a.forEach((a=>{e.push(a.fileId)})),Ue(e.join(","))}}})).finally((()=>{Ce.value=!1}))}))),1e3),Me=c([]),Ue=e=>{Ce.value=!0,Me.value=[],A({fileIds:e}).then((e=>{e&&E!==e&&(Me.value=e||[],V((()=>{Te()})))})).finally((()=>{Ce.value=!1}))},Fe=d({}),Te=()=>{Fe.value={},Ce.value=!0,Me.value.forEach((e=>{const{posterFileId:a}=e;S({fileId:a}).then((e=>{e&&E!==e&&(Fe.value[a]=L(e))}))})),Ce.value=!1},Ae=e=>o(this,null,(function*(){const{fileId:a}=e;yield S({fileId:a}).then((a=>{if(a&&E!==a){const t=L(a);if(!t)return void M.error("获取文件信息失败");e.fileUrl=t,U({title:"视频预览"}),n(!0,{type:"view",data:e})}})).catch((e=>{console.log(e),M.error("获取文件信息失败")})).finally((()=>{}))}));return m((()=>q().jobPlanParams),(()=>{Ee()}),{deep:!0,immediate:!0}),x((()=>{Ee()})),(e,s)=>{const l=g("el-empty"),o=g("el-pagination"),n=y("loading");return w((h(),j("div",{ref_key:"fileContainerRef",ref:a,class:"w-full h-full flex flex-col gap-y-4"},[b("div",{class:"flex flex-col items-center",style:C(i.value)},[Me.value.length?(h(),j("div",W,[(h(!0),j(k,null,P(Me.value,(e=>(h(),j("div",{key:e.fileId,class:"aspect-video file-info relative cursor-pointer",onClick:a=>Ae(e)},[b("div",ee,[b("div",ae,[b("img",{class:"w-7 h-7",src:"100002"==e.uploadType?I(H):"100001"==e.uploadType?I(X):""},null,8,te),b("span",se,_(e.execDeviceName),1)]),b("div",le,[b("div",{class:"text-xs cursor-pointer",onClick:N((a=>(e=>{Q({title:"查看明细"}),J(!0,{type:"view",data:e})})(e)),["stop"])},[z(" 查看次数： "),b("span",re,_(e.logCount||0),1)],8,ie),b("div",oe,[z(" 已标记： "),b("span",ne,_(e.markedCount||0),1)])])]),b("div",ce,[b("div",ue,[b("span",fe,"（"+_(e.majorTypeName)+"）",1),b("span",pe,_(e.taskName),1)]),b("div",de,[b("div",ve,[me,b("div",xe,_(e.orgName),1)]),b("div",ge,[ye,b("div",we,_(e.execUserRealName),1)])]),b("div",he,[b("div",je,[be,b("div",ke,_(e.videoBeginAt),1)]),b("div",Pe,[Ie,b("div",_e,_(I(Z)(Number(e.timeLong)>0?Number(e.timeLong):0)),1)])])]),Fe.value[e.posterFileId]?(h(),j("img",{key:0,src:Fe.value[e.posterFileId],class:"w-full h-full"},null,8,Ne)):D("",!0),b("img",{src:I(Y),class:"w-16 h-16 absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 cursor-pointer"},null,8,ze)],8,$)))),128))])):(h(),j("div",De,[R(l,{description:"暂无数据",image:I(B)},null,8,["image"])]))],4),R(o,{ref_key:"paginationRef",ref:t,"current-page":Oe.pageNum,"onUpdate:currentPage":s[0]||(s[0]=e=>Oe.pageNum=e),"page-size":Oe.pageSize,"onUpdate:pageSize":s[1]||(s[1]=e=>Oe.pageSize=e),small:"",background:"",layout:"total, prev, pager, next",total:Oe.total,onCurrentChange:Se},null,8,["current-page","page-size","total"]),R(K,{onRegister:I(r)},null,8,["onRegister"]),R(G,{onRegister:I(F)},null,8,["onRegister"])])),[[n,Ce.value]])}}}))));var Ce;const Oe=J(Re,[["__scopeId","data-v-a141d1b3"]]);export{Oe as default};
