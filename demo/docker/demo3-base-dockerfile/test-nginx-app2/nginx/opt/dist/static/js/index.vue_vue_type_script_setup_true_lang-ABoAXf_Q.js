var e=Object.defineProperty,l=Object.defineProperties,a=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,r=(l,a,o)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[a]=o;import{g as p,e as i}from"./PlanManage-UfdB-sAa.js";import{d as n,z as c,A as m,a0 as d,Y as u,n as g,F as w,r as b,j as v,w as f,o as k,c as h,e as x,b as y,h as N,a4 as j,u as _,a2 as L,J as V,L as R,g as C,f as P,a1 as z}from"./index-OtYEJMgP.js";import{a as T}from"./constants-uiyZ18jc.js";import{d as U}from"./download-z--BcN7F.js";import O from"./EditPlanDialog-KSr3SMVG.js";import{_ as I}from"./ViewPlanDialog.vue_vue_type_script_setup_true_lang-3QPiaYtk.js";const D={class:"h-full table-container"},S={class:"flex flex-col h-full gap-y-4"},Y=n((F=((e,l)=>{for(var a in l||(l={}))s.call(l,a)&&r(e,a,l[a]);if(o)for(var a of o(l))t.call(l,a)&&r(e,a,l[a]);return e})({},{name:"AllPlanIndex"}),l(F,a({__name:"index",setup(e){const[l,{showDialog:a,setDialogProps:o}]=c(),[s,{showDialog:t,setDialogProps:r}]=c(),n=m(!1),Y=d({orgId:"",majorTypes:[],workRiskLevels:[],gridRiskLevels:[],workProgress:[],stationName:"",voltageLevels:[],time:T.range.default,taskName:"",fzrRealName:""}),F=u([]),M=d({pageNum:1,pageSize:10,total:0}),E=g((()=>({nodeKey:"id",props:{label:e=>e.shortName||e.name,children:"children"}}))),A=()=>{n.value=!0;const{pageSize:e,pageNum:l}=M,{orgId:a,majorTypes:o,workRiskLevels:s,gridRiskLevels:t,workProgress:r,stationName:i,voltageLevels:c,time:m=[],taskName:d,fzrRealName:u}=Y,[g="",w=""]=m;p({orgId:a,majorType:o.join(","),workRiskLevel:s.join(","),gridRiskLevel:t.join(","),workProgress:r.join(","),stationName:i,voltageLevel:c.join(","),beginTime:g,endTime:w,taskName:d,fzrRealName:u,pageSize:e,pageNum:l}).then((e=>{if(e&&z!==e){const{rows:l=[],total:a=0}=e;F.value=l,M.total=Number(a)||0}})).finally((()=>{n.value=!1}))},B=()=>{M.pageNum=1,A()},H=()=>{o({title:"新增计划"}),a(!0,{type:"add",data:null})},$=()=>{return e=this,l=null,a=function*(){n.value=!0;const{orgId:e,majorTypes:l,workRiskLevels:a,gridRiskLevels:o,workProgress:s,stationName:t,voltageLevels:r,time:p=[],taskName:c,fzrRealName:m}=Y,[d="",u=""]=p;yield i({orgId:e,majorType:l.join(","),workRiskLevel:a.join(","),gridRiskLevel:o.join(","),workProgress:s.join(","),stationName:t,voltageLevel:r.join(","),beginTime:d,endTime:u,taskName:c,fzrRealName:m}).then((e=>{if(e&&(null==e?void 0:e.data)){const l=e.headers["content-disposition"];let a="unknown";l&&(a=window.decodeURI(l.split("=")[1])),U(e.data,a)}})).finally((()=>{n.value=!1}))},new Promise(((o,s)=>{var t=e=>{try{p(a.next(e))}catch(l){s(l)}},r=e=>{try{p(a.throw(e))}catch(l){s(l)}},p=e=>e.done?o(e.value):Promise.resolve(e.value).then(t,r);p((a=a.apply(e,l)).next())}));var e,l,a},q=()=>{A()};return w((()=>{A()})),(e,a)=>{const o=b("el-tree-select"),p=b("el-form-item"),i=b("el-option"),c=b("el-select"),m=b("el-input"),d=b("el-date-picker"),u=b("el-button"),g=b("el-form"),w=b("el-table-column"),z=b("el-table"),T=b("el-pagination"),U=v("loading");return f((k(),h("div",D,[x("div",S,[y(g,{inline:!0,"label-suffix":"：",class:"w-full table-query"},{default:N((()=>[y(p,{label:"管理部门",class:"m-0"},{default:N((()=>[y(o,j({modelValue:Y.orgId,"onUpdate:modelValue":a[0]||(a[0]=e=>Y.orgId=e),data:_(L)().orgTreeByUser,"render-after-expand":!1,clearable:""},E.value,{"check-strictly":!0,"highlight-current":!0,"expand-on-click-node":!1,placeholder:"请选择管理部门",onFocus:_(L)().loadOrgTreeByUser}),null,16,["modelValue","data","onFocus"])])),_:1}),y(p,{label:"专业",class:"m-0"},{default:N((()=>[y(c,{modelValue:Y.majorTypes,"onUpdate:modelValue":a[1]||(a[1]=e=>Y.majorTypes=e),placeholder:"请选择专业",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:N((()=>[(k(!0),h(V,null,R(_(L)().workerMajorList,(e=>(k(),C(i,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),y(p,{label:"作业风险等级",class:"m-0"},{default:N((()=>[y(c,{modelValue:Y.workRiskLevels,"onUpdate:modelValue":a[2]||(a[2]=e=>Y.workRiskLevels=e),placeholder:"请选择作业风险等级",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:N((()=>[(k(!0),h(V,null,R(_(L)().workRiskLevelList,(e=>(k(),C(i,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),y(p,{label:"电网风险等级",class:"m-0"},{default:N((()=>[y(c,{modelValue:Y.gridRiskLevels,"onUpdate:modelValue":a[3]||(a[3]=e=>Y.gridRiskLevels=e),placeholder:"请选择电网风险等级",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:N((()=>[(k(!0),h(V,null,R(_(L)().gridRiskLevelList,(e=>(k(),C(i,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),y(p,{label:"作业状态",class:"m-0"},{default:N((()=>[y(c,{modelValue:Y.workProgress,"onUpdate:modelValue":a[4]||(a[4]=e=>Y.workProgress=e),placeholder:"请选择作业状态",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:N((()=>[(k(!0),h(V,null,R(_(L)().workProgressList.filter((e=>["2101001","2101002","2101004"].includes(e.code))),(e=>(k(),C(i,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),y(p,{label:"变电站",class:"m-0"},{default:N((()=>[y(m,{modelValue:Y.stationName,"onUpdate:modelValue":a[5]||(a[5]=e=>Y.stationName=e),clearable:"",placeholder:"请输入变电站",maxlength:"20"},null,8,["modelValue"])])),_:1}),y(p,{label:"电压等级",class:"m-0"},{default:N((()=>[y(c,{modelValue:Y.voltageLevels,"onUpdate:modelValue":a[6]||(a[6]=e=>Y.voltageLevels=e),placeholder:"请选择电压等级",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:N((()=>[(k(!0),h(V,null,R(_(L)().voltageLevelList,(e=>(k(),C(i,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),y(p,{label:"计划时间",class:"col-span-2 m-0"},{default:N((()=>[y(d,{modelValue:Y.time,"onUpdate:modelValue":a[7]||(a[7]=e=>Y.time=e),"value-format":"YYYY-MM-DD HH:mm:ss",type:"datetimerange","unlink-panels":"","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",editable:!1,clearable:!1},null,8,["modelValue"])])),_:1}),y(p,{label:"任务名称",class:"m-0"},{default:N((()=>[y(m,{modelValue:Y.taskName,"onUpdate:modelValue":a[8]||(a[8]=e=>Y.taskName=e),clearable:"",maxlength:"20",placeholder:"请输入任务名称",formatter:e=>e.replace(/^\s*|\s*$/g,""),parser:e=>e.replace(/^\s*|\s*$/g,"")},null,8,["modelValue","formatter","parser"])])),_:1}),y(p,{label:"工作负责人",class:"m-0"},{default:N((()=>[y(m,{modelValue:Y.fzrRealName,"onUpdate:modelValue":a[9]||(a[9]=e=>Y.fzrRealName=e),clearable:"",placeholder:"请输入工作负责人",maxlength:"20"},null,8,["modelValue"])])),_:1}),y(p,{class:"m-0"},{default:N((()=>[y(u,{class:"basic-button",onClick:B},{default:N((()=>[P(" 查询 ")])),_:1}),y(u,{class:"basic-button",onClick:$},{default:N((()=>[P(" 导出 ")])),_:1}),y(u,{class:"basic-button",onClick:H},{default:N((()=>[P(" 新增 ")])),_:1})])),_:1})])),_:1}),y(z,{class:"w-full h-full",data:F.value},{default:N((()=>[y(w,{prop:"cityOrgName",align:"center",label:"市级公司","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(w,{prop:"orgName",align:"center",label:"管理部门","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(w,{prop:"taskName",align:"center",label:"任务名称","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(w,{prop:"stationName",align:"center",label:"变电站名称","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(w,{prop:"beginTime",align:"center",label:"计划开始时间","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(w,{prop:"endTime",align:"center",label:"计划结束时间","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(w,{prop:"majorTypeName",align:"center",label:"所属专业","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(w,{prop:"workContent",align:"center",label:"作业内容","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(w,{prop:"workRiskLevelName",align:"center",label:"作业风险等级","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(w,{prop:"fzrRealName",align:"center",label:"工作负责人","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(w,{prop:"fzrPhone",align:"center",label:"联系方式","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(w,{prop:"voltageLevelName",align:"center",label:"电压等级","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(w,{prop:"sgOrgName",align:"center",label:"施工单位","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(w,{prop:"workProgressName",align:"center",label:"作业状态","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(w,{fixed:"right",label:"操作",width:"200",align:"center"},{default:N((({row:e})=>[y(u,{type:"primary",link:"",onClick:l=>(e=>{r({title:"计划详情"}),t(!0,{type:"view",data:e})})(e)},{default:N((()=>[P(" 详情 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),y(T,{"current-page":M.pageNum,"onUpdate:currentPage":a[10]||(a[10]=e=>M.pageNum=e),"page-size":M.pageSize,"onUpdate:pageSize":a[11]||(a[11]=e=>M.pageSize=e),background:"",small:"",layout:"total, sizes, prev, pager, next, jumper",total:M.total,"page-sizes":[10,20,30,40,50,100],onSizeChange:B,onCurrentChange:q},null,8,["current-page","page-size","total"])]),y(O,{onRegister:_(l),onConfirm:B},null,8,["onRegister"]),y(I,{onRegister:_(s)},null,8,["onRegister"])])),[[U,n.value]])}}}))));var F;export{Y as _};
