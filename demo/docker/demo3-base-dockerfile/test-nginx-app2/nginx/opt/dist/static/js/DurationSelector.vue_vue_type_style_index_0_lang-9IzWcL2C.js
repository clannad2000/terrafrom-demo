import{r as e,d as a,i as t,w as n}from"./weekday-rhQYfdMI.js";import{d as o,ay as l,bS as s,Y as d,A as r,at as u,a6 as i,X as m,r as c,o as p,g as f,N as D}from"./index-OtYEJMgP.js";const y=o({__name:"DurationSelector",props:{dateType:{default:"month"},multiple:{type:Boolean,default:!1}},emits:["onSelectionChange"],setup(o,{emit:y}){l.locale("zh-cn"),l.extend(e),l.extend(a),l.extend(s),l.extend(t),l.extend(n);const Y=o,h=y;const v=d([]),M={multiple:!0},g=r([]),b=()=>{if("month"==Y.dateType)if(Y.multiple){const e=function(){const e=[],a=l();for(let t=6;t>=0;t--){const n=a.subtract(t,"month");e.push({month:n.month()+1,year:n.year(),startDate:n.startOf("month").format("YYYY-MM-DD"),endDate:n.endOf("month").format("YYYY-MM-DD")})}return e}().map((e=>[e.year,e.month]));g.value=e}else{const e=l().month()+1,a=l().year();g.value=[a,e]}else if("week"==Y.dateType)if(Y.multiple){const e=function(){const e=[],a=l();for(let t=6;t>=0;t--){const n=a.startOf("week").subtract(t,"week"),o=n.add(6,"day");e.push({week:n.week(),monday:n.format("YYYY-MM-DD"),sunday:o.format("YYYY-MM-DD")})}return e}().map((e=>{const a=l(e.sunday);return[a.year(),a.month()+1,e.week]}));g.value=e}else{const e=l().week(),a=l().year(),t=l().month()+1;g.value=[a,t,e]}else if("day"==Y.dateType)if(Y.multiple){const e=function(){const e=[],a=l();for(let t=6;t>=0;t--){const n=a.subtract(t,"day");e.push({day:n.format("YYYY-MM-DD"),weekDay:n.day()})}return e}().map((e=>[l(e.day).year(),l(e.day).month()+1,l(e.day).format("YYYY-MM-DD")]));g.value=e}else{const e=l();g.value=[e.year(),e.month()+1,e.format("YYYY-MM-DD")]}O()},$=()=>{(g.value&&!g.value.length||!g.value)&&b()},k=e=>{e||O()};function w(e,a){const t=l().year(e).isoWeek(a).startOf("isoWeek"),n=t.add(6,"day");return{beginDate:t.format("YYYY-MM-DD"),endDate:n.format("YYYY-MM-DD")}}function C(e,a){return{beginDate:l(`${e}-${a}`).startOf("month").format("YYYY-MM-DD"),endDate:l(`${e}-${a}`).endOf("month").format("YYYY-MM-DD")}}const O=()=>{const{dateType:e,multiple:a}=Y;let t=[];if("month"==e)if(a)t=g.value.map((e=>{const[a,t]=e,{beginDate:n,endDate:o}=C(a,t);return{beginDate:n,endDate:o,dateCondition:`${a}-${t<10?`0${t}`:t}`}}));else{const[e,a]=g.value,{beginDate:n,endDate:o}=C(e,a);t=[{beginDate:n,endDate:o,dateCondition:`${e}-${a<10?`0${a}`:a}`}]}else if("week"==e)if(a)t=g.value.map((e=>{const[a,t,n]=e,{beginDate:o,endDate:l}=w(a,n);return{beginDate:o,endDate:l,dateCondition:`${a}-${n<10?`0${n}`:n}`}}));else{const[e,a,n]=g.value,{beginDate:o,endDate:l}=w(e,n);t=[{beginDate:o,endDate:l,dateCondition:`${e}-${n<10?`0${n}`:n}`}]}else if("day"==e)if(a)t=g.value.map((e=>{const[a,t,n]=e;return{beginDate:n,endDate:n,dateCondition:n}}));else{const[e,a,n]=g.value;t=[{beginDate:n,endDate:n,dateCondition:n}]}h("onSelectionChange",{dateType:e,selected:t})},T=r(!1),V=()=>{M.multiple=Y.multiple,v.value=[];const e=function(){const e=[],a=l().year();for(let t=4;t>=0;t--)e.push(a-t);return e}().map((e=>{const a=function(e){const a=[],t=l().year(),n=l().month()+1,o=e===t?n:12;for(let s=1;s<=o;s++){const t=l(`${e}-${s}`);a.push({month:s,year:e,startDate:t.startOf("month").format("YYYY-MM-DD"),endDate:t.endOf("month").format("YYYY-MM-DD")})}return a}(e);return{label:`${e}年`,value:e,children:a.map((a=>{const t={label:`${a.month}月`,value:a.month,leaf:"month"===Y.dateType,startDate:a.startDate,endDate:a.endDate};if("week"===Y.dateType){const n=function(e){const a=[],t=l(e).startOf("month"),n=l().isBefore(l(e).endOf("month"))?l():l(e).endOf("month");let o=t.startOf("week");if(1===o.date()&&1!==o.day())o=o.add(1,"day");else for(;1!==o.day();)o=o.add(1,"day");for(;o.isBefore(n)||o.isSame(n,"day");){const e=o.format("YYYY-MM-DD"),t=o.add(6,"day").format("YYYY-MM-DD"),n=o.week();a.push({week:n,monday:e,sunday:t}),o=o.add(7,"day")}return a}(`${e}-${a.month}`),o=n.map((e=>({label:`${e.week}周(${e.monday}-${e.sunday})`,value:e.week,leaf:!0})));Object.assign(t,{children:o})}else if("day"===Y.dateType){const n=function(e){const a=[],t=l(e).startOf("month"),n=l(e).isSame(l(),"month")?l():l(e).endOf("month");let o=t;for(;o.isBefore(n)||o.isSame(n,"day");)a.push({day:o.format("YYYY-MM-DD"),weekDay:o.day()}),o=o.add(1,"day");return a}(`${e}-${a.month}`),o=n.map((e=>({label:e.day,value:e.day,leaf:!0})));Object.assign(t,{children:o})}return t}))}}));v.value=e,m((()=>{b(),T.value=!0}))};return u((()=>Y),(()=>{T.value=!1,g.value=[],V()}),{immediate:!0,deep:!0}),u((()=>g.value),((e,a)=>{(null==e?void 0:e.length)>12&&(i.warning("最多只能选择12个"),m((()=>{g.value=a})))}),{deep:!0,immediate:!0}),(e,a)=>{const t=c("el-cascader");return"month"==e.dateType&&T.value?(p(),f(t,{key:0,ref:"monthCascaderRef",modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=e=>g.value=e),class:"cascader-select",options:v.value,props:M,"popper-class":"popper-select",clearable:"","collapse-tags":"","show-all-levels":!1,onChange:$,onVisibleChange:k},null,8,["modelValue","options"])):"week"==e.dateType&&T.value?(p(),f(t,{key:1,ref:"weekCascaderRef",modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=e=>g.value=e),class:"cascader-select",options:v.value,props:M,"popper-class":"popper-select",clearable:"","collapse-tags":"","show-all-levels":!1,onChange:$,onVisibleChange:k},null,8,["modelValue","options"])):"day"==e.dateType&&T.value?(p(),f(t,{key:2,ref:"dayCascaderRef",modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=e=>g.value=e),class:"cascader-select",options:v.value,props:M,"popper-class":"popper-select",clearable:"","collapse-tags":"","show-all-levels":!1,onChange:$,onVisibleChange:k},null,8,["modelValue","options"])):D("",!0)}}});export{y as _};
