var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,n=(a,l,s)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[l]=s,r=(e,a,l)=>new Promise(((s,t)=>{var i=e=>{try{r(l.next(e))}catch(a){t(a)}},n=e=>{try{r(l.throw(e))}catch(a){t(a)}},r=e=>e.done?s(e.value):Promise.resolve(e.value).then(i,n);r((l=l.apply(e,a)).next())}));import{d as o,n as u,a0 as c,A as d,at as p,F as m,r as g,j as f,w as h,o as y,c as v,b,h as w,a4 as x,u as N,a2 as k,f as T,e as _,J as z,L as j,I,v as O,M as S,a5 as C,b1 as P,a1 as E,b2 as V}from"./index-OtYEJMgP.js";import{E as U}from"./icon_no_data-JkxAPqfn.js";import{c as A}from"./constants-uiyZ18jc.js";import{u as R}from"./MediaReview-6GObmu50.js";const B={class:"w-full h-full flex flex-col gap-y-4"},L={class:"w-full flex flex-col",style:{padding:"12px 10px",background:"linear-gradient(90deg, #053a4b, rgb(5 58 75 / 29%))"}},M={class:"text-white text-sm"},D={class:"text-white text-sm"},W={class:"fixed top-12 right-36"},$={class:"flex flex-col w-[480px]"},q=o((F=((e,a)=>{for(var l in a||(a={}))t.call(a,l)&&n(e,l,a[l]);if(s)for(var l of s(a))i.call(a,l)&&n(e,l,a[l]);return e})({},{name:"AnalysisMainResult"}),a(F,l({__name:"index",setup(e){const a=u((()=>({nodeKey:"id",props:{label:"desc",children:"children"}}))),l=u((()=>R().analysisParams)),s=c({analysisTaskType:[],taskName:"",aiTaskId:""}),t=c({pageNum:1,pageSize:10,total:0}),i=()=>{t.pageNum=1,K()},n=u((()=>J.value.map((e=>"data:image/png;base64,"+e.imageBase64)))),o=d(0),q=e=>{o.value=e},F=d(!1),J=d([]),K=C((()=>r(this,null,(function*(){F.value=!0,J.value=[];const{pageNum:e,pageSize:a}=t,{aiTaskId:l,taskName:i}=s,{clsTypes:n}=(()=>{const e=k().intelligentAnalysisTypeList,a=[],l=[],t=(e,s,i)=>{e.forEach((e=>{s.includes(e.id)&&(a.push(e.name),i&&l.push(i.name)),e.children&&t(e.children,s,e)}))};t(e,s.analysisTaskType);const i=[...new Set(l)];return{clsTypes:a,majors:i}})();yield P({aiTaskId:l,clsTypes:n.join(","),taskName:i,pageNum:e,pageSize:a}).then((e=>{if(e&&E!==e){const{rows:a,total:l}=e;J.value=a||[],t.total=Number(l)||0,H()}})).finally((()=>{F.value=!1}))}))),1e3),G=c({analysisNum:0,eventNum:0,resultClsNames:[],sjWzImageNum:0,taskNum:0,wzEventNames:[],wzImageNum:0}),H=C((()=>r(this,null,(function*(){F.value=!0;const{aiTaskId:e}=s;yield V({aiTaskId:e}).then((e=>{E!==e&&Object.keys(G).forEach((a=>{G[a]=e[a]}))})).finally((()=>{F.value=!1}))}))),1e3),Q=()=>{t.pageNum=1,K()};return p((()=>l.value),(()=>{const{type:e,value:a}=l.value;if("3"===e&&a){const{id:e}=a;Object.assign(s,{aiTaskId:e}),Q()}}),{deep:!0,immediate:!0}),m((()=>{console.log(l.value)})),(e,l)=>{const r=g("el-tree-select"),u=g("el-form-item"),c=g("el-input"),d=g("el-button"),p=g("el-form"),m=g("el-descriptions-item"),C=g("el-descriptions"),P=g("el-tooltip"),E=g("el-image"),V=g("el-empty"),R=g("el-auto-resizer"),H=g("el-pagination"),X=f("loading");return h((y(),v("div",B,[b(p,{inline:!0,"label-suffix":"：",class:"w-full table-query"},{default:w((()=>[b(u,{label:"违章类型",class:"m-0"},{default:w((()=>[b(r,x({modelValue:s.analysisTaskType,"onUpdate:modelValue":l[0]||(l[0]=e=>s.analysisTaskType=e),data:N(k)().intelligentAnalysisTypeList,"render-after-expand":!1,clearable:"","show-checkbox":"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},a.value,{"check-strictly":!1,"highlight-current":!1,"expand-on-click-node":!1,placeholder:"请选择智能分析类型"}),null,16,["modelValue","data"])])),_:1}),b(u,{label:"任务名称",class:"m-0"},{default:w((()=>[b(c,{modelValue:s.taskName,"onUpdate:modelValue":l[1]||(l[1]=e=>s.taskName=e),clearable:"",maxlength:"20",placeholder:"请输入任务名称",formatter:e=>e.replace(/^\s*|\s*$/g,""),parser:e=>e.replace(/^\s*|\s*$/g,"")},null,8,["modelValue","formatter","parser"])])),_:1}),b(u,{class:"m-0"},{default:w((()=>[b(d,{class:"basic-button",onClick:Q},{default:w((()=>[T(" 查询 ")])),_:1})])),_:1})])),_:1}),_("div",L,[_("span",M,[T(" 本次智能分析类型： "),(y(!0),v(z,null,j(G.resultClsNames,((e,a)=>(y(),v(z,{key:a},[T(I(e)+" "+I(a<G.resultClsNames.length-1?",":""),1)],64)))),128))]),_("span",D," 分析作业计划数："+I(G.taskNum||0)+" | 采集分析样本："+I(G.analysisNum||0)+" ( 其中违章样本："+I(G.wzImageNum||0)+" ，违章事件："+I(G.eventNum||0)+" ) | 实际发现问题数量： "+I(G.sjWzImageNum||0),1)]),b(R,null,{default:w((({height:e,width:a})=>[J.value.length?(y(),v("div",{key:0,class:"grid grid-cols-3 gap-2 overflow-auto",style:O({width:a+"px",height:e+"px"})},[(y(!0),v(z,null,j(J.value,((e,a)=>(y(),v("div",{key:e.id,class:"aspect-video"},[b(E,{class:"w-full h-full",src:"data:image/png;base64,"+e.imageBase64,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"show-progress":"","preview-src-list":n.value,"initial-index":a,fit:"cover",lazy:"",onDragstart:l[2]||(l[2]=S((()=>{}),["prevent"])),onSwitch:q,onShow:e=>(e=>{o.value=e})(a)},{viewer:w((()=>[_("div",W,[b(P,{class:"box-item",effect:"dark",placement:"top-start"},{content:w((()=>[_("div",$,[b(C,{column:2,class:"w-full"},{default:w((()=>[b(m,{width:"50%",label:"作业计划名称",span:2},{default:w((()=>[T(I(e.taskName),1)])),_:2},1024),b(m,{width:"50%",label:"市级公司"},{default:w((()=>[T(I(e.cityOrgName),1)])),_:2},1024),b(m,{width:"50%",label:"管理部门"},{default:w((()=>[T(I(e.orgName),1)])),_:2},1024),b(m,{width:"50%",label:"工作负责人"},{default:w((()=>[T(I(e.fzrRealName),1)])),_:2},1024),b(m,{width:"50%",label:"计划开始/结束时间"},{default:w((()=>[T(I(e.beginTime)+" / "+I(e.endTime),1)])),_:2},1024),b(m,{width:"50%",label:"视频录制人员"},{default:w((()=>[T(I(e.execUserRealName),1)])),_:2},1024),b(m,{width:"50%",label:"违章样本定位"},{default:w((()=>[T(I(N(A)(e.frameTimestamp||0)),1)])),_:2},1024),b(m,{width:"50%",label:"视频录制开始/结束时间"},{default:w((()=>[T(I(e.videoBeginTime)+" / "+I(e.videoEndTime),1)])),_:2},1024)])),_:2},1024)])])),default:w((()=>[b(d,{class:"basic-button"},{default:w((()=>[T(" 图片信息 ")])),_:1})])),_:2},1024)])])),_:2},1032,["src","preview-src-list","initial-index","onShow"])])))),128))],4)):(y(),v("div",{key:1,class:"flex flex-row items-center justify-center",style:O({width:a+"px",height:e+"px"})},[b(V,{description:"暂无数据",image:N(U)},null,8,["image"])],4))])),_:1}),b(H,{"current-page":t.pageNum,"onUpdate:currentPage":l[3]||(l[3]=e=>t.pageNum=e),"page-size":t.pageSize,"onUpdate:pageSize":l[4]||(l[4]=e=>t.pageSize=e),background:"",small:"",layout:"total, sizes, prev, pager, next, jumper",total:t.total,"page-sizes":[10,20,30,40,50,100],onSizeChange:i,onCurrentChange:N(K)},null,8,["current-page","page-size","total","onCurrentChange"])])),[[X,F.value]])}}}))));var F;export{q as _};
