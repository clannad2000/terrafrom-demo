var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,n=(a,l,s)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[l]=s,o=(e,a,l)=>new Promise(((s,t)=>{var i=e=>{try{o(l.next(e))}catch(a){t(a)}},n=e=>{try{o(l.throw(e))}catch(a){t(a)}},o=e=>e.done?s(e.value):Promise.resolve(e.value).then(i,n);o((l=l.apply(e,a)).next())}));import{d as r,n as c,A as u,a0 as d,Y as p,a8 as m,X as f,H as g,r as y,j as h,o as v,g as b,h as w,w as x,c as k,b as N,a4 as _,u as z,a2 as T,f as j,e as I,I as O,J as S,L as E,M as C,a9 as P,a5 as D,aZ as A,a1 as R,a_ as U}from"./index-OtYEJMgP.js";import{E as B}from"./icon_no_data-JkxAPqfn.js";import{c as L}from"./constants-uiyZ18jc.js";const V={class:"flex-1 flex flex-col gap-y-4 my-2"},M={class:"flex flex-col gap-y-2"},W={class:"flex flex-row items-center gap-x-4"},q={class:"text-white text-sm"},H={class:"text-white text-sm"},J={class:"text-[#00e8ff] text-sm py-2 px-4",style:{"background-color":"rgb(0 232 255 / 10%)"}},K={key:0,class:"w-full h-[560px] grid grid-cols-3 gap-2 overflow-auto"},X={class:"fixed top-12 right-36"},Y={class:"flex flex-col w-[480px]"},Z={key:1,class:"w-full h-[560px] flex flex-row items-center justify-center"},F=r((G=((e,a)=>{for(var l in a||(a={}))t.call(a,l)&&n(e,l,a[l]);if(s)for(var l of s(a))i.call(a,l)&&n(e,l,a[l]);return e})({},{name:"AnalysisMainDetailDialog"}),a(G,l({__name:"DetailDialog",emits:["register","confirm"],setup(e,{emit:a}){const l=c((()=>({nodeKey:"id",props:{label:"desc",children:"children"}}))),s=u(!1),t=d({analysisTaskType:[],taskName:"",fzrRealName:"",taskId:"",id:""}),i=d({analysisNum:0,eventNum:0,resultClsNames:[],sjWzImageNum:0,taskNum:0,wzEventNames:[],wzImageNum:0}),n=d({pageNum:1,pageSize:10,total:0}),r=()=>{n.pageNum=1,ee()},F=c((()=>$.value.map((e=>"data:image/png;base64,"+e.imageBase64)))),G=u(0),Q=e=>{G.value=e},$=p([]),ee=D((()=>o(this,null,(function*(){s.value=!0,$.value=[];const{pageNum:e,pageSize:a}=n,{id:l,taskId:i}=t,{clsTypes:o}=(()=>{const e=T().intelligentAnalysisTypeList,a=[],l=[],s=(e,t,i)=>{e.forEach((e=>{t.includes(e.id)&&(a.push(e.name),i&&l.push(i.name)),e.children&&s(e.children,t,e)}))};s(e,t.analysisTaskType);const i=[...new Set(l)];return{clsTypes:a,majors:i}})();yield A({aiTaskId:l,taskId:i,clsTypes:o.join(","),pageNum:e,pageSize:a}).then((e=>{if(e&&R!==e){const{rows:a,total:l}=e;$.value=a||[],n.total=Number(l)||0,ae()}})).finally((()=>{s.value=!1}))}))),1e3),ae=D((()=>o(this,null,(function*(){s.value=!0;const{id:e,taskId:a}=t;yield U({aiTaskId:e,taskId:a}).then((e=>{R!==e&&Object.keys(i).forEach((a=>{i[a]=e[a]}))})).finally((()=>{s.value=!1}))}))),1e3),le=()=>{n.pageNum=1,ee()},[se,{closeDialog:te}]=m((e=>{const{type:a,data:l}=e;"view"===a&&(Object.keys(l).forEach((e=>{t[e]=l[e]})),f((()=>{le()})))})),ie=function(){s.value=!1,te(),Object.keys(t).forEach((e=>{Array.isArray(t[e])?t[e]=[]:t[e]=""})),$.value=[]};return g((()=>{ie()})),(e,a)=>{const o=y("el-tree-select"),c=y("el-form-item"),u=y("el-button"),d=y("el-form"),p=y("el-descriptions-item"),m=y("el-descriptions"),f=y("el-tooltip"),g=y("el-image"),D=y("el-empty"),A=y("el-pagination"),R=h("loading");return v(),b(z(P),{width:"80%","show-close":!0,top:"32px",center:"","destroy-on-close":"","close-on-click-modal":!1,onClose:ie,onRegister:z(se)},{default:w((()=>[x((v(),k("div",V,[N(d,{inline:!0,"label-suffix":"：",class:"w-full table-query"},{default:w((()=>[N(c,{label:"违章类型",class:"m-0"},{default:w((()=>[N(o,_({modelValue:t.analysisTaskType,"onUpdate:modelValue":a[0]||(a[0]=e=>t.analysisTaskType=e),data:z(T)().intelligentAnalysisTypeList,"render-after-expand":!1,clearable:"","show-checkbox":"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},l.value,{"check-strictly":!1,"highlight-current":!1,"expand-on-click-node":!1,placeholder:"请选择智能分析类型"}),null,16,["modelValue","data"])])),_:1}),N(c,{class:"m-0"},{default:w((()=>[N(u,{class:"basic-button",onClick:le},{default:w((()=>[j(" 查询 ")])),_:1})])),_:1})])),_:1}),I("div",M,[I("div",W,[I("span",q,"作业名称："+O(t.taskName),1),I("span",H,"工作负责人："+O(t.fzrRealName),1)]),I("div",null,[I("span",J," 采集分析样本："+O(i.analysisNum||0)+"，其中违章样本："+O(i.wzImageNum||0)+"，违章事件："+O(i.eventNum||0)+"，实际发生问题数量："+O(i.sjWzImageNum||0),1)])]),$.value.length?(v(),k("div",K,[(v(!0),k(S,null,E($.value,((e,l)=>(v(),k("div",{key:e.id,class:"aspect-video"},[N(g,{class:"w-full h-full",src:"data:image/png;base64,"+e.imageBase64,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"show-progress":"","preview-src-list":F.value,"initial-index":l,fit:"cover",lazy:"",onDragstart:a[1]||(a[1]=C((()=>{}),["prevent"])),onSwitch:Q,onShow:e=>(e=>{G.value=e})(l)},{viewer:w((()=>[I("div",X,[N(f,{class:"box-item",effect:"dark",placement:"top-start"},{content:w((()=>[I("div",Y,[N(m,{column:2,class:"w-full"},{default:w((()=>[N(p,{width:"50%",label:"作业计划名称",span:2},{default:w((()=>[j(O(e.taskName),1)])),_:2},1024),N(p,{width:"50%",label:"市级公司"},{default:w((()=>[j(O(e.cityOrgName),1)])),_:2},1024),N(p,{width:"50%",label:"管理部门"},{default:w((()=>[j(O(e.orgName),1)])),_:2},1024),N(p,{width:"50%",label:"工作负责人"},{default:w((()=>[j(O(e.fzrRealName),1)])),_:2},1024),N(p,{width:"50%",label:"计划开始/结束时间"},{default:w((()=>[j(O(e.beginTime)+" / "+O(e.endTime),1)])),_:2},1024),N(p,{width:"50%",label:"视频录制人员"},{default:w((()=>[j(O(e.execUserRealName),1)])),_:2},1024),N(p,{width:"50%",label:"违章样本定位"},{default:w((()=>[j(O(z(L)(e.frameTimestamp||0)),1)])),_:2},1024),N(p,{width:"50%",label:"视频录制开始/结束时间"},{default:w((()=>[j(O(e.videoBeginTime)+" / "+O(e.videoEndTime),1)])),_:2},1024)])),_:2},1024)])])),default:w((()=>[N(u,{class:"basic-button"},{default:w((()=>[j(" 图片信息 ")])),_:1})])),_:2},1024)])])),_:2},1032,["src","preview-src-list","initial-index","onShow"])])))),128))])):(v(),k("div",Z,[N(D,{description:"暂无数据",image:z(B)},null,8,["image"])])),N(A,{"current-page":n.pageNum,"onUpdate:currentPage":a[2]||(a[2]=e=>n.pageNum=e),"page-size":n.pageSize,"onUpdate:pageSize":a[3]||(a[3]=e=>n.pageSize=e),background:"",small:"",layout:"total, sizes, prev, pager, next, jumper",total:n.total,"page-sizes":[10,20,30,40,50,100],onSizeChange:r,onCurrentChange:z(ee)},null,8,["current-page","page-size","total","onCurrentChange"])])),[[R,s.value]])])),_:1},8,["onRegister"])}}}))));var G;export{F as _};
