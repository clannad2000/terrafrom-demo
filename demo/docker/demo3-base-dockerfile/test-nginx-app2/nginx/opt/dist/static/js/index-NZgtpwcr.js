var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,o=(e,a)=>{for(var t in a||(a={}))s.call(a,t)&&i(e,t,a[t]);if(l)for(var t of l(a))r.call(a,t)&&i(e,t,a[t]);return e},n=(e,a,t)=>new Promise(((l,s)=>{var r=e=>{try{o(t.next(e))}catch(a){s(a)}},i=e=>{try{o(t.throw(e))}catch(a){s(a)}},o=e=>e.done?l(e.value):Promise.resolve(e.value).then(r,i);o((t=t.apply(e,a)).next())}));import{d as c,Y as p,Z as f,n as u,A as m,a0 as d,z as g,at as v,F as x,r as y,j as h,w,o as b,c as j,e as k,J as P,L as N,u as _,I,b as z,v as O,a5 as S,b5 as R,a1 as D,b6 as U,a6 as C,R as M,U as T,b7 as E,b8 as F,_ as G}from"./index-OtYEJMgP.js";import{E as J}from"./icon_no_data-JkxAPqfn.js";import{i as L,a as A,b as V}from"./play-gHG0B82O.js";import{u as Y}from"./MediaReview-6GObmu50.js";import Z from"./GPSViewerDialog-zHxEHNeD.js";const q=""+new URL("../png/track_play_back_bg-jypaND2r.png",import.meta.url).href,B=e=>(M("data-v-78731c3e"),e=e(),T(),e),H={key:0,class:"w-full grid grid-cols-3 gap-2 overflow-auto"},K=["onClick"],Q={class:"title"},W={class:"flex-1 flex flex-row items-center gap-x-2"},X=["src"],$={class:"text-sm truncate"},ee={class:"info flex flex-col"},ae={class:"flex flex-row items-center"},te={class:"task-title-major text-sm"},le={class:"task-title-name text-sm"},se={class:"flex flex-row items-center justify-between gap-x-4"},re={class:"flex-1 flex flex-row items-center justify-start"},ie=B((()=>k("div",{class:"min-w-fit text-xs"},"班组：",-1))),oe={class:"truncate text-xs"},ne={class:"flex-1 flex flex-row items-center justify-end"},ce=B((()=>k("div",{class:"min-w-fit text-xs"},"人员：",-1))),pe={class:"truncate text-xs"},fe=["src"],ue=["src"],me={key:1,class:"flex-1 flex flex-row items-center justify-center"};var de;const ge=G(c((de=o({},{name:"JobPlanMainGPS"}),a(de,t({__name:"index",setup(e){const a=p(),t=p(),{height:l}=f(a),{height:s}=f(t),r=u((()=>({width:"100%",height:l.value-s.value-20+"px"}))),i=p([]),c=m(!1),M=d({pageNum:1,pageSize:9,total:0}),T=()=>{B()},G=()=>{const{type:e,value:a={}}=Y().jobPlanParams;"gps"===e&&(null==a?void 0:a.taskId)?(M.pageNum=1,B()):i.value=[]},B=S((()=>n(this,null,(function*(){i.value=[];const{pageNum:e,pageSize:a}=M,{type:t,isMarked:l,value:{taskId:s}}=Y().jobPlanParams,r={pageNum:e,pageSize:a,taskId:s,fileType:t};"all"!==l&&(r.isMarked=l),yield E(r).then((e=>{if(e&&D!==e){const{rows:a=[],total:t=0}=e;if(M.total=Number(t)||0,a.length){const e=[];a.forEach((a=>{e.push(a.fileId)})),de(e.join(","))}}})).finally((()=>{c.value=!1}))}))),1e3),de=e=>{c.value=!0,i.value=[],F({fileIds:e}).then((e=>{e&&D!==e&&(i.value=e||[])})).finally((()=>{c.value=!1}))},[ge,{showDialog:ve,setDialogProps:xe}]=g(),ye=e=>n(this,null,(function*(){const{fileId:a}=e;yield R({fileId:a}).then((a=>{if(a&&D!==a){const t=U(a);if(!t)return void C.error("获取文件信息失败");e.fileUrl=t.replace("/basic-api",""),xe({title:"轨迹回放"}),ve(!0,{type:"view",data:o(o({},e),a)})}})).catch((e=>{console.log(e),C.error("获取文件信息失败")})).finally((()=>{}))}));return v((()=>Y().jobPlanParams),(()=>{G()}),{deep:!0,immediate:!0}),x((()=>{G()})),(e,l)=>{const s=y("el-empty"),o=y("el-pagination"),n=h("loading");return w((b(),j("div",{ref_key:"fileContainerRef",ref:a,class:"w-full h-full flex flex-col gap-y-4"},[k("div",{class:"flex flex-col items-center",style:O(r.value)},[i.value.length?(b(),j("div",H,[(b(!0),j(P,null,N(i.value,(e=>(b(),j("div",{key:e.fileId,class:"aspect-video file-info relative cursor-pointer",onClick:a=>ye(e)},[k("div",Q,[k("div",W,[k("img",{class:"w-7 h-7",src:"100002"==e.uploadType?_(L):"100001"==e.uploadType?_(A):""},null,8,X),k("span",$,I(e.execDeviceName),1)])]),k("div",ee,[k("div",ae,[k("span",te,"（"+I(e.majorTypeName)+"）",1),k("span",le,I(e.taskName),1)]),k("div",se,[k("div",re,[ie,k("div",oe,I(e.orgName),1)]),k("div",ne,[ce,k("div",pe,I(e.execUserRealName),1)])])]),k("img",{src:_(q),class:"w-full h-full"},null,8,fe),k("img",{src:_(V),class:"w-16 h-16 absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 cursor-pointer"},null,8,ue)],8,K)))),128))])):(b(),j("div",me,[z(s,{description:"暂无数据",image:_(J)},null,8,["image"])]))],4),z(o,{ref_key:"paginationRef",ref:t,"current-page":M.pageNum,"onUpdate:currentPage":l[0]||(l[0]=e=>M.pageNum=e),"page-size":M.pageSize,"onUpdate:pageSize":l[1]||(l[1]=e=>M.pageSize=e),small:"",background:"",layout:"total, prev, pager, next",total:M.total,onCurrentChange:T},null,8,["current-page","page-size","total"]),z(Z,{onRegister:_(ge)},null,8,["onRegister"])])),[[n,c.value]])}}})))),[["__scopeId","data-v-78731c3e"]]);export{ge as default};
