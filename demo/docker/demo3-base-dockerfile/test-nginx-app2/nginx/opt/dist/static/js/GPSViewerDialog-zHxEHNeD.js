var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,s=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,r=(e,a,l)=>new Promise(((t,o)=>{var n=e=>{try{r(l.next(e))}catch(a){o(a)}},s=e=>{try{r(l.throw(e))}catch(a){o(a)}},r=e=>e.done?t(e.value):Promise.resolve(e.value).then(n,s);r((l=l.apply(e,a)).next())}));import{d as i,A as u,a0 as c,a7 as d,Y as m,a8 as p,ba as v,at as f,aD as y,X as g,H as b,r as h,o as w,g as x,h as j,e as O,b as M,c as L,J as P,L as _,f as k,u as I,a9 as S,R as F,U as R,_ as C}from"./index-OtYEJMgP.js";const D={class:"w-full flex flex-row items-center mb-4"},E=(e=>(F("data-v-898bc1e3"),e=e(),R(),e))((()=>O("div",{class:"w-full aspect-video flex flex-col relative"},[O("div",{id:"map",class:"w-full h-full absolute top-0 left-0"})],-1))),V=i((J=((e,a)=>{for(var l in a||(a={}))o.call(a,l)&&s(e,l,a[l]);if(t)for(var l of t(a))n.call(a,l)&&s(e,l,a[l]);return e})({},{name:"JobPlanMainGPSViewerDialog"}),a(J,l({__name:"GPSViewerDialog",emits:["register","confirm"],setup(e,{emit:a}){const l=window.SGMap,t=window.turf;console.log(t);const o=u(1),n=[{label:"1x",value:1},{label:"2x",value:2},{label:"4x",value:4},{label:"8x",value:8}];let s=null;const i=u(!1),F=c({}),R=u(!1),C=u(!1),V=u(!1),{commonMap:J}=d(),N=m(null),[T,{closeDialog:U}]=p((e=>{const{type:a,data:l}=e;"view"===a&&(Object.keys(l).forEach((e=>{F[e]=l[e]})),R.value=!1,C.value=!1,V.value=!1,o.value=1,z(),B())})),G=function(){i.value=!1,U(),Object.keys(F).forEach((e=>{F[e]=""})),A()},z=()=>r(this,null,(function*(){yield A(),console.log("initMap"),N.value=new J.Map({container:"map",style:"aegis://styles/aegis/Satellite512",center:[119.12477321074,33.074785125453],zoom:10,maxZoom:19.5,localIdeographFontFamily:"Microsoft YoHei"}),N.value.on("load",(e=>r(this,null,(function*(){R.value=!0,new J.RoadNetLayer({map:N.value,style:"aegis://styles/aegis/Road-v2"}).render()}))))})),A=()=>{console.log("destroyMap"),N.value&&(N.value.remove(),N.value=null),s=null},B=()=>r(this,null,(function*(){i.value=!0,v({fileUrl:F.fileUrl.replace("/js-zygk-admin",""),joinPrefix:"minio"!==F.storageType}).then((e=>r(this,null,(function*(){const a=new FileReader;a.readAsText(e.data),a.onload=()=>r(this,null,(function*(){try{const e=JSON.parse(a.result);yield d().batchConvertCoords(e).then((e=>{H.geometry.coordinates=e.map((e=>[e.lng,e.lat])),C.value=!0})).catch((e=>{console.error("转换坐标时出错:",e)}))}catch(e){console.error("解析 JSON 数据时出错:",e)}})),a.onerror=()=>{console.error("读取 Blob 数据时出错:",a.error)}})))).finally((()=>{i.value=!1}))})),H=c({geometry:{type:"LineString",coordinates:[]},properties:{},type:"Feature"}),Y=()=>{console.log(o.value);const[e,a]=H.geometry.coordinates[0];if(s)s.setLngLat([e,a]);else{const t=document.createElement("div");t.className="marker map-marker",t.style.width="32px",t.style.height="32px",s=new l.Marker(t).setLngLat([e,a]).addTo(N.value)}let n=0;const r=()=>{if(n<H.geometry.coordinates.length){const e=H.geometry.coordinates[0===n?0:n-1],a=H.geometry.coordinates[n],[l,i]=H.geometry.coordinates[n];s.setLngLat([l,i]);const u=t.bearing(t.point(e),t.point(a));u&&s.setRotation(u-90),n++,setTimeout(r,3e3/o.value)}else n=0};r()};return f((()=>[R.value,C.value]),(()=>{if(R.value&&C.value){const e=y(H.geometry.coordinates),{center:a,bounds:l}=(e=>{if(!e||!e.length)return null;const a=e;let l=0,t=0,o=Infinity,n=Infinity,s=-Infinity,r=-Infinity;a.forEach((e=>{const[a,i]=e;l+=a,t+=i,o=Math.min(o,a),n=Math.min(n,i),s=Math.max(s,a),r=Math.max(r,i)}));const i=a.length;return{center:[l/i,t/i],bounds:{ne:[s,r],sw:[o,n]}}})(e);N.value.setCenter(a),N.value.fitBounds([l.sw,l.ne],{padding:{top:50,bottom:50,left:50,right:50}}),g((()=>{N.value.loadImage("https://map.sgcc.com.cn/products/js-sdk/v3/assets/images/roadFragment.jpg",(function(e,a){N.value.addImage("route-img",a),N.value.addLayer({id:"route",type:"line",source:{type:"geojson",data:H},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#28F","line-width":6,"line-pattern":"route-img"}}),N.value.addLayer({id:"route-played",type:"line",source:{type:"geojson",data:{type:"FeatureCollection",features:[]}},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#4dc86f","line-width":6}}),V.value=!0}))}))}})),b((()=>{G()})),(e,a)=>{const l=h("el-option"),t=h("el-select"),s=h("el-form-item"),r=h("el-button"),i=h("el-form");return w(),x(I(S),{width:"960","show-close":!0,center:"","destroy-on-close":"","close-on-click-modal":!1,onClose:G,onRegister:I(T)},{default:j((()=>[O("div",D,[M(i,{inline:!0,"label-suffix":"：",class:"w-full table-query"},{default:j((()=>[M(s,{label:"倍速",class:"m-0"},{default:j((()=>[M(t,{modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=e=>o.value=e),placeholder:"请选择倍速",disabled:!V.value},{default:j((()=>[(w(),L(P,null,_(n,(e=>M(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:1},8,["modelValue","disabled"])])),_:1}),M(s,{class:"m-0"},{default:j((()=>[M(r,{class:"basic-button",loading:!V.value,onClick:Y},{default:j((()=>[k(" 开始播放 ")])),_:1},8,["loading"])])),_:1})])),_:1})]),E])),_:1},8,["onRegister"])}}}))));var J;const N=C(V,[["__scopeId","data-v-898bc1e3"]]);export{N as default};
