var e=Object.defineProperty,l=Object.defineProperties,a=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(l,a,t)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[a]=t,n=(e,l)=>{for(var a in l||(l={}))o.call(l,a)&&r(e,a,l[a]);if(t)for(var a of t(l))s.call(l,a)&&r(e,a,l[a]);return e},i=(e,t)=>l(e,a(t)),c=(e,l,a)=>new Promise(((t,o)=>{var s=e=>{try{n(a.next(e))}catch(l){o(l)}},r=e=>{try{n(a.throw(e))}catch(l){o(l)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(s,r);n((a=a.apply(e,l)).next())}));import{a3 as u,d,Y as p,Z as m,n as f,a0 as g,A as v,V as k,r as y,j as b,o as x,c as h,e as w,b as I,h as C,a4 as A,u as L,a2 as N,J as V,L as j,g as _,aa as R,f as z,t as P,I as F,w as U,v as q,M as T,bi as O,N as G,a5 as B,a1 as S,a6 as E,R as J,U as W,_ as M}from"./index-OtYEJMgP.js";import{E as Q}from"./icon_no_data-JkxAPqfn.js";import{i as H,a as D}from"./icon_panel_open-9KbWcAiz.js";const Y=e=>(J("data-v-27e82403"),e=e(),W(),e),Z=[Y((()=>w("div",{class:"title"},"作业检索",-1)))],K={class:"flex-1 flex flex-row items-center"},X=["onClick"],$={class:"btn-text"},ee={class:"flex flex-row items-center gap-x-2"},le=Y((()=>w("span",{class:"text-sm font-bold"},"临抢",-1))),ae=["src"],te={key:0,class:"flex-1 flex flex-row items-center justify-between"},oe={class:"mr-2"},se={key:1,class:"flex-1 flex flex-row items-center gap-x-4"},re={class:"flex-1 flex min-w-0"},ne={style:{display:"-webkit-box",overflow:"hidden","word-wrap":"break-word","white-space":"pre-wrap","-webkit-box-orient":"vertical","-webkit-line-clamp":"2"}},ie=["onClick"],ce={key:2,class:"w-full flex flex-col gap-y-2 bg-[#106184]",style:{padding:"10px 20px"}},ue={class:"w-full flex flex-row items-start gap-x-1"},de=Y((()=>w("div",null,"执行人员：",-1))),pe={class:"flex-1 flex flex-col gap-y-1"},me={class:"flex-1 flex min-w-0"},fe=["onClick"],ge={key:1,class:"flex-1 flex flex-row items-center justify-center"},ve=M(d(i(n({},{name:"OnlinePatrolContainerLeft"}),{__name:"ContainerLeft",setup(e){const l=p(),{height:a}=m(l),t=p(),{height:o}=m(t),s=p(),{height:r}=m(s),d=p(),{height:J}=m(d),W=p(),{height:M}=m(W),Y=f((()=>({height:a.value-o.value-r.value-J.value-M.value-64+"px"}))),ve=g({orgId:"",queryPatrolFlag:"",keyWord:"",workRiskLevels:[],majorTypes:[],voltageLevels:[],status:"1",queryTmpFlag:!1}),ke=g({pageNum:1,pageSize:10,total:0}),ye=()=>{Le()},be=()=>{ke.pageNum=1,Ne()},xe=f((()=>({nodeKey:"id",props:{label:e=>e.shortName||e.name,children:"children"}}))),he=e=>{e||Ne()},we=()=>{ve.queryTmpFlag=!ve.queryTmpFlag,Ne()},Ie=[{label:"未督查",value:"0"},{label:"已督查",value:"1"}],Ce=[{label:"在线",value:"1"},{label:"离线",value:"2"},{label:"暂停",value:"3"}],Ae=v(!1),Le=B((()=>c(this,null,(function*(){Ve.value[0].children=[],Ae.value=!0;const{pageSize:e,pageNum:l}=ke,{orgId:a,workRiskLevels:t,majorTypes:o,voltageLevels:s,keyWord:r,queryPatrolFlag:c,queryTmpFlag:d,status:p}=ve;var m;yield(m={orgId:a,keyWord:r,queryPatrolFlag:c,queryTmpFlag:d,status:p,workRiskLevel:t.join(","),majorType:o.join(","),voltageLevel:s.join(","),pageNum:l,pageSize:e},u.get({url:"/patrol/center/page",params:m})).then((e=>{if(S!==e){const{rows:l=[],total:a=0}=e;ke.total=Number(a)||0;const t=l.map((e=>{const{workRiskLevelName:l,isImportant:a="0",workRiskLevel:t}=e;return{id:e.taskId,label:e.taskName,workRiskLevelName:l,workRiskLevel:t,isImportant:a,children:[i(n({},e),{id:(new Date).getTime()})]}}));Ve.value[0].children=t}})).finally((()=>{Ae.value=!1}))}))),1e3),Ne=()=>{ke.pageNum=1,Le()},Ve=v([{id:"0",label:"全部作业",children:[]}]),je=e=>c(this,null,(function*(){const{id:l,isImportant:a="0"}=e,t={taskId:l,isImportant:"0"===a?"1":"0"};yield(e=>u.post({url:"/patrol/center/edit/isImportant",params:e}))(t).then((l=>{S!==l&&(e.isImportant=t.isImportant,E.success("标记成功"))}))})),_e=e=>c(this,null,(function*(){if(!e.taskOnline)return;const{id:l}=e,a={taskId:l};yield(e=>u.post({url:"/patrol/center/edit/taskTop",params:e}))(a).then((e=>{S!==e&&E.success("置顶成功")}))})),Re=e=>c(this,null,(function*(){const{taskId:l,userName:a,deviceCode:t}=e,o={taskId:l,execUserName:a,deviceCode:t};yield(e=>u.post({url:"/patrol/center/edit/videoTop",params:e}))(o).then((e=>{S!==e&&E.success("置顶成功")}))}));return k((()=>{Ne()})),(e,a)=>{const o=y("el-tree-select"),r=y("el-form-item"),n=y("el-option"),i=y("el-select"),c=y("el-button"),u=y("el-input"),p=y("el-form"),m=y("el-icon"),f=y("el-tree"),g=y("el-empty"),v=y("el-pagination"),k=b("loading");return x(),h("div",{ref_key:"containerRef",ref:l,class:"w-full h-full flex flex-col gap-y-4"},[w("div",{ref_key:"titleRef",ref:t,class:"title-box"},Z,512),I(p,{ref_key:"searchFormRef",ref:s,inline:!0,class:"w-full table-query"},{default:C((()=>[I(r,{class:"col-span-2 m-0"},{default:C((()=>[I(o,A({modelValue:ve.orgId,"onUpdate:modelValue":a[0]||(a[0]=e=>ve.orgId=e),data:L(N)().orgTreeByUser,"render-after-expand":!1,clearable:""},xe.value,{"check-strictly":!0,"highlight-current":!0,"expand-on-click-node":!1,placeholder:"管理部门",onFocus:L(N)().loadOrgTreeByUser,onVisibleChange:he}),null,16,["modelValue","data","onFocus"])])),_:1}),I(r,{class:"m-0"},{default:C((()=>[I(i,{modelValue:ve.queryPatrolFlag,"onUpdate:modelValue":a[1]||(a[1]=e=>ve.queryPatrolFlag=e),placeholder:"督查状态",clearable:"",onChange:Ne},{default:C((()=>[(x(),h(V,null,j(Ie,(e=>I(n,{key:e.value,value:e.value,label:e.label},null,8,["value","label"]))),64))])),_:1},8,["modelValue"])])),_:1}),I(r,{class:"m-0"},{default:C((()=>[I(i,{modelValue:ve.workRiskLevels,"onUpdate:modelValue":a[2]||(a[2]=e=>ve.workRiskLevels=e),placeholder:"风险等级",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",onChange:Ne},{default:C((()=>[(x(!0),h(V,null,j(L(N)().workRiskLevelList,(e=>(x(),_(n,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),I(r,{class:"m-0"},{default:C((()=>[I(i,{modelValue:ve.voltageLevels,"onUpdate:modelValue":a[3]||(a[3]=e=>ve.voltageLevels=e),placeholder:"电压等级",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",onChange:Ne},{default:C((()=>[(x(!0),h(V,null,j(L(N)().voltageLevelList,(e=>(x(),_(n,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),I(r,{class:"m-0"},{default:C((()=>[I(i,{modelValue:ve.majorTypes,"onUpdate:modelValue":a[4]||(a[4]=e=>ve.majorTypes=e),placeholder:"专业分类",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",onChange:Ne},{default:C((()=>[(x(!0),h(V,null,j(L(N)().workerMajorList,(e=>(x(),_(n,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),I(r,{class:"col-span-3 m-0"},{default:C((()=>[I(u,{modelValue:ve.keyWord,"onUpdate:modelValue":a[5]||(a[5]=e=>ve.keyWord=e),placeholder:"请输入计划名称/班组名称/人员/电力作业记录仪",clearable:""},{prepend:C((()=>[I(c,{icon:L(R)},null,8,["icon"])])),append:C((()=>[I(c,{loading:Ae.value,class:"search-text",onClick:Ne},{default:C((()=>[z("搜索")])),_:1},8,["loading"])])),_:1},8,["modelValue"])])),_:1})])),_:1},512),w("div",{ref_key:"tabRef",ref:d,class:"flex flex-row items-center justify-between gap-x-[14px]"},[w("div",K,[(x(),h(V,null,j(Ce,(e=>w("div",{key:e.value,class:P(["tab-btn cursor-pointer",{active:ve.status===e.value}]),onClick:l=>{return a=e.value,ve.status=a,void Ne();var a}},[w("span",$,F(e.label),1)],10,X))),64))]),w("div",ee,[le,w("img",{src:ve.queryTmpFlag?L(H):L(D),class:"h-full aspect-[56/24] cursor-pointer",onClick:we},null,8,ae)])],512),U((x(),h("div",{class:"flex flex-col p-2",style:q([{"overflow-y":"auto","background-color":"#09455b"},Y.value])},[Ve.value[0].children.length?(x(),_(f,{key:0,"node-key":"id","current-node-key":"0","default-expanded-keys":["0"],accordion:!0,"expand-on-click-node":!1,"highlight-current":!1,data:Ve.value},{default:C((({node:e,data:l})=>["0"===l.id?(x(),h("div",te,[w("span",null,F(l.label),1),w("span",oe,"计划共计："+F(ke.total)+"项",1)])):2===e.level?(x(),h("div",se,[w("div",re,[w("span",ne,F(l.label),1)]),w("div",{class:P(["text-xs rounded px-[4px] py-[1px]",[`tag-${l.workRiskLevel}`]]),onClick:T((e=>_e(l)),["stop"])},F(l.workRiskLevelName),11,ie),I(m,{color:"1"==l.isImportant?"#ef4444":"#d1d5db",size:"16",onClick:T((e=>je(l)),["stop"])},{default:C((()=>[I(L(O))])),_:2},1032,["color","onClick"])])):(x(),h("div",ce,[w("div",null,"市级公司："+F(l.cityOrgName),1),w("div",null,"行政区划："+F(l.belongCountyName),1),w("div",null,"管理单位："+F(l.orgName),1),w("div",null,"施工单位："+F(l.workingGroups),1),w("div",ue,[de,w("div",pe,[(x(!0),h(V,null,j(l.patrolTaskExecExtList,(e=>(x(),h("div",{key:e.deviceCode,class:"flex flex-row items-start gap-x-4"},[w("div",me,[w("span",{class:P([e.taskOnline?"text-[#24ecff]":"text-[#909399]"]),style:{"word-wrap":"break-word","white-space":"pre-wrap"}},F(e.userRealName)+"（"+F(e.deviceName)+"） ",3)]),e.taskOnline?(x(),h("img",{key:0,class:"w-[24px]",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABHNCSVQICAgIfAhkiAAAAa9JREFUOI2tlLFuE0EURc9bVopSoAxCos8XsNQ0aVMBJQWy8wfQQuMWKhdIpGMlClrzBUlDb74glpIaz6xsoaD1XIr1bpL1biRbXGmkeZo7d+57b2bgP8PqiaQMeLGjzg8zmzaCYaUc4wgxAfyWYg7jJeLs4IGdcCVllyvNLiS3ozsuJHe50uxKypJ5ifOR2aHZts4aHJp5H5nNS1zqgUR3CT+vNZFxcJ+ICf98z17VcSGIBumiBNldchEZ345jwthAFnnXd0CIYILUA7QcHu/beT3//kc5kafrcPB63046BdcaiV/b7cKXpfIgBkHVhiCGp0t97eIWqq5H4kvwcZPwcaG8EIMQq3SaIYafFpuiPoIvIVneslvjQ1GJFapObo8ghu9bokGwpKeGwciBHDGGpn41fmG8be8pBBikvgRrdfnzw6opb7y67qb/5m6a1piIIEG6AGJPU9qluA9BkNCTco1Cm0vWyWyl3Mfy4rxDcdLJjZWx1AOm7mc2fWyjHkMbCMIJMDeXS/4yNePMqu5uDYmh4NnvJ5ZVyc7l0mtGQLaLIDAt9xjxaPcfqxf/AEbB4Fr/iYnxAAAAAElFTkSuQmCC",onClick:l=>Re(e)},null,8,fe)):G("",!0)])))),128))])]),w("div",null,"联系方式："+F(l.fzrPhone),1)]))])),_:1},8,["data"])):(x(),h("div",ge,[I(g,{description:"暂无数据",image:L(Q),"image-size":80},null,8,["image"])]))],4)),[[k,Ae.value]]),I(v,{ref_key:"paginationRef",ref:W,"current-page":ke.pageNum,"onUpdate:currentPage":a[6]||(a[6]=e=>ke.pageNum=e),"page-size":ke.pageSize,"onUpdate:pageSize":a[7]||(a[7]=e=>ke.pageSize=e),"pager-count":5,small:"",background:"",layout:"total, sizes, prev, pager, next",total:ke.total,"page-sizes":[10,20,30,40,50,100],onSizeChange:be,onCurrentChange:ye},null,8,["current-page","page-size","total"])],512)}}})),[["__scopeId","data-v-27e82403"]]);export{ve as default};
