var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(t,a,i)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i;import"./linesGL-UdMq74_O.js";import{B as n}from"./index.esm.min-p6OgvXm7.js";import{o as l}from"./StatisticalCenter-fzPo9Omj.js";import{E as c}from"./icon_no_data-JkxAPqfn.js";import{d as m}from"./constants-uiyZ18jc.js";import{d as u,a0 as p,A as d,n as h,V as f,r as v,o as y,c as g,e as x,b as M,h as b,u as D,a2 as j,J as w,L as S,g as I,a5 as O,R as C,U as P,a1 as _,_ as k}from"./index-OtYEJMgP.js";import{e as R}from"./mitt-ei5ABelY.js";import{u as A,i as z}from"./installCanvasRenderer-kp6nwiR2.js";import{i as N}from"./install-50C6z8uZ.js";import{i as V}from"./install-nwvgNUQF.js";import{i as $}from"./install-XFuIEcts.js";import"./Axis-xmqQ_bGV.js";import"./installLabelLayout-tlP3-N5v.js";import"./createSeriesData-rVoIjXPv.js";import"./install-FXlg7-M8.js";import"./sectorHelper-nVwTOMBE.js";const E={class:"item"},F=(e=>(C("data-v-c811c2c8"),e=e(),P(),e))((()=>x("div",{class:"item-title"},[x("span",{class:"item-title-text"},"设备使用次数分布")],-1))),L={class:"item-content table-container"},T={class:"flex-1 flex flex-row w-full"},U={key:1,class:"flex-1 flex flex-row items-center justify-center"},Y=u((q=((e,t)=>{for(var a in t||(t={}))o.call(t,a)&&r(e,a,t[a]);if(i)for(var a of i(t))s.call(t,a)&&r(e,a,t[a]);return e})({},{name:"DeviceUsageCount"}),H={__name:"index",setup(e){A([z,N,V,$]);const t=p({cityOrgId:"",time:m.range.default}),a=d(!1),i=["#E84200","#F78A38","#E3CD00","#409AF3","#0BC467"],o=d([]),s=O((()=>{return e=this,s=null,r=function*(){a.value=!0;const{cityOrgId:e,time:s}=t,[r="",n=""]=s;l({cityOrgId:e,beginDate:r,endDate:n}).then((e=>{_!==e&&(o.value=(e=>{const t={zeroCount:"0次",oneToThreeCount:"1-3次",fourToSixCount:"4-6次",sevenToNineCount:"7-9次",aboveTenCount:"10次及以上"};return Object.keys(t).map(((a,o)=>({name:t[a],value:parseInt(e[a])+20,itemStyle:{color:i[o%i.length],opacity:1}})))})(e))})).finally((()=>{a.value=!1}))},new Promise(((t,a)=>{var i=e=>{try{n(r.next(e))}catch(t){a(t)}},o=e=>{try{n(r.throw(e))}catch(t){a(t)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(i,o);n((r=r.apply(e,s)).next())}));var e,s,r}),1e3),r=h((()=>{const e=P(o.value,.85);return e.series.push({label:{show:!0,position:"outside",formatter:function(e){return`${e.value-20}台，${e.percent}%`},color:"#fff"},labelLine:{show:!0,length:"20",length2:"20",lineStyle:{width:1}},type:"pie",startAngle:-40,clockwise:!1,radius:["60%","60%"],center:["40%","50%"],data:o.value,itemStyle:{opacity:0},hoverAnimation:!1}),e})),u=(e,t)=>{let a=parseFloat(e);if(isNaN(a))return!1;a=Math.round(e*Math.pow(10,t))/Math.pow(10,t);let i=a.toString(),o=i.indexOf(".");for(o<0&&(o=i.length,i+=".");i.length<=o+t;)i+="0";return i},C=(e,t,a,i,o,s)=>{const r=(e+t)/2,n=e*Math.PI*2,l=t*Math.PI*2,c=r*Math.PI*2;0===e&&1===t&&(a=!1),o=void 0!==o?o:1/3;const m=a?.1*Math.cos(c):0,u=a?.1*Math.sin(c):0,p=i?1.05:1;return{u:{min:-Math.PI,max:3*Math.PI,step:Math.PI/32},v:{min:0,max:2*Math.PI,step:Math.PI/20},x:function(e,t){return e<n?m+Math.cos(n)*(1+Math.cos(t)*o)*p:e>l?m+Math.cos(l)*(1+Math.cos(t)*o)*p:m+Math.cos(e)*(1+Math.cos(t)*o)*p},y:function(e,t){return e<n?u+Math.sin(n)*(1+Math.cos(t)*o)*p:e>l?u+Math.sin(l)*(1+Math.cos(t)*o)*p:u+Math.sin(e)*(1+Math.cos(t)*o)*p},z:function(e,t){return e<.5*-Math.PI?Math.sin(e):e>2.5*Math.PI?Math.sin(e)*s*.1:Math.sin(t)>0?1*s*.1:-1}}},P=(e,t)=>{const a=[];let i=0,s=0,r=0,n=[],l=[];const c=1-t;e.sort(((e,t)=>t.value-e.value));for(let o=0;o<e.length;o++){i+=e[o].value;const t={name:void 0===e[o].name?`series${o}`:e[o].name,type:"surface",parametric:!0,wireframe:{show:!1},pieData:e[o],pieStatus:{selected:!1,hovered:!1,k:c}};if(void 0!==e[o].itemStyle){const a={};void 0!==e[o].itemStyle.color&&(a.color=e[o].itemStyle.color),void 0!==e[o].itemStyle.opacity&&(a.opacity=e[o].itemStyle.opacity),t.itemStyle=a}a.push(t)}n=[],l=[];for(let o=0;o<a.length;o++){r=s+a[o].pieData.value,a[o].pieData.startRatio=s/i,a[o].pieData.endRatio=r/i,a[o].parametricEquation=C(a[o].pieData.startRatio,a[o].pieData.endRatio,!1,!1,c,a[o].pieData.value),s=r;const e=u(a[o].pieData.value/i,4);n.push({name:a[o].name,value:e}),l.push({name:a[o].name,value:e})}const m=((e,t)=>(e.sort(((e,t)=>t.pieData.value-e.pieData.value)),25*t/e[0].pieData.value))(a,6),p={tooltip:{show:!1,formatter:e=>{if("mouseoutSeries"!==e.seriesName&&"pie2d"!==e.seriesName){const t=(100*(p.series[e.seriesIndex].pieData.endRatio-p.series[e.seriesIndex].pieData.startRatio)).toFixed(0);return`${e.seriesName}<br/><span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:${e.color};"></span>${t}%`}}},xAxis3D:{min:-1,max:1},yAxis3D:{min:-1,max:1},zAxis3D:{min:-1,max:1},grid3D:{show:!1,boxHeight:m,left:"-10%",top:-10,viewControl:{alpha:30,distance:180,rotateSensitivity:0,zoomSensitivity:0,panSensitivity:0,autoRotate:!1}},legend:{orient:"vertical",x:"right",y:"center",padding:[0,20,0,0],align:"left",itemWidth:10,itemHeight:10,itemGap:20,selectedMode:!1,formatter:function(e){return`{name| ${e} }`},textStyle:{color:"auto",fontSize:14,rich:{name:{padding:[0,0,0,10],color:"#fff"}}},data:o.value},series:a};return p};return f((()=>{R.on("StatisticalCenterDeviceStatisticsReload",(()=>{s()}))})),(e,a)=>{const i=v("el-option"),l=v("el-select"),m=v("el-form-item"),u=v("el-date-picker"),p=v("el-form"),d=v("el-empty");return y(),g("div",E,[F,x("div",L,[M(p,{inline:!0,"label-suffix":"：",class:"w-full table-query"},{default:b((()=>[M(m,{class:"m-0"},{default:b((()=>[M(l,{modelValue:t.cityOrgId,"onUpdate:modelValue":a[0]||(a[0]=e=>t.cityOrgId=e),placeholder:"请选择市级公司",clearable:"",onFocus:D(j)().loadCityOrg,onChange:D(s)},{default:b((()=>[(y(!0),g(w,null,S(D(j)().cityOrg,(e=>(y(),I(i,{key:e.id,value:e.id,label:e.shortName||e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue","onFocus","onChange"])])),_:1}),M(m,{class:"m-0"},{default:b((()=>[M(u,{modelValue:t.time,"onUpdate:modelValue":a[1]||(a[1]=e=>t.time=e),"value-format":"YYYY-MM-DD",type:"daterange","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",editable:!1,clearable:!1,onChange:D(s)},null,8,["modelValue","onChange"])])),_:1})])),_:1}),x("div",T,[o.value.length>0?(y(),I(D(n),{key:0,ref:"vchart",class:"flex-1 flex",option:r.value,autoresize:""},null,8,["option"])):(y(),g("div",U,[M(d,{description:"暂无数据",image:D(c),"image-size":80},null,8,["image"])]))])])])}}},t(q,a(H))));var q,H;const G=k(Y,[["__scopeId","data-v-c811c2c8"]]);export{G as default};
