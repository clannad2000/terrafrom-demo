var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,n=(e,a,l)=>new Promise(((t,o)=>{var s=e=>{try{n(l.next(e))}catch(a){o(a)}},r=e=>{try{n(l.throw(e))}catch(a){o(a)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(s,r);n((l=l.apply(e,a)).next())}));import{a3 as p,d as i,A as u,a0 as c,Y as d,n as m,z as g,F as b,r as f,j as h,o as w,g as y,h as v,w as x,c as k,e as C,b as j,a4 as T,u as _,a2 as S,J as N,L as V,f as z,M as I,N as U,a5 as O,a6 as P,a1 as D}from"./index-OtYEJMgP.js";import{a as Y}from"./constants-uiyZ18jc.js";import{d as F}from"./download-z--BcN7F.js";import M from"./AlarmDetailDialog-IVTUcFSI.js";const R={class:"h-full table-container"},A={class:"flex flex-col h-full gap-y-4"},L=i((B=((e,a)=>{for(var l in a||(a={}))o.call(a,l)&&r(e,l,a[l]);if(t)for(var l of t(a))s.call(a,l)&&r(e,l,a[l]);return e})({},{name:"AlarmCenterIndex"}),a(B,l({__name:"index",setup(e){const a=e=>"0"===e.status,l=u(!1),t=c({orgId:"",majorTypes:[],alarmTypes:[],alarmStatus:"0",time:Y.range.default}),o=d([]),s=c({pageNum:1,pageSize:10,total:0}),r=u([]),i=e=>{r.value=e.map((e=>e.id||""))},L=m((()=>({nodeKey:"id",props:{label:e=>e.shortName||e.name,children:"children"}}))),B=O((()=>n(this,null,(function*(){l.value=!0;const{pageSize:e,pageNum:a}=s,{orgId:r,majorTypes:n,alarmTypes:i,alarmStatus:u,time:c=[]}=t,[d="",m=""]=c;var g;yield(g={orgId:r,majorTypes:n.join(","),alarmTypes:i.join(","),alarmStatus:u,beginTime:d,endTime:m,pageSize:e,pageNum:a},p.get({url:"/alarmCenter/page",params:g})).then((e=>{if(e&&D!==e){const{rows:a=[],total:l=0}=e;o.value=a,s.total=Number(l)||0}})).finally((()=>{l.value=!1}))}))),1e3),E=()=>{s.pageNum=1,B()},H=O((()=>n(this,null,(function*(){l.value=!0;const{orgId:e,majorTypes:a,alarmTypes:o,alarmStatus:r,time:n=[]}=t,[i="",u=""]=n,{pageNum:c,pageSize:d}=s;var m;yield(m={orgId:e,majorTypes:a.join(","),alarmTypes:o.join(","),alarmStatus:r,beginTime:i,endTime:u,pageNum:c,pageSize:d},p.get({url:"/alarmCenter/export/excel",params:m,responseType:"blob"},{isDownload:!0})).then((e=>{if(e&&(null==e?void 0:e.data)){const a=e.headers["content-disposition"];let l="unknown";a&&(l=window.decodeURI(a.split("=")[1])),F(e.data,l)}})).finally((()=>{l.value=!1}))}))),1e3),q=()=>{r.value.length?J(r.value.join(",")):P.error("请选择需要确认的告警数据!")},J=e=>n(this,null,(function*(){var a;l.value=!0,yield(a={alarmIds:e},p.post({url:"/alarmCenter/confirm",params:a})).then((e=>{D!==e&&(P.success("确认成功!"),B())})).finally((()=>{l.value=!1}))})),[K,{showDialog:G,setDialogProps:Q}]=g(),W=()=>{B()};return b((()=>{B()})),(e,n)=>{const p=f("el-tree-select"),u=f("el-form-item"),c=f("el-option"),d=f("el-select"),m=f("el-date-picker"),g=f("el-button"),b=f("el-form"),O=f("el-table-column"),P=f("el-popconfirm"),D=f("el-table"),Y=f("el-pagination"),F=f("el-main"),B=h("loading");return w(),y(F,null,{default:v((()=>[x((w(),k("div",R,[C("div",A,[j(b,{inline:!0,"label-suffix":"：",class:"w-full table-query"},{default:v((()=>[j(u,{label:"管理部门",class:"m-0"},{default:v((()=>[j(p,T({modelValue:t.orgId,"onUpdate:modelValue":n[0]||(n[0]=e=>t.orgId=e),data:_(S)().orgTreeByUser,"render-after-expand":!1,clearable:""},L.value,{"check-strictly":!0,"highlight-current":!0,"expand-on-click-node":!1,placeholder:"请选择管理部门",onFocus:_(S)().loadOrgTreeByUser}),null,16,["modelValue","data","onFocus"])])),_:1}),j(u,{label:"专业",class:"m-0"},{default:v((()=>[j(d,{modelValue:t.majorTypes,"onUpdate:modelValue":n[1]||(n[1]=e=>t.majorTypes=e),placeholder:"请选择专业",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:v((()=>[(w(!0),k(N,null,V(_(S)().workerMajorList,(e=>(w(),y(c,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),j(u,{label:"告警类型",class:"m-0"},{default:v((()=>[j(d,{modelValue:t.alarmTypes,"onUpdate:modelValue":n[2]||(n[2]=e=>t.alarmTypes=e),placeholder:"请选择告警类型",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:v((()=>[(w(!0),k(N,null,V(_(S)().alarmTypeList,(e=>(w(),y(c,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),j(u,{label:"告警状态",class:"m-0"},{default:v((()=>[j(d,{modelValue:t.alarmStatus,"onUpdate:modelValue":n[3]||(n[3]=e=>t.alarmStatus=e),placeholder:"请选择告警状态",clearable:""},{default:v((()=>[j(c,{value:"0",label:"未处理"}),j(c,{value:"1",label:"已处理"})])),_:1},8,["modelValue"])])),_:1}),j(u,{label:"时间",class:"col-span-2 m-0"},{default:v((()=>[j(m,{modelValue:t.time,"onUpdate:modelValue":n[4]||(n[4]=e=>t.time=e),"value-format":"YYYY-MM-DD HH:mm:ss",type:"datetimerange","unlink-panels":"","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",editable:!1,clearable:!1},null,8,["modelValue"])])),_:1}),j(u,{class:"m-0"},{default:v((()=>[j(g,{class:"basic-button",loading:l.value,onClick:E},{default:v((()=>[z(" 查询 ")])),_:1},8,["loading"]),j(g,{class:"basic-button",loading:l.value,onClick:_(H)},{default:v((()=>[z(" 导出 ")])),_:1},8,["loading","onClick"]),j(g,{class:"basic-button",disabled:l.value||!r.value.length,onClick:q},{default:v((()=>[z(" 批量确认 ")])),_:1},8,["disabled"])])),_:1})])),_:1}),j(D,{class:"w-full h-full",data:o.value,onSelectionChange:i},{default:v((()=>[j(O,{type:"selection",width:"80",selectable:a}),j(O,{prop:"alarmContent",align:"center",label:"告警内容","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),j(O,{prop:"workContent",align:"center",label:"作业内容","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),j(O,{prop:"workPlace",align:"center",label:"作业地点","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),j(O,{prop:"triggerUserRealName",align:"center",label:"工作人员","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),j(O,{prop:"deviceName",align:"center",label:"设备名称","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),j(O,{prop:"alarmTypeName",align:"center",label:"告警类型","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),j(O,{prop:"statusName",align:"center",label:"告警状态","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),j(O,{fixed:"right",label:"操作",width:"200",align:"center"},{default:v((({row:e})=>[j(g,{type:"primary",link:"",onClick:a=>(e=>{Q({title:"任务详情"}),G(!0,{type:"view",data:e})})(e)},{default:v((()=>[z(" 详情 ")])),_:2},1032,["onClick"]),"0"==e.status?(w(),y(P,{key:0,title:"是否确认告警?",onConfirm:a=>(e=>{const{id:a=""}=e;J(a)})(e)},{reference:v((()=>[j(g,{link:"",type:"danger",onClick:n[5]||(n[5]=I((()=>{}),["stop"]))},{default:v((()=>[z(" 确认 ")])),_:1})])),_:2},1032,["onConfirm"])):U("",!0)])),_:1})])),_:1},8,["data"]),j(Y,{"current-page":s.pageNum,"onUpdate:currentPage":n[6]||(n[6]=e=>s.pageNum=e),"page-size":s.pageSize,"onUpdate:pageSize":n[7]||(n[7]=e=>s.pageSize=e),background:"",small:"",layout:"total, sizes, prev, pager, next, jumper",total:s.total,"page-sizes":[10,20,30,40,50,100],onSizeChange:E,onCurrentChange:W},null,8,["current-page","page-size","total"])]),j(M,{onRegister:_(K)},null,8,["onRegister"])])),[[B,l.value]])])),_:1})}}}))));var B;export{L as default};
