var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,t=(a,l,r)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[l]=r;import{t as n}from"./DeviceManage-aryRM0Sb.js";import{d as i,z as u,a8 as c,A as m,Y as d,a0 as p,H as f,r as g,o as b,g as v,h as y,e as h,b as N,f as w,u as j,ab as O,c as D,J as _,L as x,a9 as P,$ as V,a1 as C,a6 as I}from"./index-OtYEJMgP.js";import{U as k}from"./index-fHT9WYUA.js";const R={class:"dialog-footer"},S=i((U=((e,a)=>{for(var l in a||(a={}))s.call(a,l)&&t(e,l,a[l]);if(r)for(var l of r(a))o.call(a,l)&&t(e,l,a[l]);return e})({},{name:"ScrapDialog"}),a(U,l({__name:"ScrapDialog",emits:["register","confirm"],setup(e,{emit:a}){const[l,{showDialog:r,setDialogProps:s}]=u();let o="";const t=a,[i,{closeDialog:S}]=c((e=>{const{type:a,data:l}=e;if(o=a,"scrap"===a){console.log(l);const{id:e}=l;Object.assign(H,{bindDeviceId:e})}})),U=m(!1),$=m(null),q={userNames:[{required:!0,message:"请选择审批人员！",trigger:"change"}],reason:[{required:!0,message:"请填写报废原因！",trigger:"blur"},{max:256,message:"报废原因长度不能超过256位！",trigger:"blur"}]},z=e=>{const{personnel:a=[]}=e;V(a)&&(H.userNames=a.map((e=>e.userName)),H.realNames=a.map((e=>e.realName)),F.value=a)},A=m(null),E=e=>{var a;e&&(null==(a=A.value)||a.blur(),s({title:"选择人员"}),r(!0,{type:"add",tabs:["principalOrg","outsourceOrg"],isSingle:!0}))},F=d([]),H=p({bindDeviceId:"",userNames:[],realNames:[],reason:"",deviceCode:""}),J=function(){var e;U.value=!1,S(),o="",Object.assign(H,{bindDeviceId:"",userNames:[],realNames:[],reason:"",deviceCode:""}),null==(e=$.value)||e.clearValidate()},K=function(){var e;null==(e=$.value)||e.validate((e=>{return a=this,l=null,r=function*(){if(e){const{bindDeviceId:e,userNames:a,realNames:l,reason:r}=H;U.value=!0,"scrap"===o?n({bindDeviceId:e,cityUserName:a.join(","),cityRealName:l.join(","),reason:r}).then((e=>{C!==e&&(I.success("提交成功！"),J(),t("confirm"))})).finally((()=>{U.value=!1})):U.value=!1}},new Promise(((e,s)=>{var o=e=>{try{n(r.next(e))}catch(a){s(a)}},t=e=>{try{n(r.throw(e))}catch(a){s(a)}},n=a=>a.done?e(a.value):Promise.resolve(a.value).then(o,t);n((r=r.apply(a,l)).next())}));var a,l,r}))};return f((()=>{J()})),(e,a)=>{const r=g("el-option"),s=g("el-select"),o=g("el-form-item"),t=g("el-input"),n=g("el-button");return b(),v(j(P),{width:"600","show-fullscreen":!1,"show-close":!1,"destroy-on-close":"",center:"",onClose:J,onRegister:j(i)},{footer:y((()=>[h("span",R,[N(n,{class:"basic-button",disabled:U.value,onClick:J},{default:y((()=>[w(" 取消 ")])),_:1},8,["disabled"]),N(n,{class:"basic-button",loading:U.value,onClick:K},{default:y((()=>[w(" 保存 ")])),_:1},8,["loading"])])])),default:y((()=>[N(j(O),{ref_key:"refScrapForm",ref:$,model:H,rules:q,"label-width":"180px","label-suffix":"："},{default:y((()=>[N(o,{label:"地市管控中心审批人",prop:"userNames"},{default:y((()=>[N(s,{ref_key:"refPersonnel",ref:A,modelValue:H.userNames,"onUpdate:modelValue":a[0]||(a[0]=e=>H.userNames=e),multiple:"","collapse-tags":"","collapse-tags-tooltip":"",placeholder:"请选择审批人",onVisibleChange:E},{default:y((()=>[(b(!0),D(_,null,x(F.value,(e=>(b(),v(r,{key:e.userName,label:e.realName,value:e.userName},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),N(o,{label:"报废原因",prop:"reason"},{default:y((()=>[N(t,{modelValue:H.reason,"onUpdate:modelValue":a[1]||(a[1]=e=>H.reason=e),clearable:"",maxlength:"256","show-word-limit":"",rows:4,type:"textarea",placeholder:"请填写报废原因",parser:e=>e.replace(/^\s*|\s*$/g,""),formatter:e=>e.replace(/^\s*|\s*$/g,"")},null,8,["modelValue","parser","formatter"])])),_:1})])),_:1},8,["model"]),N(k,{onRegister:j(l),onConfirm:z},null,8,["onRegister"])])),_:1},8,["onRegister"])}}}))));var U;export{S as _};
