var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,r=(a,l,o)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[l]=o;import{g as p,d as i}from"./PlanManage-UfdB-sAa.js";import{d as n,z as c,A as m,a0 as d,Y as u,n as g,F as w,r as b,j as v,w as f,o as k,c as h,e as x,b as y,h as N,a4 as j,u as L,a2 as V,J as _,L as R,g as P,f as C,I as z,a1 as T}from"./index-OtYEJMgP.js";import{a as U}from"./constants-uiyZ18jc.js";import{d as I}from"./download-z--BcN7F.js";import{_ as O}from"./ViewPatrolDetailDialog.vue_vue_type_script_setup_true_lang-yjL-JL4-.js";const S={class:"h-full table-container"},D={class:"flex flex-col h-full gap-y-4"},F=n((Y=((e,a)=>{for(var l in a||(a={}))s.call(a,l)&&r(e,l,a[l]);if(o)for(var l of o(a))t.call(a,l)&&r(e,l,a[l]);return e})({},{name:"InspectionPlanIndex"}),a(Y,l({__name:"index",setup(e){const[a,{showDialog:l,setDialogProps:o}]=c(),s=m(!1),t=d({orgId:"",majorTypes:[],workRiskLevels:[],gridRiskLevels:[],workProgress:[],stationName:"",voltageLevels:[],time:U.range.default,taskName:"",fzrRealName:""}),r=u([]),n=d({pageNum:1,pageSize:10,total:0}),F=g((()=>({nodeKey:"id",props:{label:e=>e.shortName||e.name,children:"children"}}))),Y=()=>{s.value=!0;const{pageSize:e,pageNum:a}=n,{orgId:l,majorTypes:o,workRiskLevels:i,gridRiskLevels:c,workProgress:m,stationName:d,voltageLevels:u,time:g=[],taskName:w,fzrRealName:b}=t,[v="",f=""]=g;p({orgId:l,majorType:o.join(","),workRiskLevel:i.join(","),gridRiskLevel:c.join(","),workProgress:m.join(","),stationName:d,voltageLevel:u.join(","),beginTime:v,endTime:f,taskName:w,fzrRealName:b,queryPatrolFlag:"1",pageSize:e,pageNum:a}).then((e=>{if(e&&T!==e){const{rows:a=[],total:l=0}=e;r.value=a,n.total=Number(l)||0}})).finally((()=>{s.value=!1}))},M=()=>{n.pageNum=1,Y()},q=()=>{return e=this,a=null,l=function*(){s.value=!0;const{orgId:e,majorTypes:a,workRiskLevels:l,gridRiskLevels:o,workProgress:r,stationName:p,voltageLevels:n,time:c=[],taskName:m,fzrRealName:d}=t,[u="",g=""]=c;yield i({orgId:e,majorType:a.join(","),workRiskLevel:l.join(","),gridRiskLevel:o.join(","),workProgress:r.join(","),stationName:p,voltageLevel:n.join(","),beginTime:u,endTime:g,taskName:m,fzrRealName:d,queryPatrolFlag:"1"}).then((e=>{if(e&&(null==e?void 0:e.data)){const a=e.headers["content-disposition"];let l="unknown";a&&(l=window.decodeURI(a.split("=")[1])),I(e.data,l)}})).finally((()=>{s.value=!1}))},new Promise(((o,s)=>{var t=e=>{try{p(l.next(e))}catch(a){s(a)}},r=e=>{try{p(l.throw(e))}catch(a){s(a)}},p=e=>e.done?o(e.value):Promise.resolve(e.value).then(t,r);p((l=l.apply(e,a)).next())}));var e,a,l},B=()=>{Y()};return w((()=>{Y()})),(e,p)=>{const i=b("el-tree-select"),c=b("el-form-item"),m=b("el-option"),d=b("el-select"),u=b("el-input"),g=b("el-date-picker"),w=b("el-button"),T=b("el-form"),U=b("el-table-column"),I=b("el-table"),Y=b("el-pagination"),E=v("loading");return f((k(),h("div",S,[x("div",D,[y(T,{inline:!0,"label-suffix":"：",class:"w-full table-query"},{default:N((()=>[y(c,{label:"管理部门",class:"m-0"},{default:N((()=>[y(i,j({modelValue:t.orgId,"onUpdate:modelValue":p[0]||(p[0]=e=>t.orgId=e),data:L(V)().orgTreeByUser,"render-after-expand":!1,clearable:""},F.value,{"check-strictly":!0,"highlight-current":!0,"expand-on-click-node":!1,placeholder:"请选择管理部门",onFocus:L(V)().loadOrgTreeByUser}),null,16,["modelValue","data","onFocus"])])),_:1}),y(c,{label:"专业",class:"m-0"},{default:N((()=>[y(d,{modelValue:t.majorTypes,"onUpdate:modelValue":p[1]||(p[1]=e=>t.majorTypes=e),placeholder:"请选择专业",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:N((()=>[(k(!0),h(_,null,R(L(V)().workerMajorList,(e=>(k(),P(m,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),y(c,{label:"作业风险等级",class:"m-0"},{default:N((()=>[y(d,{modelValue:t.workRiskLevels,"onUpdate:modelValue":p[2]||(p[2]=e=>t.workRiskLevels=e),placeholder:"请选择作业风险等级",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:N((()=>[(k(!0),h(_,null,R(L(V)().workRiskLevelList,(e=>(k(),P(m,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),y(c,{label:"电网风险等级",class:"m-0"},{default:N((()=>[y(d,{modelValue:t.gridRiskLevels,"onUpdate:modelValue":p[3]||(p[3]=e=>t.gridRiskLevels=e),placeholder:"请选择电网风险等级",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:N((()=>[(k(!0),h(_,null,R(L(V)().gridRiskLevelList,(e=>(k(),P(m,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),y(c,{label:"作业状态",class:"m-0"},{default:N((()=>[y(d,{modelValue:t.workProgress,"onUpdate:modelValue":p[4]||(p[4]=e=>t.workProgress=e),placeholder:"请选择作业状态",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:N((()=>[(k(!0),h(_,null,R(L(V)().workProgressList.filter((e=>["2101001","2101002","2101004"].includes(e.code))),(e=>(k(),P(m,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),y(c,{label:"变电站",class:"m-0"},{default:N((()=>[y(u,{modelValue:t.stationName,"onUpdate:modelValue":p[5]||(p[5]=e=>t.stationName=e),clearable:"",placeholder:"请输入变电站",maxlength:"20"},null,8,["modelValue"])])),_:1}),y(c,{label:"电压等级",class:"m-0"},{default:N((()=>[y(d,{modelValue:t.voltageLevels,"onUpdate:modelValue":p[6]||(p[6]=e=>t.voltageLevels=e),placeholder:"请选择电压等级",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:N((()=>[(k(!0),h(_,null,R(L(V)().voltageLevelList,(e=>(k(),P(m,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),y(c,{label:"计划时间",class:"col-span-2 m-0"},{default:N((()=>[y(g,{modelValue:t.time,"onUpdate:modelValue":p[7]||(p[7]=e=>t.time=e),"value-format":"YYYY-MM-DD HH:mm:ss",type:"datetimerange","unlink-panels":"","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",editable:!1,clearable:!1},null,8,["modelValue"])])),_:1}),y(c,{label:"任务名称",class:"m-0"},{default:N((()=>[y(u,{modelValue:t.taskName,"onUpdate:modelValue":p[8]||(p[8]=e=>t.taskName=e),clearable:"",maxlength:"20",placeholder:"请输入任务名称",formatter:e=>e.replace(/^\s*|\s*$/g,""),parser:e=>e.replace(/^\s*|\s*$/g,"")},null,8,["modelValue","formatter","parser"])])),_:1}),y(c,{label:"工作负责人",class:"m-0"},{default:N((()=>[y(u,{modelValue:t.fzrRealName,"onUpdate:modelValue":p[9]||(p[9]=e=>t.fzrRealName=e),clearable:"",placeholder:"请输入工作负责人",maxlength:"20"},null,8,["modelValue"])])),_:1}),y(c,{class:"m-0"},{default:N((()=>[y(w,{class:"basic-button",onClick:M},{default:N((()=>[C(" 查询 ")])),_:1}),y(w,{class:"basic-button",onClick:q},{default:N((()=>[C(" 导出 ")])),_:1})])),_:1})])),_:1}),y(I,{class:"w-full h-full",data:r.value,"show-overflow-tooltip":""},{default:N((()=>[y(U,{prop:"cityOrgName",align:"center",label:"市级公司","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(U,{prop:"orgName",align:"center",label:"管理部门","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(U,{prop:"taskName",align:"center",label:"任务名称","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(U,{prop:"stationName",align:"center",label:"变电站名称","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(U,{prop:"beginTime",align:"center",label:"计划开始时间","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(U,{prop:"endTime",align:"center",label:"计划结束时间","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(U,{prop:"majorTypeName",align:"center",label:"所属专业","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(U,{prop:"workContent",align:"center",label:"作业内容","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(U,{prop:"workRiskLevelName",align:"center",label:"作业风险等级","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(U,{prop:"fzrRealName",align:"center",label:"工作负责人","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(U,{prop:"fzrPhone",align:"center",label:"联系方式","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(U,{prop:"voltageLevelName",align:"center",label:"电压等级","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(U,{prop:"sgOrgName",align:"center",label:"施工单位","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(U,{prop:"workProgressName",align:"center",label:"作业状态","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(U,{prop:"patrolNum",align:"center",label:"督查次数","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}},{default:N((({row:e})=>[y(w,{type:"primary",link:"",onClick:a=>(e=>{o({title:"督查明细"}),l(!0,{type:"view",data:{taskId:e.taskId}})})(e)},{default:N((()=>[C(z(e.patrolNum||0),1)])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),y(Y,{"current-page":n.pageNum,"onUpdate:currentPage":p[10]||(p[10]=e=>n.pageNum=e),"page-size":n.pageSize,"onUpdate:pageSize":p[11]||(p[11]=e=>n.pageSize=e),background:"",small:"",layout:"total, sizes, prev, pager, next, jumper",total:n.total,"page-sizes":[10,20,30,40,50,100],onSizeChange:M,onCurrentChange:B},null,8,["current-page","page-size","total"])]),y(O,{onRegister:L(a)},null,8,["onRegister"])])),[[E,s.value]])}}}))));var Y;export{F as _};
