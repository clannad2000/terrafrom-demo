var e=Object.defineProperty,l=Object.defineProperties,a=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,s=(l,a,o)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[a]=o,n=(e,l)=>{for(var a in l||(l={}))r.call(l,a)&&s(e,a,l[a]);if(o)for(var a of o(l))t.call(l,a)&&s(e,a,l[a]);return e},d=(e,o)=>l(e,a(o));import{d as u,a8 as i,A as c,n as g,bu as p,aE as m,a1 as v,X as b,a6 as f,aB as h,r as y,j as N,o as _,g as w,h as k,e as I,b as x,f as V,c as P,u as C,bv as O,a4 as D,aa as j,N as F,w as T,bw as B,a9 as A,z as U,at as L,H as R,bx as z,$ as E,a0 as $,ab as S,J as q,L as K,by as Z,bz as M,x as H,bA as J,aK as Q}from"./index-OtYEJMgP.js";import{g as W}from"./RoleManage-0i99zGbG.js";import{u as X}from"./notification-8PYZEq4W.js";const G={class:"org-tree-select-dialog-box"},Y={key:0,class:"mb-4"},ee={class:"org-tree-content overflow-auto h-96"},le={class:"dialog-footer"},ae=u({__name:"OrgDialog",props:{onRegister:{},allowNull:{type:Boolean,default:!0},singleSelect:{type:Boolean,default:!0},modelValue:{},inputClass:{},showFilter:{type:Boolean,default:!0},inputProps:{default:()=>({})},orgParams:{default:()=>({})},getOrgDataApi:{},orgTreeProps:{default:()=>({})}},emits:["confirm","cancel"],setup(e,{emit:l}){const a=l,o=e,[r,{closeDialog:t}]=i((()=>{J()})),s=c(""),d=c([]),u=c([]),U=g((()=>n({placeholder:"请输入名称",maxlength:"20",clearable:!0},p(o.inputProps,["model-value"])))),L=c(null),R=c(!1),z=c([]),E=g((()=>n({nodeKey:"id",props:{label:e=>e.shortName||e.name,children:"children",disabled:e=>{var l,a;let r=!1;return(null==(l=o.orgTreeProps)?void 0:l.disabled)&&(null==(a=o.orgTreeProps)||a.disabled.forEach((l=>{e[l.key]==l.value&&(r=!0)}))),r}}},o.orgTreeProps))),$=function(e,{node:l}){return g((()=>{if(!l.label||!s.value)return x("span",{class:"el-tree-node__label"},[l.label]);try{if(l.label.includes(s.value)){const e=l.label.split(s.value),a=e.map(((l,a)=>x("span",null,[l,a===e.length-1?null:x("span",{style:"color:var(--el-color-primary);font-weight:bold"},[s.value])])));return x("span",{class:"el-tree-node__label"},[a])}return x("span",{class:"el-tree-node__label"},[l.label])}catch(e){return x("span",{class:"el-tree-node__label"},[l.label])}})).value},S=(e,l)=>!e||l.name.includes(e),q=function(e,l){var a;if(o.singleSelect)(null==(a=d.value[0])?void 0:a.id)===(null==e?void 0:e.id)&&o.allowNull?d.value=[]:d.value=[e];else{const{checkedNodes:a,halfCheckedNodes:r}=l,t=[...a,...r];o.allowNull&&!t.length?d.value=[e]:d.value=t}b((()=>{L.value.setCheckedNodes(d.value,!1)}))};let K=null;const Z=function(){K&&clearTimeout(K),K=setTimeout((()=>{var e;null==(e=L.value)||e.filter(s.value)}),400)},M=function(){var e;t(),s.value="",d.value=[],z.value=[],null==(e=L.value)||e.setCheckedKeys([],!1),a("cancel")},H=function(){a("confirm",C(d.value)),M()},J=function(){if(R.value=!0,o.getOrgDataApi&&m(o.getOrgDataApi))try{o.getOrgDataApi(n({},o.orgParams)).then((e=>{e&&v!==e&&(z.value=e,b((()=>{var e,l;const a=(o.modelValue+"").split(",");null==(e=L.value)||e.setCheckedKeys(a,!1),d.value=(null==(l=L.value)?void 0:l.getCheckedNodes())||[],u.value=a})))})).finally((()=>{R.value=!1}))}catch(e){f.error("传入Api错误："+e)}else h(n({enable:"1"},o.orgParams)).then((e=>{v!==e&&(z.value=e,b((()=>{var e,l;const a=(o.modelValue+"").split(",");null==(e=L.value)||e.setCheckedKeys(a,!1),d.value=(null==(l=L.value)?void 0:l.getCheckedNodes())||[],u.value=a})))})).finally((()=>{R.value=!1}))};return(e,l)=>{const a=y("el-button"),t=N("loading");return _(),w(C(A),{width:"720","destroy-on-close":!0,"close-on-click-modal":!1,"before-close":M,onRegister:C(r)},{footer:k((()=>[I("span",le,[x(a,{type:"success",loading:R.value,disabled:!o.allowNull&&!d.value,onClick:H},{default:k((()=>[V(" 确定 ")])),_:1},8,["loading","disabled"]),x(a,{type:"success",plain:"",disabled:R.value,onClick:M},{default:k((()=>[V("取消")])),_:1},8,["disabled"])])])),default:k((()=>[I("div",G,[o.showFilter?(_(),P("div",Y,[x(C(O),D({modelValue:s.value,"onUpdate:modelValue":l[0]||(l[0]=e=>s.value=e),modelModifiers:{trim:!0}},U.value,{onInput:Z}),{prefix:k((()=>[x(C(j),{height:"14",width:"14"})])),_:1},16,["modelValue"])])):F("",!0),T((_(),P("div",ee,[x(C(B),D({ref_key:"orgTreeRef",ref:L,class:"org-tree","show-checkbox":""},E.value,{data:z.value,"check-strictly":!0,"highlight-current":!0,"expand-on-click-node":!1,"default-expanded-keys":u.value,"filter-node-method":S,"render-content":$,onCheck:q}),null,16,["data","default-expanded-keys"])])),[[t,R.value]])])])),_:1},8,["onRegister"])}}}),oe={class:"w-full"},re=u(d(n({},{name:"OrgTreeSelect"}),{__name:"index",props:{allowNull:{type:Boolean,default:!0},singleSelect:{type:Boolean,default:!0},orgName:{},orgId:{},orgParams:{default:()=>({})},orgDialogProps:{default:()=>({})},getOrgDataApi:{},id:{},size:{},disabled:{type:Boolean},modelValue:{},type:{},resize:{},autosize:{},autocomplete:{},formatter:{},parser:{},placeholder:{},form:{},readonly:{type:Boolean},clearable:{type:Boolean},showPassword:{type:Boolean},showWordLimit:{type:Boolean},suffixIcon:{},prefixIcon:{},containerRole:{},label:{},tabindex:{},validateEvent:{type:Boolean},inputStyle:{},autofocus:{type:Boolean}},emits:["update:orgName","update:orgId","update:orgCode","update","cancel"],setup(e,{emit:l}){const a=l,o=e,[r,{showDialog:t}]=U({title:"单位选择"}),s=c(""),d=g((()=>p(o,["orgName","orgId","orgParams","orgDialogProps","allowNull"]))),u=g((()=>n({},o.orgDialogProps))),i=L((()=>o.orgName),(e=>{e!==s.value&&(s.value=e)}),{immediate:!0}),m=function(){t(!0,{})},v=function(e){if(!E(e))return;const l=e.map((e=>e.name||"")).join(","),r=e.map((e=>e.id||"")).join(","),t=e.map((e=>e.code||"")).join(",");s.value=l,a("update:orgName",l),a("update:orgId",r),a("update:orgCode",t);const n=o.singleSelect?e[0]||{name:"",id:"",code:""}:e;a("update",n)},b=function(){a("cancel")};return R((()=>{b(),i()})),(e,l)=>{const a=y("el-button");return _(),P("div",oe,[x(C(O),D({class:"org-input-class"},d.value,{value:s.value,readonly:"",clearable:"",placeholder:"请选择",maxlength:"20"}),z({_:2},[d.value.disabled?void 0:{name:"append",fn:k((()=>[x(a,{icon:C(j),onClick:m},null,8,["icon"])])),key:"0"}]),1040,["value"]),x(ae,{"model-value":o.orgId,"org-tree-props":u.value,"org-params":o.orgParams,"allow-null":o.allowNull,"single-select":o.singleSelect,"get-org-data-api":o.getOrgDataApi,onRegister:C(r),onConfirm:v,onCancel:b},null,8,["model-value","org-tree-props","org-params","allow-null","single-select","get-org-data-api","onRegister"])])}}})),te={class:"dialog-footer"},se=u(d(n({},{name:"EditUserDialog"}),{__name:"editUserDialog",emits:["register","confirm"],setup(e,{emit:l}){let a="";const o=l,r=c(null),t={orgId:[{required:!0,message:"请选择所属单位！",trigger:"change"}],realName:[{required:!0,message:"请填写姓名！",trigger:"blur"},{validator(e,l,a){/^[a-zA-Z0-9\u4e00-\u9fa5._-]+$/.test(l)?a():a(new Error("姓名仅包含汉字,数字,大小写字母和特殊字符(.-_)！"))},trigger:"blur"},{max:16,message:"姓名长度不超过16位！",trigger:"blur"}],userName:[{required:!0,message:"请填写账号！",trigger:"blur"},{validator(e,l,a){/^(?=[a-zA-Z]+)[a-zA-Z0-9_]+$/.test(l)||a(new Error("账号以字母开头，仅包含英文字母/数字/下划线！")),a()},trigger:"blur"},{min:3,max:16,message:"账号长度为3-16位！",trigger:"blur"}],mobile:[{validator(e,l,a){if(l){Q.phone.test(l)?a():a(new Error("请填写正确的联系方式！"))}else a()},trigger:"blur"},{max:32,message:"设备管理人员联系方式长度不能超过32位！",trigger:"blur"}],roleId:[{required:!0,message:"请选择角色！",trigger:"change"}],enabledFlag:[{required:!0,message:"请选择是否启用！",trigger:"change"}]},s=c(!1),u=c(!1),g=$({id:"",orgName:"",orgId:"",realName:"",userName:"",roleId:"",leaderLevel:"",enabledFlag:"",userType:"",mobile:""}),p=c([]),m=[{label:"公司管理人员",value:"1"},{label:"地市管理人员",value:"2"},{label:"工区管理人员",value:"3"},{label:"工区成员",value:"4"}],[b,{closeDialog:N}]=i((e=>{const{type:l,data:o}=e;if(a=l,h({}).then((e=>{v!==e&&(p.value=e)})),"edit"===l){const{id:e}=o||{};!function(e){Z(e).then((e=>{if(v!==e){const{user:l={},role:a=[]}=e,{id:o,userName:r,realName:t,enabledFlag:s,leaderLevel:n="",type:d,organization:u={},mobile:i=""}=l,c=u.id||"",p=u.shortName||u.name||"",m=a.map((e=>e.id));m.length>0?g.roleId=m[0]:g.roleId="",Object.assign(g,{id:o,userName:r,realName:t,orgName:p,orgId:c,enabledFlag:s,leaderLevel:n,userType:d,mobile:i})}}))}(e),D()}})),O=c([]),D=()=>{return e=this,l=null,a=function*(){u.value=!0,W().then((e=>{e&&v!==e&&(O.value=e||[])})).finally((()=>{u.value=!1}))},new Promise(((o,r)=>{var t=e=>{try{n(a.next(e))}catch(l){r(l)}},s=e=>{try{n(a.throw(e))}catch(l){r(l)}},n=e=>e.done?o(e.value):Promise.resolve(e.value).then(t,s);n((a=a.apply(e,l)).next())}));var e,l,a},j=function(){var e;N(),a="",Object.assign(g,{id:"",userName:"",realName:"",orgName:"",orgId:"",roleId:"",enabledFlag:"",userType:"",mobile:""}),s.value=!1,null==(e=r.value)||e.resetFields()},F=function(){var e;null==(e=r.value)||e.validate((e=>{if(e){s.value=!0;const{id:e,orgId:l,userName:r,realName:t,roleId:u,enabledFlag:i,userType:c,leaderLevel:p,mobile:m}=g,b={userName:r,realName:t,orgId:l,roleIds:u,enabledFlag:i,leaderLevel:p,mobile:m};"add"===a?M(d(n({},b),{userType:"0"})).then((e=>{if(v!==e){f.success("添加用户成功！"),o("confirm"),j();const l=H("div",["用户",H("span",{style:{color:"var(--el-color-primary)"}},[" ",r," "]),"的密码为:",H("span",{style:{color:"var(--el-color-primary)"}},[e])]);X(l,{type:"success",duration:0})}})).finally((()=>{s.value=!1})):"edit"===a?(b.id=e,J(d(n({},b),{userType:c})).then((e=>{v!==e&&(f.success("编辑用户成功！"),o("confirm"),j())})).finally((()=>{s.value=!1}))):s.value=!1}}))},T=function(){D()};return(e,l)=>{const o=y("el-form-item"),n=y("el-input"),d=y("el-option"),i=y("el-option-group"),c=y("el-select"),p=y("el-radio"),v=y("el-radio-group"),f=y("el-button");return _(),P("div",null,[x(C(A),{width:"720",draggable:"",center:"","destroy-on-close":"","show-close":!1,"close-on-click-modal":!1,"before-close":j,onRegister:C(b)},{footer:k((()=>[I("span",te,[x(f,{disabled:s.value,class:"basic-button",plain:"",onClick:j},{default:k((()=>[V(" 取消 ")])),_:1},8,["disabled"]),x(f,{loading:s.value,class:"basic-button",onClick:F},{default:k((()=>[V(" 保存 ")])),_:1},8,["loading"])])])),default:k((()=>[x(C(S),{ref_key:"refUserEditForm",ref:r,model:g,rules:t,"label-suffix":"：","label-width":"100px"},{default:k((()=>[x(o,{label:"所属单位",prop:"orgId"},{default:k((()=>[x(re,{"org-name":g.orgName,"onUpdate:orgName":l[0]||(l[0]=e=>g.orgName=e),"org-id":g.orgId,"onUpdate:orgId":l[1]||(l[1]=e=>g.orgId=e),"allow-null":!1,placeholder:"请选择所属单位"},null,8,["org-name","org-id"])])),_:1}),x(o,{label:"姓名",prop:"realName"},{default:k((()=>[x(n,{modelValue:g.realName,"onUpdate:modelValue":l[2]||(l[2]=e=>g.realName=e),clearable:"",maxlength:"16","show-word-limit":"",disabled:s.value,placeholder:"请填写姓名，仅包含汉字,数字,大小写字母和特殊字符(.-_)",formatter:e=>e.replace(/^\s*|\s*$/g,""),parser:e=>e.replace(/^\s*|\s*$/g,"")},null,8,["modelValue","disabled","formatter","parser"])])),_:1}),x(o,{label:"账号",prop:"userName"},{default:k((()=>[x(n,{modelValue:g.userName,"onUpdate:modelValue":l[3]||(l[3]=e=>g.userName=e),clearable:"",maxlength:"16","show-word-limit":"",disabled:s.value||"edit"===C(a),placeholder:"以字母开头，长度3-16位，仅包含英文字母/数字/下划线",formatter:e=>e.replace(/^\s*|\s*$/g,""),parser:e=>e.replace(/^\s*|\s*$/g,"")},null,8,["modelValue","disabled","formatter","parser"])])),_:1}),x(o,{label:"角色",prop:"roleId"},{default:k((()=>[x(c,{modelValue:g.roleId,"onUpdate:modelValue":l[4]||(l[4]=e=>g.roleId=e),placeholder:"请选择角色类型",clearable:"",multiple:!1,"collapse-tags":"","tag-type":"info",loading:u.value,"collapse-tags-tooltip":"","max-collapse-tags":4,disabled:s.value,onClick:T},{default:k((()=>[(_(!0),P(q,null,K(O.value,(e=>(_(),w(i,{key:e.groupName,label:e.groupName},{default:k((()=>[(_(!0),P(q,null,K(e.list,(e=>(_(),w(d,{key:e.value,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue","loading","disabled"])])),_:1}),x(o,{label:"联系方式",prop:"mobile"},{default:k((()=>[x(n,{modelValue:g.mobile,"onUpdate:modelValue":l[5]||(l[5]=e=>g.mobile=e),clearable:"",placeholder:"请填写联系方式",maxlength:"32","show-word-limit":"",formatter:e=>e.replace(/^\s*|\s*$|\n/g,""),parser:e=>e.replace(/^\s*|\s*$|\n/g,"")},null,8,["modelValue","formatter","parser"])])),_:1}),x(o,{label:"级别分类",prop:"leaderLevel"},{default:k((()=>[x(c,{modelValue:g.leaderLevel,"onUpdate:modelValue":l[6]||(l[6]=e=>g.leaderLevel=e),disabled:s.value,placeholder:"请选择级别分类",clearable:""},{default:k((()=>[(_(),P(q,null,K(m,(e=>x(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:1},8,["modelValue","disabled"])])),_:1}),x(o,{label:"状态",prop:"enabledFlag"},{default:k((()=>[x(v,{modelValue:g.enabledFlag,"onUpdate:modelValue":l[7]||(l[7]=e=>g.enabledFlag=e),class:"ml-4",disabled:s.value},{default:k((()=>[x(p,{label:"1"},{default:k((()=>[V("启用")])),_:1}),x(p,{label:"0"},{default:k((()=>[V("禁用")])),_:1})])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1},8,["model"])])),_:1},8,["onRegister"])])}}}));export{se as _};
