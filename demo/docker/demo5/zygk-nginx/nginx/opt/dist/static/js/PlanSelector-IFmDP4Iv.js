var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(a,l,o)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[l]=o;import{d as p,n,A as c,a0 as i,Y as u,a8 as d,X as m,H as g,r as b,j as w,o as f,g as v,h,e as k,b as y,f as x,w as j,c as _,a4 as C,u as S,a2 as O,J as R,L as N,a9 as V,a5 as T,aY as I,$ as z,a1 as L,_ as P}from"./index-OtYEJMgP.js";import{a as U}from"./constants-uiyZ18jc.js";const Y={class:"flex-1 flex flex-col gap-y-2 my-2"},W={class:"dialog-footer"},D=p((E=((e,a)=>{for(var l in a||(a={}))t.call(a,l)&&r(e,l,a[l]);if(o)for(var l of o(a))s.call(a,l)&&r(e,l,a[l]);return e})({},{name:"PlanSelector"}),a(E,l({__name:"PlanSelector",emits:["register","confirm"],setup(e,{emit:a}){const l=n((()=>({nodeKey:"id",props:{label:e=>e.shortName||e.name,children:"children"}}))),o=c(!1),t=i({cityOrgId:"",orgId:"",majorTypes:[],workRiskLevels:[],time:U.range.default,keyWord:""}),s=i({pageNum:1,pageSize:10,total:0}),r=()=>{s.pageNum=1,D()},p=()=>{s.pageNum=1,D(),X()},P=u([]),D=T((()=>{return e=this,a=null,l=function*(){o.value=!0,P.value=[];const{pageNum:e,pageSize:a}=s,{cityOrgId:l,orgId:r,majorTypes:p,workRiskLevels:n,time:c,keyWord:i}=t,[u,d]=c;yield I({cityOrgId:l,orgId:r,majorType:z(p)?p.join(","):"",workRiskLevel:z(n)?n.join(","):"",beginTime:u,endTime:d,keyWord:i,pageNum:e,pageSize:a}).then((e=>{if(e&&L!==e){const{rows:a,total:l}=e;P.value=a||[],s.total=Number(l)||0,P.value.map((e=>{m((()=>{F(e)&&A.value.toggleRowSelection(e,!0)}))}))}})).finally((()=>{o.value=!1}))},new Promise(((o,t)=>{var s=e=>{try{p(l.next(e))}catch(a){t(a)}},r=e=>{try{p(l.throw(e))}catch(a){t(a)}},p=e=>e.done?o(e.value):Promise.resolve(e.value).then(s,r);p((l=l.apply(e,a)).next())}));var e,a,l}),1e3),E=a,[M,{closeDialog:H}]=d((e=>{const{type:a,data:l}=e;"view"===a&&(Object.keys(l).forEach((e=>{t[e]=l[e]})),m((()=>{p()})))})),$=function(){o.value=!1,H(),Object.keys(t).forEach((e=>{["majorTypes","workRiskLevels"].includes(e)?t[e]=[]:t[e]="time"===e?U.range.default:""})),P.value=[]},A=u(null),B=i(new Map),F=e=>B.has(e.taskId),q=e=>{const a=e.taskId;B.has(a)?(B.delete(a),A.value.toggleRowSelection(e,!1)):(B.set(a,e),A.value.toggleRowSelection(e,!0))},J=(e,a)=>{const l=a.taskId;B.has(l)?B.delete(l):(B.set(l,a),A.value.toggleRowSelection(a,!0))},K=e=>{P.value.map((a=>{0===e.length?F(a)&&q(a):F(a)||q(a)}))},X=()=>{B.clear(),A.value.clearSelection()},G=()=>{E("confirm",{plans:[...B.values()]}),$()};return g((()=>{$()})),(e,a)=>{const n=b("el-tree-select"),c=b("el-form-item"),i=b("el-option"),u=b("el-select"),d=b("el-date-picker"),m=b("el-input"),g=b("el-button"),T=b("el-form"),I=b("el-table-column"),z=b("el-table"),L=b("el-pagination"),U=w("loading");return f(),v(S(V),{width:"80%",top:"32px","show-close":!0,center:"","destroy-on-close":"","close-on-click-modal":!1,onClose:$,onRegister:S(M)},{footer:h((()=>[k("span",W,[y(g,{class:"basic-button",disabled:o.value,onClick:$},{default:h((()=>[x(" 取消 ")])),_:1},8,["disabled"]),y(g,{class:"basic-button",loading:o.value,onClick:G},{default:h((()=>[x(" 保存 ")])),_:1},8,["loading"])])])),default:h((()=>[j((f(),_("div",Y,[y(T,{inline:!0,"label-suffix":"：",class:"w-full table-query"},{default:h((()=>[y(c,{label:"管理部门",class:"m-0"},{default:h((()=>[y(n,C({modelValue:t.orgId,"onUpdate:modelValue":a[0]||(a[0]=e=>t.orgId=e),data:S(O)().orgTreeByUser,"render-after-expand":!1,clearable:""},l.value,{"highlight-current":!0,"expand-on-click-node":!1,placeholder:"请选择管理部门",onFocus:S(O)().loadOrgTreeByUser}),null,16,["modelValue","data","onFocus"])])),_:1}),y(c,{label:"专业",class:"m-0"},{default:h((()=>[y(u,{modelValue:t.majorTypes,"onUpdate:modelValue":a[1]||(a[1]=e=>t.majorTypes=e),placeholder:"请选择专业",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:h((()=>[(f(!0),_(R,null,N(S(O)().workerMajorList,(e=>(f(),v(i,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),y(c,{label:"作业风险等级",class:"m-0"},{default:h((()=>[y(u,{modelValue:t.workRiskLevels,"onUpdate:modelValue":a[2]||(a[2]=e=>t.workRiskLevels=e),placeholder:"请选择作业风险等级",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:h((()=>[(f(!0),_(R,null,N(S(O)().workRiskLevelList,(e=>(f(),v(i,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),y(c,{label:"计划时间",class:"col-span-2 m-0"},{default:h((()=>[y(d,{modelValue:t.time,"onUpdate:modelValue":a[3]||(a[3]=e=>t.time=e),"value-format":"YYYY-MM-DD HH:mm:ss",type:"datetimerange","unlink-panels":"","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",editable:!1,clearable:!1},null,8,["modelValue"])])),_:1}),y(c,{label:"搜索",class:"m-0"},{default:h((()=>[y(m,{modelValue:t.keyWord,"onUpdate:modelValue":a[4]||(a[4]=e=>t.keyWord=e),clearable:"",maxlength:"20",placeholder:"请输入任务名称/作业人员",formatter:e=>e.replace(/^\s*|\s*$/g,""),parser:e=>e.replace(/^\s*|\s*$/g,"")},null,8,["modelValue","formatter","parser"])])),_:1}),y(c,{class:"m-0"},{default:h((()=>[y(g,{class:"basic-button",onClick:p},{default:h((()=>[x(" 查询 ")])),_:1})])),_:1})])),_:1}),y(z,{ref_key:"multipleTableRef",ref:A,class:"w-full h-[480px]","show-overflow-tooltip":"",data:P.value,onSelect:J,onSelectAll:K},{default:h((()=>[y(I,{type:"selection",width:"80"}),y(I,{prop:"cityOrgName",align:"center",label:"市级公司","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(I,{prop:"orgName",align:"center",label:"管理部门","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(I,{prop:"taskName",align:"center",label:"任务名称","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(I,{prop:"majorTypeName",align:"center",label:"专业","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(I,{prop:"beginTime",align:"center",label:"计划开始时间","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(I,{prop:"endTime",align:"center",label:"计划结束时间","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(I,{prop:"workContent",align:"center",label:"作业内容","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(I,{prop:"workRiskLevelName",align:"center",label:"作业风险等级","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),y(I,{prop:"fzrRealName",align:"center",label:"工作负责人","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}})])),_:1},8,["data"])])),[[U,o.value]]),y(L,{"current-page":s.pageNum,"onUpdate:currentPage":a[5]||(a[5]=e=>s.pageNum=e),"page-size":s.pageSize,"onUpdate:pageSize":a[6]||(a[6]=e=>s.pageSize=e),background:"",small:"",layout:"total, sizes, prev, pager, next, jumper",total:s.total,"page-sizes":[10,20,30,40,50,100],onSizeChange:r,onCurrentChange:S(D)},null,8,["current-page","page-size","total","onCurrentChange"])])),_:1},8,["onRegister"])}}}))));var E;const M=P(D,[["__scopeId","data-v-259885be"]]);export{M as default};
