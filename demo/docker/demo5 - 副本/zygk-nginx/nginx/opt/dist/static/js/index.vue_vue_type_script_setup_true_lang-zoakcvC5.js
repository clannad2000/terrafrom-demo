var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,o=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,n=(e,a,l)=>new Promise(((t,s)=>{var i=e=>{try{n(l.next(e))}catch(a){s(a)}},o=e=>{try{n(l.throw(e))}catch(a){s(a)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(i,o);n((l=l.apply(e,a)).next())}));import{d as r,z as u,Y as c,Z as v,n as d,A as f,a0 as p,at as m,F as g,r as b,j as h,w as y,o as w,c as x,e as j,J as k,L as I,b as P,h as N,I as z,u as O,f as S,M as _,v as U,a5 as C,b9 as R,b7 as D,a1 as E,b8 as M,b5 as F,b6 as T}from"./index-OtYEJMgP.js";import{E as $}from"./icon_no_data-JkxAPqfn.js";import{I as H,u as J}from"./index-mErxNL28.js";import{e as Z}from"./constants-uiyZ18jc.js";import{u as A}from"./MediaReview-6GObmu50.js";import{d as L}from"./download-z--BcN7F.js";const X={key:0,class:"w-full grid grid-cols-3 gap-2 overflow-auto"},Y={class:"fixed top-12 right-36"},q={class:"flex flex-col"},B={key:1,class:"flex-1 flex flex-row items-center justify-center"},G=r((K=((e,a)=>{for(var l in a||(a={}))s.call(a,l)&&o(e,l,a[l]);if(t)for(var l of t(a))i.call(a,l)&&o(e,l,a[l]);return e})({},{name:"JobPlanMainImage"}),a(K,l({__name:"index",setup(e){const[a,{showDialog:l,setDialogProps:t}]=u(),s=c(),i=c(),{height:o}=v(s),{height:r}=v(i),G=d((()=>({width:"100%",height:o.value-r.value-20+"px"}))),K=f(!1),Q=p({pageNum:1,pageSize:9,total:0}),V=()=>{te()},W=()=>{ae.value={},le.value=[];const{type:e,value:a={}}=A().jobPlanParams;"image"===e&&(null==a?void 0:a.taskId)&&(Q.pageNum=1,te())},ee=f(!1),ae=c({}),le=c([]),te=C((()=>n(this,null,(function*(){K.value=!0,ee.value=!1;const{pageNum:e,pageSize:a}=Q,{type:l,isMarked:t,value:{taskId:s}}=A().jobPlanParams,i={pageNum:e,pageSize:a,taskId:s,fileType:l};"all"!==t&&(i.isMarked=t),ae.value={},yield D(i).then((e=>{if(e&&E!==e){const{rows:a=[],total:l=0}=e;Q.total=Number(l)||0,a.length&&(a.forEach((e=>{ae.value[e.fileId]=e,console.log(ae.value)})),se())}}))}))),1e3),se=()=>n(this,null,(function*(){const e=Object.keys(ae.value).join(",");yield M({fileIds:e}).then((e=>{e&&E!==e&&(e.forEach((e=>{Object.assign(ae.value[e.fileId],e)})),ie())}))})),ie=()=>n(this,null,(function*(){const e=Object.keys(ae.value);yield e.forEach((e=>n(this,null,(function*(){yield F({fileId:e}).then((a=>{a&&E!==a&&(ae.value[e].fileUrl=T(a))}))})))),le.value=Object.values(ae.value),setTimeout((()=>{ee.value=!0,K.value=!1}),2e3)})),oe=d((()=>le.value.map((e=>e.fileUrl)))),ne=f(0),re=e=>{ne.value=e},ue=e=>n(this,null,(function*(){const{taskId:a,fileUrl:s,fileId:i,execDeviceCode:o,execUserName:n,execUserRealName:r}=e,u=yield J(s),{value:{taskName:c,majorTypeName:v}}=A().jobPlanParams;t({title:"标记"}),l(!0,{type:"view",data:{imageFile:u,fileInfo:{module:"HSZX",fileType:"image",taskId:a,taskName:`${v?`(${v}）`:""}${c}`,deviceCode:o,userName:n,userRealName:r,sourceFileId:i}}})}));return m((()=>A().jobPlanParams),(()=>{W()}),{deep:!0,immediate:!0}),g((()=>{W()})),(e,l)=>{const t=b("el-button"),o=b("el-tooltip"),n=b("el-image"),r=b("el-empty"),u=b("el-pagination"),c=h("loading");return y((w(),x("div",{ref_key:"fileContainerRef",ref:s,class:"w-full h-full flex flex-col gap-y-4"},[j("div",{class:"flex flex-col items-center",style:U(G.value)},[le.value.length&&ee.value?(w(),x("div",X,[(w(!0),x(k,null,I(le.value,((e,a)=>(w(),x("div",{key:e.fileId,class:"aspect-video"},[P(n,{class:"w-full h-full",src:e.fileUrl,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":oe.value,"show-progress":"","initial-index":a,fit:"cover",onDragstart:l[2]||(l[2]=_((()=>{}),["prevent"])),onSwitch:re,onShow:e=>(e=>{ne.value=e})(a)},{viewer:N((()=>[j("div",Y,[P(o,{class:"box-item",effect:"dark",placement:"top-start"},{content:N((()=>[j("div",q,[j("div",null,"设备编号："+z(le.value[ne.value].execDeviceCode),1),j("div",null," 文件大小："+z(O(Z)(le.value[ne.value].fileSize)),1),j("div",null,"文件名称："+z(le.value[ne.value].fileName),1)])])),default:N((()=>[P(t,{class:"basic-button"},{default:N((()=>[S(" 图片信息 ")])),_:1})])),_:1}),P(t,{class:"basic-button",onClick:l[0]||(l[0]=e=>(e=>{K.value=!0;const{fileUrl:a}=e;R({fileUrl:a.replace("/js-zygk-admin","").replace("/basic-api","")}).then((e=>{if(e&&(null==e?void 0:e.data)){const a=e.headers["content-disposition"];let l="unknown";a&&(l=window.decodeURI(a.split("=")[1])),L(e.data,l)}})).finally((()=>{K.value=!1}))})(le.value[ne.value]))},{default:N((()=>[S(" 下载 ")])),_:1}),P(t,{class:"basic-button",onClick:l[1]||(l[1]=e=>ue(le.value[ne.value]))},{default:N((()=>[S(" 标记 ")])),_:1})])])),_:2},1032,["src","preview-src-list","initial-index","onShow"])])))),128))])):(w(),x("div",B,[P(r,{description:"暂无数据",image:O($)},null,8,["image"])]))],4),P(u,{ref_key:"paginationRef",ref:i,"current-page":Q.pageNum,"onUpdate:currentPage":l[3]||(l[3]=e=>Q.pageNum=e),"page-size":Q.pageSize,"onUpdate:pageSize":l[4]||(l[4]=e=>Q.pageSize=e),small:"",background:"",layout:"total, prev, pager, next",total:Q.total,onCurrentChange:V},null,8,["current-page","page-size","total"]),P(H,{onRegister:O(a)},null,8,["onRegister"])])),[[c,K.value]])}}}))));var K;export{G as _};
