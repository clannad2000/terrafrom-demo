var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,i=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,s=(e,a,l)=>new Promise(((t,o)=>{var n=e=>{try{s(l.next(e))}catch(a){o(a)}},i=e=>{try{s(l.throw(e))}catch(a){o(a)}},s=e=>e.done?t(e.value):Promise.resolve(e.value).then(n,i);s((l=l.apply(e,a)).next())}));import{d as r,Y as u,Z as p,n as c,z as d,A as f,a0 as g,F as m,r as h,j as v,o as w,c as b,e as y,w as x,v as _,b as C,a4 as N,h as k,f as j,g as z,I as P,M as I,u as O,a6 as S,bC as R,bD as V,aB as U,a1 as F,$ as D,aJ as $,bE as E,bF as T,aC as q,bG as A,bH as B}from"./index-OtYEJMgP.js";import{d as G}from"./download-z--BcN7F.js";import{u as H}from"./notification-8PYZEq4W.js";import{_ as J}from"./editUserDialog.vue_vue_type_script_setup_true_lang-F0E5xdsG.js";const K={class:"w-full h-full"},L={class:"w-full h-full flex flex-row items-start justify-between gap-x-4"},M=r((Q=((e,a)=>{for(var l in a||(a={}))o.call(a,l)&&i(e,l,a[l]);if(t)for(var l of t(a))n.call(a,l)&&i(e,l,a[l]);return e})({},{name:"PrincipalPersonnelIndex"}),a(Q,l({__name:"index",setup(e){const a=u(),l=u(),{height:t}=p(a),{height:o}=p(l),n=c((()=>({height:t.value-o.value-24+"px"}))),i=u(),{width:r,height:M}=p(i),Q=u(),Y=u(),{height:Z}=p(Q),{height:W}=p(Y),X=c((()=>({width:`${r.value}`,height:""+(M.value-Z.value-W.value-32)}))),[ee,{showDialog:ae,setDialogProps:le}]=d({title:"编辑用户"}),te=f(!1),oe=f([]),ne=f([]),ie=e=>{ne.value=e},se=()=>s(this,null,(function*(){if(0===ne.value.length)return void S.warning("请选择要导出的数据！");te.value=!0;const e=ne.value.map((e=>e.id)).join(",");yield R({userIds:e}).then((e=>{if(e&&(null==e?void 0:e.data)){const a=e.headers["content-disposition"];let l="unknown";a&&(l=window.decodeURI(a.split("=")[1])),G(e.data,l)}})).finally((()=>{te.value=!1}))})),re=()=>s(this,null,(function*(){te.value=!0;const{orgId:e,userName:a,realName:l}=ue;yield V({orgId:e,userName:a,realName:l}).then((e=>{if(e&&(null==e?void 0:e.data)){const a=e.headers["content-disposition"];let l="unknown";a&&(l=window.decodeURI(a.split("=")[1])),G(e.data,l)}})).finally((()=>{te.value=!1}))})),ue=g({orgId:"",orgName:"",userName:"",realName:""}),pe=g({pageNum:1,pageSize:10,total:0}),ce=f(null),de=f(!1),fe=u([]),ge=c((()=>({nodeKey:"id",props:{label:"name",children:"children"}}))),me=e=>{const{id:a,name:l}=e;Object.assign(ue,{orgId:a,orgName:l}),ve()},he=()=>{te.value=!0;const{pageSize:e,pageNum:a}=pe,{orgId:l,userName:t,realName:o}=ue;q({orgId:l,userName:t,realName:o,pageSize:e,pageNum:a}).then((e=>{if(F!==e){const{rows:a=[],total:l=0}=e;oe.value=a,pe.total=Number(l)||0}})).finally((()=>{te.value=!1}))},ve=function(){pe.pageNum=1,he()},we=()=>{le({title:"新增用户"}),ae(!0,{type:"add"})},be=e=>s(this,null,(function*(){te.value=!0;const{id:a}=e;E(a).then((e=>{F!==e&&(S.success("删除用户成功！"),pe.pageNum=1,he())})).finally((()=>{te.value=!1}))})),ye=e=>new Promise(((a,l)=>{te.value=!0;let t=null;t="1"==e.status?A:B,t(e.id).then((t=>{F!==t?(S.success(("1"==e.status?"解锁":"锁定")+"成功!"),a(!0)):(S.error(("1"==e.status?"解锁":"锁定")+"失败!"),l(!1))})).catch((()=>{S.error(("1"==e.status?"解锁":"锁定")+"失败!"),l(!1)})).finally((()=>{te.value=!1}))})),xe=function(){he()},_e=()=>{pe.pageNum=1,he()},Ce=()=>{he()};return m((()=>{de.value=!0,U({enable:"1"}).then((e=>{if(F!==e&&(fe.value=e,e&&D(e))){const{id:a,name:l}=e[0];me({id:a,name:l})}})).finally((()=>{de.value=!1}))})),(e,t)=>{const o=h("el-tree"),s=h("el-input"),r=h("el-form-item"),u=h("el-button"),p=h("el-form"),c=h("el-table-column"),d=h("el-tag"),f=h("el-switch"),g=h("el-popconfirm"),m=h("el-table"),S=h("el-pagination"),R=v("loading");return w(),b("div",K,[y("div",L,[y("div",{ref_key:"treeContainerRef",ref:a,class:"w-1/5 h-full flex flex-col table-container tree-container"},[y("h2",{ref_key:"treeContainerTitleRef",ref:l},"组织机构",512),x((w(),b("div",{style:_([{"overflow-y":"auto","background-color":"#09455b"},n.value])},[C(o,N({ref_key:"orgTreeRef",ref:ce},ge.value,{data:fe.value,"check-strictly":!0,"highlight-current":!0,"expand-on-click-node":!1,onCurrentChange:me}),null,16,["data"])],4)),[[R,de.value]])],512),y("div",{ref_key:"tableContainerRef",ref:i,class:"flex flex-col w-4/5 h-full gap-y-4 table-container"},[C(p,{ref_key:"searchFormRef",ref:Q,inline:!0,"label-suffix":"：",class:"w-full table-query"},{default:k((()=>[C(r,{label:"姓名",class:"m-0"},{default:k((()=>[C(s,{modelValue:ue.realName,"onUpdate:modelValue":t[0]||(t[0]=e=>ue.realName=e),clearable:"",class:"mb-4",placeholder:"请输入姓名",maxlength:"20"},null,8,["modelValue"])])),_:1}),C(r,{label:"账号",class:"m-0"},{default:k((()=>[C(s,{modelValue:ue.userName,"onUpdate:modelValue":t[1]||(t[1]=e=>ue.userName=e),clearable:"",class:"mb-4",placeholder:"请输入账号",maxlength:"20"},null,8,["modelValue"])])),_:1}),C(r,{label:"",class:"m-0"},{default:k((()=>[C(u,{class:"basic-button",loading:te.value,onClick:ve},{default:k((()=>[j(" 查询 ")])),_:1},8,["loading"]),C(u,{class:"basic-button",onClick:we},{default:k((()=>[j(" 新增 ")])),_:1}),C(u,{class:"basic-button",loading:te.value,onClick:se},{default:k((()=>[j(" 导出 ")])),_:1},8,["loading"]),C(u,{class:"basic-button",loading:te.value,onClick:re},{default:k((()=>[j(" 批量导出 ")])),_:1},8,["loading"])])),_:1})])),_:1},512),x((w(),z(m,{width:X.value.width,height:X.value.height,data:oe.value,"show-overflow-tooltip":"",onSelectionChange:ie},{default:k((()=>[C(c,{type:"selection",width:"80"}),C(c,{type:"index",label:"序号",width:"80",align:"center"},{default:k((e=>[y("span",null,P((pe.pageNum-1)*pe.pageSize+e.$index+1),1)])),_:1}),C(c,{prop:"realName",label:"姓名","min-width":"180",align:"center","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),C(c,{prop:"userName",label:"登录账号","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"},align:"center"}),C(c,{prop:"mobile",label:"联系方式","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"},align:"center"}),C(c,{prop:"dataSource",label:"用户来源","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"},align:"center"}),C(c,{prop:"roleName",label:"角色","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"},align:"center"}),C(c,{prop:"leaderLevelName",label:"级别分类","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"},align:"center"}),C(c,{prop:"orgNamePath",align:"center",label:"用户组织","min-width":"180","show-overflow-tooltip":{popperClass:"max-w-xs whitespace-break-spaces"}}),C(c,{prop:"enabledFlag",align:"center",label:"状态"},{default:k((({row:e})=>[C(d,{type:"1"==e.enabledFlag?"success":"danger"},{default:k((()=>[j(P("1"==e.enabledFlag?"启用":"禁用"),1)])),_:2},1032,["type"])])),_:1}),C(c,{prop:"status",align:"center",label:"锁定状态"},{default:k((({row:e})=>[C(f,{modelValue:e.status,"onUpdate:modelValue":a=>e.status=a,"inline-prompt":"",size:"large","active-value":"0","inactive-value":"1","active-text":"正常","inactive-text":"锁定",loading:te.value,"before-change":ye.bind(this,e)},null,8,["modelValue","onUpdate:modelValue","loading","before-change"])])),_:1}),C(c,{fixed:"right",align:"center",label:"操作",width:"240"},{default:k((({row:e})=>[C(u,{type:"primary",link:"",onClick:a=>{return l=e,le({title:"编辑用户"}),void ae(!0,{type:"edit",data:$(l)});var l}},{default:k((()=>[j(" 编辑 ")])),_:2},1032,["onClick"]),C(g,{title:"确认删除?",onConfirm:a=>be(e)},{reference:k((()=>[C(u,{link:"",type:"danger",onClick:t[2]||(t[2]=I((()=>{}),["stop"]))},{default:k((()=>[j(" 删除")])),_:1})])),_:2},1032,["onConfirm"]),C(g,{title:"确认重置密码?",onConfirm:a=>(e=>{te.value=!0;const{id:a}=e;T(a).then((e=>{F!==e&&H(`重置密码成功！新密码：${e}。请尽快更改密码！`,{type:"success"})})).finally((()=>{te.value=!1}))})(e)},{reference:k((()=>[C(u,{link:"",type:"danger",onClick:t[3]||(t[3]=I((()=>{}),["stop"]))},{default:k((()=>[j(" 重置密码")])),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["width","height","data"])),[[R,te.value]]),C(S,{ref_key:"paginationRef",ref:Y,"current-page":pe.pageNum,"onUpdate:currentPage":t[4]||(t[4]=e=>pe.pageNum=e),"page-size":pe.pageSize,"onUpdate:pageSize":t[5]||(t[5]=e=>pe.pageSize=e),background:"",small:"",layout:"total, sizes, prev, pager, next, jumper",total:pe.total,"page-sizes":[10,20,30,40,50,100],onSizeChange:_e,onCurrentChange:Ce},null,8,["current-page","page-size","total"])],512)]),C(J,{onRegister:O(ee),onConfirm:xe},null,8,["onRegister"])])}}}))));var Q;export{M as _};
